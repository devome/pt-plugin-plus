import{V as b,E as c,b as k,n as y,t as f,P as v,u as p,v as T,g as w,w as C,a as F,x as m,y as O,f as x,z as M,h as I,B as R}from"./index-C2uF3Qql.js";import{B as E,D as z,F as B}from"./downloader-Bu4-3xTI.js";import{D as L,P as K}from"./DownloadTo-8u9H0tks.js";const P=new k,N=b.extend({props:{IMDbId:String,doubanId:String},data(){return{info:{title:"",summary:"",image:"",rating:{average:"",numRaters:0,value:""},attrs:{year:[],director:[],writer:[],cast:[],movie_type:[],pubdate:[],movie_duration:[]}},ratings:{imdbRating:"",Ratings:[],imdbVotes:""},rottenTomatoes:{fresh:"https://www.rottentomatoes.com/assets/pizza-pie/images/icons/global/new-fresh.587bf3a5e47.png",rotten:"https://www.rottentomatoes.com/assets/pizza-pie/images/icons/global/new-rotten.efc30acb29c.png"},visible:!1}},watch:{IMDbId(){this.reset()}},created(){this.reset()},methods:{reset(){this.visible=!1,this.ratings={imdbRating:"",Ratings:[],imdbVotes:""},console.log(this.doubanId,this.IMDbId),this.IMDbId&&(P.sendRequest(c.getMovieInfos,null,this.doubanId?`douban${this.doubanId}`:this.IMDbId).then(i=>{console.log(i),this.visible=!0;let t=null;Array.isArray(i)?t=i[0]:t=i,!t.average&&!t.rating&&(t.rating={average:"",numRaters:0,value:""}),this.info=t}).catch(i=>{console.log(i)}),P.sendRequest(c.getMovieRatings,null,this.IMDbId).then(i=>{console.log(i),this.ratings=i}).catch(i=>{console.log(i)}))},formatArray(i,t=" / ",e=10){return i&&i.length>0?e>0&&i.length>e?i.slice(0,e-1).join(t)+" ...":i.join(t):""},getArrayValues(i,t="name",e=" / "){if(i&&i.length>0){const s=[];return i.forEach(r=>{s.push(r[t])}),s.join(e)}return""}},computed:{rating(){return this.info&&(this.info.rating||this.info.average)?parseFloat(this.info.average||this.info.rating.value||this.info.rating.average)/2:0},imdbRating(){return this.ratings&&this.ratings.imdbRating?parseFloat(this.ratings.imdbRating)/2:0},tomatoRating(){if(this.ratings&&this.ratings.Ratings){let i=0;return this.ratings.Ratings.some(t=>{if(t.Source=="Rotten Tomatoes")return i=parseInt(t.Value),!0}),i}return 0},metascore(){if(this.ratings&&this.ratings.Ratings){let i=0;return this.ratings.Ratings.some(t=>{if(t.Source=="Metacritic")return i=parseInt(t.Value.split("/")[0]),!0}),i}return 0},maxHeight(){return this.$vuetify.breakpoint.smAndDown?120:300}}});var H=function(){var t=this,e=t._self._c;return t._self._setupProxy,t.visible?e("div",{staticClass:"movieInfoCard"},[e("v-card",{staticClass:"white--text",attrs:{color:"blue-grey darken-2"}},[e("v-card-title",{staticClass:"pb-2"},[e("div",{class:t.$vuetify.breakpoint.mdAndUp?"headline":"title"},[e("span",[t._v(t._s(t.info.title))]),e("span",{class:["ml-1","grey--text",t.$vuetify.breakpoint.mdAndUp?"title":"caption"]},[t._v("("+t._s(t.info.year||t.info.attrs.year[0])+")")])])]),e("v-img",{staticClass:"ml-3 mb-3",attrs:{src:t.info.image||t.info.pic.normal,contain:"","max-height":t.maxHeight,position:"left center"}},[t.$vuetify.breakpoint.mdAndUp?e("v-layout",{staticStyle:{"margin-left":"220px"}},[t.info.updateTime?e("v-card-title",{staticClass:"pt-0"},[e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.alias")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.info.aka))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.director")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.info.director))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.writer")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.info.scenarist))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.cast")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.info.cast))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.type")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.info.genre))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.pubdate")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.info.releaseDate))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.duration")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.info.runtime))])]),e("v-flex",{staticClass:"my-2",attrs:{xs12:""}},[e("v-divider",{attrs:{light:""}})],1),e("div",{staticClass:"caption",domProps:{innerHTML:t._s(`　　${t.info.summary.replace(/\n/g,"<br>")} @豆瓣`)}})],1):t.info.attrs?e("v-card-title",{staticClass:"pt-0"},[e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.alias")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.info.alt_title))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.director")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.formatArray(t.info.attrs.director)))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.writer")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.formatArray(t.info.attrs.writer)))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.cast")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.formatArray(t.info.attrs.cast)))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.type")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.formatArray(t.info.attrs.movie_type)))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.pubdate")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.formatArray(t.info.attrs.pubdate)))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.duration")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.formatArray(t.info.attrs.movie_duration)))])]),e("v-flex",{staticClass:"my-2",attrs:{xs12:""}},[e("v-divider",{attrs:{light:""}})],1),e("div",{staticClass:"caption",domProps:{innerHTML:t._s(`${t.info.summary} @豆瓣`)}})],1):e("v-card-title",{staticClass:"pt-0"},[e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.alias")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.info.original_title))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.director")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.getArrayValues(t.info.directors)))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.cast")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.getArrayValues(t.info.actors)))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.type")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.formatArray(t.info.genres)))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.pubdate")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.formatArray(t.info.pubdate)))])]),e("v-flex",{attrs:{xs12:""}},[e("span",[t._v(t._s(t.$t("movieInfoCard.duration")))]),e("span",{staticClass:"caption"},[t._v(t._s(t.formatArray(t.info.durations)))])]),e("v-flex",{staticClass:"my-2",attrs:{xs12:""}},[e("v-divider",{attrs:{light:""}})],1),e("div",{staticClass:"caption",domProps:{innerHTML:t._s(`${t.info.intro} @豆瓣`)}})],1)],1):e("v-layout",{staticStyle:{"margin-left":"75px"}},[e("v-card-text",{staticClass:"pt-0"},[e("v-flex",{attrs:{xs12:""}},[e("span",{staticClass:"caption"},[t._v(t._s(t.info.original_title||t.info.alt_title))])]),e("v-flex",{attrs:{xs12:""}},[e("span",{staticClass:"caption"},[t._v(t._s(t.formatArray(t.info.genres||t.info.attrs.movie_type)))])]),e("v-flex",{attrs:{xs12:""}},[e("span",{staticClass:"caption"},[t._v(t._s(t.formatArray(t.info.pubdate||t.info.attrs.pubdate)))])]),e("v-flex",{attrs:{xs12:""}},[e("span",{staticClass:"caption"},[t._v(t._s(t.formatArray(t.info.durations||t.info.attrs.movie_duration)))])])],1)],1)],1),e("v-divider",{attrs:{light:""}}),e("v-card-actions",{staticClass:"px-3"},[e("v-btn",{attrs:{color:"success",href:t.info.link||t.info.url||t.info.mobile_link,target:"_blank",rel:"noopener noreferrer nofollow"}},[t._v("豆瓣 "+t._s(t.info.average||t.info.rating.value||t.info.rating.average))]),e("v-btn",{attrs:{color:"amber",href:`https://www.imdb.com/title/${this.IMDbId}/`,target:"_blank",rel:"noopener noreferrer nofollow"}},[t._v("IMDb "+t._s(t.ratings.imdbRating))]),t.tomatoRating>0?e("v-btn",{attrs:{color:"red lighten-3",href:t.ratings.tomatoURL,target:"_blank",rel:"noopener noreferrer nofollow"}},[e("v-avatar",{staticClass:"mr-1",attrs:{size:"20"}},[t.tomatoRating>=60?e("img",{attrs:{src:t.rottenTomatoes.fresh}}):e("img",{attrs:{src:t.rottenTomatoes.rotten}})]),t._v(" "+t._s(t.tomatoRating)+"% ")],1):t._e(),t.metascore>0?e("v-btn",{staticStyle:{"min-width":"unset"},attrs:{color:t.metascore>60?"success":t.metascore>40?"warning":"error",href:`https://www.metacritic.com/search/movie/${t.info.title}/results`,target:"_blank",rel:"noopener noreferrer nofollow"}},[e("v-avatar",{staticClass:"mr-2",attrs:{size:"20"}},[e("img",{attrs:{src:"https://upload.wikimedia.org/wikipedia/commons/f/f2/Metacritic_M.png"}})]),t._v(" "+t._s(t.metascore)+" ")],1):t._e(),e("v-spacer"),t.$vuetify.breakpoint.mdAndUp?e("v-layout",[t.rating>0?e("v-flex",{attrs:{xs6:""}},[e("v-rating",{attrs:{"background-color":"white",color:"yellow accent-4",dense:"",readonly:"","half-increments":"",size:"30"},model:{value:t.rating,callback:function(s){t.rating=s},expression:"rating"}}),e("span",{staticClass:"ma-2"},[t._v(t._s(t.$t("movieInfoCard.ratings.douban",{average:t.info.average||t.info.rating.value||t.info.rating.average,numRaters:t.info.votes||t.info.rating.count||t.info.rating.numRaters})))])],1):t._e(),t.imdbRating>0?e("v-flex",{attrs:{xs6:""}},[e("v-rating",{attrs:{"background-color":"white",color:"yellow accent-4",dense:"",readonly:"","half-increments":"",size:"30"},model:{value:t.imdbRating,callback:function(s){t.imdbRating=s},expression:"imdbRating"}}),e("span",{staticClass:"ma-2"},[t._v(t._s(t.$t("movieInfoCard.ratings.imdb",{average:t.ratings.imdbRating,numRaters:t.ratings.imdbVotes.replace(/,/g,"")})))])],1):t._e()],1):t._e()],1)],1)],1):t._e()},q=[],Q=y(N,H,q,!1,null,"2b9b56e7",null,null);const W=Q.exports,j=b.extend({props:{progress:Number,status:Number},mounted(){},computed:{color(){let i="success";switch(this.status){case f.downloading:i="info";break;case f.completed:case f.inactive:i="grey";break;case f.sending:}return i},icon(){let i="arrow_upward";switch(this.status){case f.downloading:i="arrow_downward";break;case f.completed:i="done";break;case f.inactive:i="wifi_off";break;case f.sending:}return i},statusTip(){let i=this.$t("searchTorrent.torrentStatus.sending").toString();switch(this.status){case f.downloading:i=this.$t("searchTorrent.torrentStatus.downloading").toString();break;case f.completed:i=this.$t("searchTorrent.torrentStatus.completed").toString();break;case f.inactive:i=this.$t("searchTorrent.torrentStatus.inactive").toString();break;case f.sending:}return i}}});var G=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("v-layout",{attrs:{row:"",wrap:""}},[e("v-flex",{staticClass:"mt-1",attrs:{xs2:""}},[e("v-icon",{attrs:{size:10,color:t.color,title:t.statusTip}},[t._v(t._s(t.icon))])],1),e("v-flex",{attrs:{xs10:""}},[e("v-progress-linear",{staticStyle:{"margin-left":"1px"},attrs:{color:t.color,height:"4",value:t.progress,title:`${t.progress}%`}})],1)],1)},V=[],Y=y(j,G,V,!1,null,null,null,null);const J=Y.exports,U=new k,Z=b.extend({props:{flat:Boolean,icon:Boolean,small:Boolean,dark:Boolean,iconText:{type:String,default:"favorite_border"},color:{type:String,default:"success"},label:{type:String,default:""},disabled:Boolean},data(){return{options:this.$store.state.options,contentMenus:[],loading:!1,haveSuccess:!1,haveError:!1,groups:[]}},methods:{showContentMenus(i){U.sendRequest(c.getTorrentCollectionGroups).then(t=>{this.groups=t;let e=[];this.groups.forEach(s=>{e.push({title:s.name,fn:()=>{this.$emit("add",s)}})}),e.push({}),e.push({title:this.$t("collection.addGroup"),fn:()=>{this.createGroup()}}),v.showContextMenu(e,i)})},createGroup(){let i=window.prompt(this.$t("collection.inputGroupName").toString());i&&U.sendRequest(c.addTorrentCollectionGroup,null,{name:i,color:E[Math.floor(Math.random()*E.length)]}).then(t=>{t&&this.$emit("add",t[t.length-1])})},clearStatus(){this.haveSuccess=!1,this.haveError=!1}}});var X=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("v-btn",{class:t.$vuetify.breakpoint.smAndUp?"":"mini",attrs:{flat:t.flat,icon:t.icon,small:t.small,loading:t.loading,color:t.color,disabled:t.disabled,title:t.$t("collection.add"),dark:t.dark},on:{click:function(s){return s.stopPropagation(),t.showContentMenus.apply(null,arguments)}}},[t.haveSuccess?e("v-icon",{attrs:{color:"success",small:""}},[t._v("done")]):t.haveError?e("v-icon",{attrs:{color:"red",small:""}},[t._v("close")]):e("v-icon",{attrs:{small:""}},[t._v(t._s(t.iconText))]),e("span",{staticClass:"ml-2"},[t._v(t._s(t.label))])],1)},tt=[],et=y(Z,X,tt,!1,null,null,null,null);const st=et.exports,it=b.extend({components:{DownloadTo:L},props:{url:String,downloadMethod:String,isCollectioned:Boolean,item:Object},methods:{copyLinkToClipboard(){this.$emit("copyLinkToClipboard")},showSiteContentMenus(i){this.$emit("showSiteContentMenus",this.item,i)},saveTorrentFile(){this.$emit("saveTorrentFile",this.item)},addToCollection(){this.$emit("addToCollection",this.item)},deleteCollection(){this.$emit("deleteCollection",this.item)},downloadSuccess(i){this.$emit("downloadSuccess",i)},downloadError(i){this.$emit("downloadError",i)}}});var rt=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"torrent-actions"},[e("DownloadTo",{staticClass:"mx-0",attrs:{downloadOptions:t.item,flat:"",icon:"",small:"",mini:t.$vuetify.breakpoint.smAndDown,color:"grey darken-1"},on:{error:t.downloadError,success:t.downloadSuccess}}),e("v-btn",{class:t.$vuetify.breakpoint.mdAndUp?"mx-0":"mx-0 btn-mini",attrs:{flat:"",icon:"",small:"",color:"grey darken-1"}},[e("v-icon",{attrs:{small:"",title:t.$t("searchTorrent.copyToClipboardTip")},on:{click:t.copyLinkToClipboard}},[t._v("file_copy")])],1),t.downloadMethod=="POST"?e("v-btn",{class:t.$vuetify.breakpoint.mdAndUp?"mx-0":"mx-0 btn-mini",attrs:{flat:"",icon:"",small:"",color:"grey darken-1"}},[e("v-icon",{attrs:{small:"",title:t.$t("searchTorrent.saveTip")},on:{click:function(s){return s.stopPropagation(),t.saveTorrentFile.apply(null,arguments)}}},[t._v("save")])],1):e("v-btn",{class:t.$vuetify.breakpoint.mdAndUp?"mx-0":"mx-0 btn-mini",attrs:{flat:"",icon:"",small:"",href:t.url,target:"_blank",rel:"noopener noreferrer nofollow",title:t.$t("searchTorrent.saveTip"),color:"grey darken-1"}},[e("v-icon",{attrs:{small:""}},[t._v("save")])],1),t.isCollectioned?e("v-btn",{class:t.$vuetify.breakpoint.mdAndUp?"mx-0":"mx-0 btn-mini",attrs:{flat:"",icon:"",small:"",color:"pink",title:t.$t("collection.remove")},on:{click:t.deleteCollection}},[e("v-icon",{attrs:{small:""}},[t._v("favorite")])],1):e("v-btn",{class:t.$vuetify.breakpoint.mdAndUp?"mx-0":"mx-0 btn-mini",attrs:{flat:"",icon:"",small:"",color:"grey darken-1",title:t.$t("collection.add")},on:{click:t.addToCollection}},[e("v-icon",{attrs:{small:""}},[t._v("favorite_border")])],1)],1)},at=[],ot=y(it,rt,at,!1,null,null,null,null);const nt=ot.exports,A=new k,lt=b.extend({components:{DownloadTo:L},data(){return{dialog:!1,verified:!1,baseTorrent:null,loading:!1,verifiedItems:[],downloadOptions:null,creating:!1,errorMsg:"",haveError:!1,haveSuccess:!1,successMsg:"",verifiedCount:0}},props:{label:String,color:String,items:{type:Array,default:()=>[]}},mounted(){},watch:{dialog(){this.dialog&&this.start()},successMsg(){this.haveSuccess=this.successMsg!=""},errorMsg(){this.haveError=this.errorMsg!=""}},methods:{deleteVerifiedItem(i){this.$delete(this.verifiedItems,i)},setDownloadOptions(i){console.log(i),this.downloadOptions=i.downloadOptions},create(){if(this.verifiedItems.length==0||!this.downloadOptions)return;this.creating=!0;let i={title:this.verifiedItems[0].data.title,size:this.verifiedItems[0].data.size,downloadOptions:this.downloadOptions,items:[]},t=[];if(this.verifiedItems.forEach(e=>{if(e.verified){let s=v.clone(e);s.data.site&&(s.data.host=s.data.site.host,delete s.data.site),["author","category","comments","completed","entryName","status","tags","titleHTML","progress","seeders","leechers"].forEach(r=>{s.data.hasOwnProperty(r)&&delete s.data[r]}),t.push(s.data)}}),t.length==0){this.errorMsg=this.$t("keepUploadTask.noItem").toString(),this.creating=!1;return}i.items=t,console.log(i),A.sendRequest(c.createKeepUploadTask,null,i).then(e=>{this.successMsg=this.$t("keepUploadTask.createSuccess").toString(),setTimeout(()=>{this.creating=!1,this.dialog=!1},3e3),console.log("createKeepUploadTask",e),this.$root.$emit("KeepUploadTaskCreateSuccess")}).catch(()=>{this.creating=!1,this.errorMsg=this.$t("keepUploadTask.createError").toString()})},start(){this.baseTorrent=null,this.verifiedItems=[],this.verifiedCount=0,this.downloadOptions=null,this.clearMessage(),this.items.forEach((i,t)=>{i.url&&(this.verifiedItems.push({data:i,torrent:null,loading:!0,verified:!1,status:this.$t("keepUploadTask.status.downloading").toString()}),this.getTorrent(i.url,t).then(e=>{this.verification(e,t)}).catch(()=>{this.verification(null,t)}))})},reDownload(i){this.verifiedItems[i].loading=!0,this.verifiedItems[i].status=this.$t("keepUploadTask.status.downloading").toString(),this.getTorrent(this.verifiedItems[i].data.url,i).then(t=>{this.verification(t,i)}).catch(()=>{this.verification(null,i)})},verification(i,t){if(t==0)this.baseTorrent||(this.baseTorrent=i,this.verifiedItems[0].loading=!1,i?(this.verifiedItems[0].torrent=this.baseTorrent.torrent,this.verifiedItems[0].verified=!0,this.verifiedItems[0].status=this.$t("keepUploadTask.status.downloaded").toString(),this.verifiedCount++):this.verifiedItems[0].verified=!1);else{if(this.verifiedItems[0].loading){setTimeout(()=>{this.verification(i,t)},200);return}let e={verified:!1,torrent:null,loading:!1};if(this.verifiedItems[0].verified||(e.status=this.$t("keepUploadTask.status.failed").toString()),!i||!this.verifiedItems[0].verified){this.verifiedItems[t]=Object.assign(this.verifiedItems[t],e);return}const s=i.torrent,r=this.baseTorrent.torrent;s.name==r.name&&s.length==r.length&&s.files.length==r.files.length&&(e.verified=r.files.every((a,o)=>{const n=s.files[o];return n.path==a.path&&n.length==a.length})),e.torrent=s,e.verified&&this.verifiedCount++,e.status=e.verified?this.$t("keepUploadTask.status.success").toString():this.$t("keepUploadTask.status.failed").toString(),!e.verified&&s.name==r.name&&s.length<=r.length&&s.files.length<=r.files.length&&s.files.every(a=>r.files.find(o=>a.path==o.path&&a.length==o.length))&&(s.files.length==r.files.length?e.status=this.$t("keepUploadTask.status.incorrectOrder").toString():e.status=this.$t("keepUploadTask.status.missingFiles").toString()),this.verifiedItems[t]=Object.assign(this.verifiedItems[t],e)}},getTorrent(i,t){return new Promise((e,s)=>{A.sendRequest(c.getTorrentDataFromURL,null,{url:i,parseTorrent:!0}).then(r=>{console.log(r),this.verifiedItems[t].status=this.$t("keepUploadTask.status.waiting").toString(),e(r)}).catch(r=>{this.verifiedItems[t].status=this.$t("keepUploadTask.status.downloadFailed").toString(),this.verifiedItems[t].error=!0,s(r)})})},clearMessage(){this.successMsg="",this.errorMsg=""},addToVerified(i){window.confirm(this.$t("keepUploadTask.addToKeepUploadConfirm").toString())&&(i.verified=!0,this.verifiedCount++)}}});var ct=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("v-dialog",{attrs:{persistent:"",scrollable:"","max-width":"1024",fullscreen:t.$vuetify.breakpoint.smAndDown},scopedSlots:t._u([{key:"activator",fn:function({on:s}){return[e("v-btn",t._g({class:t.$vuetify.breakpoint.smAndUp?"":"mini",attrs:{dark:"",small:"",title:t.$t("keepUploadTask.keepUpload"),color:t.color}},s),[e("v-icon",{attrs:{small:""}},[t._v("merge_type")]),e("span",{staticClass:"ml-2"},[t._v(t._s(t.label||t.$t("keepUploadTask.keepUpload")))])],1)]}}]),model:{value:t.dialog,callback:function(s){t.dialog=s},expression:"dialog"}},[e("v-card",[e("v-toolbar",{attrs:{dark:"",color:"blue-grey darken-2"}},[e("v-toolbar-title",[t._v(t._s(t.$t("keepUploadTask.verification")))]),e("v-spacer"),e("v-btn",{attrs:{icon:"",flat:"",color:"success",href:"https://github.com/pt-plugins/PT-Plugin-Plus/wiki/keep-upload-task",target:"_blank",rel:"noopener noreferrer nofollow",title:t.$t("common.help")}},[e("v-icon",[t._v("help")])],1)],1),e("v-card-text",{staticStyle:{"max-height":"80vh"}},[e("v-list",{attrs:{"two-line":"",subheader:"",dense:""}},[t._l(t.verifiedItems,function(s,r){return[r==0?e("v-subheader",{key:r},[t._v(t._s(t.$t("keepUploadTask.baseTorrent")))]):t._e(),r==1?e("v-subheader",{key:r},[t._v(t._s(t.$t("keepUploadTask.otherTorrent")))]):t._e(),e("v-list-tile",{key:s.title},[e("v-list-tile-avatar",[e("v-avatar",{attrs:{size:"18"}},[e("img",{attrs:{src:s.data.site.icon}})])],1),e("v-list-tile-content",[e("v-list-tile-title",{staticClass:"list-item"},[e("a",{attrs:{href:s.data.link,target:"_blank",rel:"noopener noreferrer nofollow"}},[t._v(t._s(s.data.title))])]),e("v-list-tile-sub-title",[t._v(t._s(t.$t("keepUploadTask.size"))+t._s(t._f("formatSize")(s.data.size))+", "+t._s(t.$t("keepUploadTask.fileCount"))+t._s(s.torrent?s.torrent.files.length:"N/A")+", "+t._s(t.$t("keepUploadTask.status.label"))+t._s(s.status))])],1),e("v-list-tile-action",[e("div",[t.verifiedItems[0].verified&&!s.loading&&!s.verified&&r>0?e("v-btn",{staticClass:"mr-1",attrs:{icon:"",title:t.$t("keepUploadTask.addToKeepUpload")},on:{click:function(a){return a.stopPropagation(),t.addToVerified(s)}}},[e("v-icon",{attrs:{color:"info"}},[t._v("add")])],1):t._e(),t.verifiedItems[0].verified&&!s.loading&&!s.torrent&&r>0?e("v-btn",{staticClass:"mr-1",attrs:{icon:"",title:t.$t("keepUploadTask.redownload")},on:{click:function(a){return a.stopPropagation(),t.reDownload(r)}}},[e("v-icon",{attrs:{color:"green"}},[t._v("sync")])],1):t._e(),e("v-btn",{attrs:{icon:"",loading:s.loading,title:s.status}},[s.verified?e("v-icon",{attrs:{color:"success"}},[t._v("done_all")]):e("v-icon",{attrs:{color:"error",title:t.$t("keepUploadTask.removeFromKeepUpload")},on:{click:function(a){return a.stopPropagation(),t.deleteVerifiedItem(r)}}},[t._v("clear")])],1)],1)])],1),r>0?e("v-divider",{key:"d"+r,attrs:{inset:""}}):t._e()]})],2)],1),t.$vuetify.breakpoint.smAndDown?e("v-divider"):t._e(),t.$vuetify.breakpoint.smAndDown&&t.downloadOptions?e("div",{staticClass:"caption ml-1 py-2"},[t._v(" "+t._s(t.$t("keepUploadTask.savePath"))+t._s(t.downloadOptions?`${t.downloadOptions.clientName} -> ${t.downloadOptions.savePath}`:"")+" ")]):t._e(),e("v-divider"),e("v-card-actions",[t.verifiedCount>1?[e("DownloadTo",{attrs:{flat:"","get-options-only":"",small:"",label:t.$vuetify.breakpoint.smAndDown?t.$t("keepUploadTask.setSavePath"):t.downloadOptions?`${t.downloadOptions.clientName} -> ${t.downloadOptions.savePath}`:t.$t("keepUploadTask.setSavePath"),downloadOptions:t.items[0]},on:{itemClick:t.setDownloadOptions}}),t.downloadOptions&&t.verifiedItems.length>0?e("v-btn",{attrs:{flat:"",small:"",loading:t.creating,color:"info"},on:{click:t.create}},[e("v-icon",{attrs:{small:""}},[t._v("date_range")]),e("span",{staticClass:"ml-2"},[t._v(t._s(t.$t("keepUploadTask.create")))])],1):t._e()]:t._e(),e("v-spacer"),e("v-btn",{attrs:{color:"error",flat:""},on:{click:function(s){t.dialog=!1}}},[t._v(t._s(t.$t("common.close")))])],2)],1),e("v-snackbar",{attrs:{top:"",timeout:3e3,color:"error"},model:{value:t.haveError,callback:function(s){t.haveError=s},expression:"haveError"}},[t._v(t._s(t.errorMsg))]),e("v-snackbar",{attrs:{bottom:"",timeout:3e3,color:"success"},model:{value:t.haveSuccess,callback:function(s){t.haveSuccess=s},expression:"haveSuccess"}},[t._v(t._s(t.successMsg))])],1)},ht=[],dt=y(lt,ct,ht,!1,null,"c87c2d5c",null,null);const ut=dt.exports,g=new k,ft=b.extend({components:{MovieInfoCard:W,TorrentProgress:J,Actions:nt,AddToCollectionGroup:st,KeepUpload:ut},data(){return{allSitesKey:"allSites",key:"",host:"",options:this.$store.state.options,getters:this.$store.getters,searchMsg:"",datas:[],getLinks:[],selected:[],pagination:{page:1,rowsPerPage:100,descending:!1,sortBy:""},loading:!1,errorMsg:"",haveError:!1,haveSuccess:!1,successMsg:"",currentSite:{},skipSites:"",beginTime:null,reloadCount:0,searchQueue:[],searchTimer:0,searchResult:{sites:{},tags:{},categories:{},failedSites:[],noResultsSites:[]},checkBox:!0,downloading:{count:0,completed:0,speed:0,progress:0},latestTorrentsKey:"__LatestTorrents__",latestTorrentsOnly:!1,searchSiteCount:0,sending:{count:0,completed:0,speed:0,progress:0},showCategory:!1,titleMiddleEllipsis:!1,fixedTable:!1,siteContentMenus:{},clientContentMenus:[],filterKey:"",filteredDatas:[],showFailedSites:!1,showNoResultsSites:!1,pathHandler:new K,IMDbId:"",downloadFailedTorrents:[],lastCheckedIndex:-1,shiftKey:!1,searchPayload:{},torrentCollectionLinks:[],headerOrderClickCount:0,currentOrderMode:p.asc,rawDatas:[],toolbarClass:"mt-3",toolbarIsFixed:!1}},created(){this.options.system||this.writeLog({event:"SearchTorrent.init",msg:this.$t("searchTorrent.optionsIsMissing").toString()}),this.pagination=this.$store.getters.pagination(T.searchTorrent,{rowsPerPage:100});let i=this.$store.getters.viewsOptions(w.searchTorrent,{checkBox:!0,showCategory:!1,titleMiddleEllipsis:!1});Object.assign(this,i),this.loadTorrentCollections()},mounted(){C.$on("searchTorrent",this.eventSearchTorrent);const i="mousedown.torrentSearch",t="mouseUp.torrentSearch";$(".search-torrent").off(i),$(".search-torrent").off(t),$(".search-torrent").on(i,e=>{this.shiftKey=e.shiftKey||!1}),$(".search-torrent").on(t,e=>{this.shiftKey=!1}),window.addEventListener("scroll",this.handleScroll),this.$root.$on("KeepUploadTaskCreateSuccess",()=>{this.toggleAll()})},destroyed(){window.removeEventListener("scroll",this.handleScroll),C.$off("searchTorrent",this.eventSearchTorrent)},beforeRouteUpdate(i,t,e){i.params.key&&(this.key=i.params.key,this.host=i.params.host,e())},activated(){this.$route.params.key&&(this.key=this.$route.params.key),this.host=this.$route.params.host,this.loadTorrentCollections(),this.handleScroll()},watch:{key(i,t){i&&i!=t&&(console.log("watch search key",i,t),this.doSearch())},host(i,t){i&&i!=t&&(console.log("watch search host",i,t),this.doSearch())},successMsg(){this.haveSuccess=this.successMsg!=""},errorMsg(){this.haveError=this.errorMsg!=""},"$store.state.options.defaultSearchSolutionId"(i,t){console.log("watch search defaultSearchSolutionId",i,t),i!=t&&(this.$store.state.options.autoSearchWhenSwitchSolution?this.doSearch():console.log("切换搜索方案 - 跳过搜索, 可在 常规设置 - 搜索 中开启自动搜索"))},loading(){this.$store.commit("updateSearchStatus",this.loading)},pagination:{handler(){this.pagination.descending?this.currentOrderMode=p.desc:this.currentOrderMode=p.asc,this.updatePagination(this.pagination)},deep:!0},currentOrderMode(){this.pagination.descending=this.currentOrderMode===p.desc},checkBox(){this.checkBox===!1&&(this.selected=[])}},methods:{eventSearchTorrent(i){console.log("Event: searchTorrent",i),this.doSearch()},writeLog(i){g.sendRequest(c.writeLog,null,{module:F.options,event:i.event,msg:i.msg,data:i.data})},doSearch(i){clearTimeout(this.searchTimer);let t;i&&(t=this.clone(i)),this.searchTimer=window.setTimeout(()=>{this.search(t)},220)},reset(){this.selected=[],this.clearMessage(),this.datas=[],this.rawDatas=[],this.getLinks=[],this.searchResult={sites:{},tags:{},categories:{},failedSites:[],noResultsSites:[]},this.filterKey="",this.searchPayload={}},search(i){if(this.loading||!this.key)return;if(this.reset(),window.location.protocol==="http:"){$.getJSON(`http://${window.location.hostname}:8001/test/searchData.json`).done(a=>{a&&this.addSearchResult(a)});return}if(!this.options.system){if(this.reloadCount>=10){this.errorMsg=this.$t("searchTorrent.optionsIsMissingErrorMsg").toString(),this.writeLog({event:"SearchTorrent.init",msg:this.errorMsg});return}setTimeout(()=>{this.search()},200),this.reloadCount++;return}if(!this.options.sites){this.errorMsg=this.$t("searchTorrent.sitesIsMissing").toString();return}if(/(show-snapshot)-([a-z0-9]{32})/.test(this.key)){let a=this.key.match(/(show-snapshot)-([a-z0-9]{32})/);if(a){this.loadSearchResultSnapshot(a[2]);return}}i&&(this.searchPayload=i);let t={id:"",cn:"",en:"",key:this.key};if(this.key.indexOf("|")!==-1){let a=(this.key+"||").split("|");t.id=a[0],t.cn=a[1],t.en=a[2],t.key=a[3],/(douban\d+)/.test(t.id)?this.searchPayload.doubanId=t.id.match(/douban(\d+)/)[1]:this.searchPayload.imdbId=t.id,this.searchPayload.cn=t.cn,this.searchPayload.en=t.en,this.searchPayload.key=t.key}if(/(douban\d+)/.test(this.key)){this.searchPayload.doubanId=this.key.match(/douban(\d+)/)[1],this.getIMDbIdFromDouban(this.key).then(a=>{typeof a=="string"?(this.searchPayload.imdbId=a,this.key=a,this.search(this.searchPayload)):t.cn?(this.key=t.cn,this.search(this.searchPayload)):(this.errorMsg=this.$t("searchTorrent.doubanIdConversionFailed").toString(),this.searchMsg=this.errorMsg,this.loading=!1)}).catch(a=>{t.cn?(this.key=t.cn,this.search(this.searchPayload)):(this.errorMsg=a||this.$t("searchTorrent.doubanIdConversionFailed").toString(),this.searchMsg=this.errorMsg,this.loading=!1)});return}let e=[],s=[];this.skipSites="",this.key===this.latestTorrentsKey?this.latestTorrentsOnly=!0:this.latestTorrentsOnly=!1,this.options=this.$store.state.options;let r=this.options.defaultSearchSolutionId;if(/^[a-z0-9]{32}$/.test(this.host)?(r=this.host,this.host=""):this.host==="all"&&(r="all",this.host=""),this.host){let a=this.options.sites.find(o=>o.host===this.host&&!o.offline);a&&e.push(this.clone(a))}else if(r&&this.options.searchSolutions&&r!="all"){let a=[];this.options.sites.forEach(n=>{if(n.offline)return!1;a.push(this.clone(n))});let o=this.options.searchSolutions.find(n=>n.id===r);o&&o.range.forEach(n=>{let h=a.findIndex(d=>d.host===n.host);if(h>-1){let d=a[h],u=d.searchEntry;u&&(u.forEach((_,l)=>{u[l].enabled=!1}),n.entry&&n.entry.forEach(_=>{let l=u.findIndex(S=>S.id==_||S.name==_);u[l]&&u[l].name&&(u[l].enabled=!0)})),e.push(d)}})}else this.options.sites.forEach(a=>{if(a.offline)return!1;if(a.allowSearch||r=="all"){let o=this.getSiteSchema(a);o&&o.searchEntry&&o.searchEntry.length>0?e.push(this.clone(a)):a.searchEntry&&a.searchEntry.length>0?e.push(this.clone(a)):s.push(a.name)}});if(s.length>0&&(this.skipSites=this.$t("searchTorrent.skipSites").toString()+s.join(",")),e.length===0){this.errorMsg=this.$t("searchTorrent.noAllowSearchSites").toString();return}if(this.searchSiteCount=e.length,this.beginTime=m(),this.writeLog({event:"SearchTorrent.Search.Start",msg:this.$t("searchTorrent.searchStartMsg",{count:e.length}).toString(),data:{key:this.key}}),this.$store.dispatch("saveConfig",{lastSearchKey:this.searchPayload.key||this.key}),this.pagination.page=1,/(tt\d+)/.test(this.key)){let a=this.key.match(/(tt\d+)/);a&&a.length>=2&&(this.key=a[1]),this.IMDbId=this.key}else this.IMDbId="";this.doSearchTorrentWithQueue(e)},doSearchTorrentWithQueue(i){this.loading=!0,this.searchMsg=this.$t("searchTorrent.searching").toString();const t=i.filter(e=>!(e.searchEntryConfig&&e.searchEntryConfig.skipNonLatinCharacters&&!this.key.match(/^[\p{Script_Extensions=Latin}\p{Script_Extensions=Common}]+$/gu)||this.IMDbId&&e.searchEntryConfig&&e.searchEntryConfig.skipIMDbId));if(t.length===0){this.loading=!1,this.searchMsg=this.$t("searchTorrent.searchFinished",{count:this.datas.length,second:m().diff(this.beginTime,"second",!0)}).toString(),this.loading=!1,this.writeLog({event:"SearchTorrent.Search.Finished",msg:this.searchMsg,data:{key:this.key}});return}t.forEach((e,s)=>{this.searchQueue.push({site:e,key:this.key}),this.writeLog({event:"SearchTorrent.Search.Processing",msg:this.$t("searchTorrent.siteIsSearching",{siteName:e.name}).toString(),data:{host:e.host,name:e.name,key:this.key}}),this.sendSearchRequest(v.clone(e))})},sendSearchRequest(i){g.sendRequest(c.getSearchResult,null,{key:this.latestTorrentsOnly?"":this.key,site:i,payload:this.searchPayload}).then(t=>{if(t&&t.length){this.writeLog({event:`SearchTorrent.Search.Done[${i.name}]`,msg:this.$t("searchTorrent.siteIsSearchDone",{siteName:i.name,count:t.length}).toString(),data:{host:i.host,name:i.name,key:this.key}}),this.addSearchResult(t);return}else t&&t.msg?(this.writeLog({event:"SearchTorrent.Search.Error1",msg:t.msg,data:{host:i.host,name:i.name,key:this.key}}),this.errorMsg=t.msg):t&&t.statusText=="abort"?this.errorMsg=this.$t("searchTorrent.siteSearchAbort",{host:i.host}).toString():(t&&t.statusText=="timeout"?this.errorMsg=this.$t("searchTorrent.siteSearchTimeout",{host:i.host}).toString():this.errorMsg=this.$t("searchTorrent.siteSearchError",{host:i.host}).toString(),this.writeLog({event:"SearchTorrent.Search.Error2",msg:this.errorMsg,data:{host:i.host,name:i.name,key:this.key,result:t}}));this.searchResult.failedSites.push({site:i,msg:this.errorMsg,color:"orange darken-1"})}).catch(t=>{console.log(t),t.msg&&(this.errorMsg=t.msg),this.writeLog({event:"SearchTorrent.Search.Error3",msg:t.msg,data:t}),t.data&&t.data.isLogged==!1?this.searchResult.failedSites.push({site:i,url:i.url,msg:this.$t("searchTorrent.notLogged").toString(),color:"grey"}):t.type===O.error?this.searchResult.failedSites.push({site:i,url:i.url,msg:t.msg||t.data||t,color:"grey"}):this.searchResult.noResultsSites.push({site:i,msg:t.msg||t.data||t,color:"light-blue darken-2"})}).finally(()=>{this.removeQueue(i)})},abortSearch(i){g.sendRequest(c.abortSearch,null,{key:this.key,site:i}).then(()=>{this.writeLog({event:"SearchTorrent.Search.Abort",msg:this.$t("searchTorrent.siteSearchAbort",{host:i.name}).toString()})}).catch(()=>{this.writeLog({event:"SearchTorrent.Search.Abort.Error",msg:this.$t("searchTorrent.siteSearchAbortError",{host:i.name}).toString()}),this.removeQueue(i)})},removeQueue(i){let t=this.searchQueue.findIndex(e=>e.site.host===i.host);t!==-1&&(this.searchQueue.splice(t,1),this.searchQueue.length==0&&(this.searchMsg=this.$t("searchTorrent.searchFinished",{count:this.datas.length,second:m().diff(this.beginTime,"second",!0)}).toString(),this.loading=!1,this.writeLog({event:"SearchTorrent.Search.Finished",msg:this.searchMsg,data:{key:this.key}})))},createSearchResultSnapshot(){g.sendRequest(c.createSearchResultSnapshot,null,{key:this.key,searchPayload:this.searchPayload,result:this.rawDatas}).then(i=>{this.successMsg=this.$t("searchResultSnapshot.createSuccess").toString(),console.log("createSearchResultSnapshot",i)}).catch(()=>{this.errorMsg=this.$t("searchResultSnapshot.createError").toString()})},loadSearchResultSnapshot(i){this.loading=!0,g.sendRequest(c.getSearchResultSnapshot,null,i).then(t=>{console.log("loadSearchResultSnapshot",t),this.key=t.key,this.searchPayload=t.searchPayload,this.searchPayload&&this.searchPayload.imdbId?this.IMDbId=this.searchPayload.imdbId:/^(tt\d+)$/.test(this.key)?this.IMDbId=this.key:this.IMDbId="",this.addSearchResult(v.clone(t.result)),this.searchMsg=this.$t("searchResultSnapshot.snapshotTime",{time:m(t.time).format("YYYY-MM-DD hh:mm:ss")}).toString(),setTimeout(()=>{this.loading=!1},300)})},addSearchResult(i){let t=this.allSitesKey;this.searchResult.sites[t]||(this.searchResult.sites[t]=[]),i.forEach(e=>{let s=v.clone(e);if(s.site&&(s.host=s.site.host,delete s.site),this.rawDatas.push(s),e.link=e.link.replace("://","****").replace(/\/\//g,"/").replace("****","://"),this.getLinks.includes(e.link))return;if(!e.site){let a=e.host||"";if(e.site=v.getSiteFromHost(a,this.options),!e.site)return}if(!e.progress&&!e.status&&e.site&&e.site.user&&e.site.user.seedingList&&e.site.user.seedingList.some(n=>e.id&&e.id==n)&&(e.progress=100,e.status=2),m(e.time).isValid()){let a=e.time+"";/^(\d){10}$/.test(a+"")?e.time=parseInt(a)*1e3:e.time=m(a).valueOf(),e.time=v.transformTime(e.time,e.site.timezoneOffset)}else if(typeof e.time=="string"){let a=x.timeAgoToNumber(e.time);a>0&&(e.time=a)}e.titleHTML||(e.titleHTML=e.title),e.title=$("<span/>").html(e.titleHTML).text().trim(),e.size&&(e.size=this.fileSizetoLength(e.size)),e.seeders&&typeof e.seeders=="string"&&(e.seeders=parseInt(e.seeders.replace(",","")),isNaN(e.seeders)&&(e.seeders=0)),e.leechers&&typeof e.leechers=="string"&&(e.leechers=parseInt(e.leechers.replace(",","")),isNaN(e.leechers)&&(e.leechers=0)),e.completed&&typeof e.completed=="string"&&(e.completed=parseInt(e.completed.replace(",","")),isNaN(e.completed)&&(e.completed=0)),e.url&&(e.url=e.url.replace("://","****").replace(/\/\//g,"/").replace("****","://")),this.datas.push(e),this.getLinks.push(e.link),this.searchMsg=this.$t("searchTorrent.searchProgress",{count:this.datas.length}).toString();let r=e.site.name;this.searchResult.sites[r]||(this.searchResult.sites[r]=[]),this.searchResult.sites[r].push(e),this.addTagResult(e),this.addCategoryResult(e)}),this.searchResult.sites[t]=this.datas.sort((e,s)=>e.title.localeCompare(s.title,void 0,{sensitivity:"base"}))},addTagResult(i){let t=this.$t("searchTorrent.noTag").toString();if(this.searchResult.tags[t]||(this.searchResult.tags[t]={tag:{name:t,color:"blue-grey darken-2"},items:[]}),i.tags==null||i.tags==null||!i.tags.length){this.searchResult.tags[t].items.push(i);return}i.tags.forEach(e=>{let s=e.name;s&&(this.searchResult.tags[s]||(this.searchResult.tags[s]={tag:e,items:[]}),this.searchResult.tags[s].items.push(i))})},addCategoryResult(i){if(!i.category)return;let t="";typeof i.category=="string"?(t=i.category,i.category={name:t}):t=i.category.name,t&&(this.searchResult.categories[t]||(this.searchResult.categories[t]={name:t,items:[]}),this.searchResult.categories[t].items.push(i))},fileSizetoLength(i){if(typeof i=="number")return i;let t=i.replace(/,/g,"").trim().match(/^(\d*\.?\d+)(.*[^ZEPTGMK])?([ZEPTGMK](B|iB))$/i);if(t){let e=parseFloat(t[1]),s=t[3];switch(!0){case/Zi?B/i.test(s):return e*Math.pow(2,70);case/Ei?B/i.test(s):return e*Math.pow(2,60);case/Pi?B/i.test(s):return e*Math.pow(2,50);case/Ti?B/i.test(s):return e*Math.pow(2,40);case/Gi?B/i.test(s):return e*Math.pow(2,30);case/Mi?B/i.test(s):return e*Math.pow(2,20);case/Ki?B/i.test(s):return e*Math.pow(2,10);default:return e}}return 0},getSiteSchema(i){let t={};return typeof i.schema=="string"&&(t=this.options.system&&this.options.system.schemas&&this.options.system.schemas.find(e=>e.name==i.schema)),t},sendToClient(i,t,e,s,r="",a){console.log(i),this.clearMessage();let o=x.parseURL(i).host,n=this.options.sites.find(l=>l.cdn&&l.cdn.findIndex(D=>D.indexOf(o)>-1)>-1?!0:l.host===o),h={},d="";e?(h=e.client,d=e.path):(h=this.getters.clientOptions(n),d=this.getters.siteDefaultPath(n));let u=this.pathHandler.getSavePath(d,n);if(u===!1){this.errorMsg=this.$t("searchTorrent.userCanceled").toString();return}this.haveSuccess=!0,this.successMsg=this.$t("searchTorrent.seedingTorrent").toString();let _={url:i,title:t,savePath:u,autoStart:h.autoStart,tagIMDb:h.tagIMDb,clientId:h.id,link:r,imdbId:a};this.writeLog({event:"SearchTorrent.sendTorrentToClient",msg:this.$t("searchTorrent.sendTorrentToClient").toString(),data:_}),g.sendRequest(c.sendTorrentToClient,null,_).then(l=>{console.log("命令执行完成",l),l.type=="success"?(this.successMsg=l.msg,this.writeLog({event:"SearchTorrent.sendTorrentToClient.Success",msg:this.$t("searchTorrent.sendTorrentToClientSuccess").toString(),data:l})):(this.errorMsg=l.msg,this.writeLog({event:"SearchTorrent.sendTorrentToClient.Error",msg:this.$t("searchTorrent.sendTorrentToClientError").toString(),data:l})),s&&s()}).catch(l=>{this.writeLog({event:"SearchTorrent.sendTorrentToClient.Error",msg:this.$t("searchTorrent.sendTorrentToClientError").toString(),data:l}),this.errorMsg=l.msg,s&&s()})},updatePagination(i){console.log(i),this.$store.dispatch("updatePagination",{key:T.searchTorrent,options:i})},getRandomString(i=16,t=!0){let e=t?"abcdefhijkmnprstwxyz2345678ABCDEFGHJKMNPQRSTWXYZ":"abcdefghijkmnopqrstuvwxyz0123456789ABCDEFGHIJKMNOPQRSTUVWXYZ",s=e.length,r=[];for(let a=0;a<i;a++)r.push(e.charAt(Math.floor(Math.random()*s)));return r.join("")},resetDatas(i){this.loading||i.length&&(this.pagination.page=1,this.datas=i,this.selected=[])},downloadSelected(){let i=[];if(this.selected.forEach(t=>{t.url&&i.push({url:t.url,fileName:`[${t.site.name}][${t.title}].torrent`,method:t.site.downloadMethod,timeout:this.options.connectClientTimeout})}),console.log(i),i.length){if(i.length>1&&!confirm(this.$t("searchTorrent.multiDownloadConfirm").toString()))return;this.downloadTorrentFiles(i)}},downloadTorrentFiles(i){this.downloading.count=i.length,this.downloading.completed=0,this.downloading.speed=0,this.downloading.progress=0,new z({files:i,autoStart:!0,tagIMDb:!0,onCompleted:t=>{this.downloadTorrentFilesCompleted(t)},onError:(t,e)=>{this.downloadTorrentFilesCompleted(),this.writeLog({event:"SearchTorrent.downloadSelected.Error",msg:this.$t("searchTorrent.downloadSelectedError",{name:t.fileName}).toString(),data:e}),this.downloadFailedTorrents.findIndex(r=>r.url==t.url)==-1&&this.downloadFailedTorrents.push(t)}})},downloadTorrentFilesCompleted(i){if(this.downloading.completed++,this.downloading.progress=this.downloading.completed/this.downloading.count*100,this.downloading.completed>=this.downloading.count&&(this.downloading.count=0,this.selected=[]),i){for(let t=0;t<this.downloadFailedTorrents.length;t++)if(this.downloadFailedTorrents[t].url==i.url){this.downloadFailedTorrents.splice(t,1);break}}},saveTorrentFile(i){let t=M.GET;i.site&&(t=i.site.downloadMethod||M.GET);let e=this.processURLWithPrefix("m-teamdetail",i.site,i.url+""),s=new B({url:e,timeout:this.options.connectClientTimeout,fileName:`[${i.site.name}][${i.title}].torrent`});s.requestMethod=t,s.onError=r=>{},s.start()},sendSelectedToClient(i,t=0,e){if(i===void 0&&(i=[...this.selected],t=i.length,this.sending.count=t,this.sending.completed=0,this.sending.speed=0,this.sending.progress=0),i.length===0){this.sending.count=0;return}let s=i.shift();console.log(s.imdbId);let r=this.processURLWithPrefix("m-teamdetail",s.site,s.url);this.sendToClient(r,s.title,e,()=>{if(this.sending.completed++,this.sending.progress=this.sending.completed/this.sending.count*100,this.sending.completed>=this.sending.count){this.sending.count=0,this.selected=[];return}this.sendSelectedToClient(i,t,e)},s.link,s.imdbId)},copyLinkToClipboard(i){this.successMsg="",this.errorMsg="";var t=i.url;t=this.processURLWithPrefix("m-teamdetail",i.site,t),g.sendRequest(c.copyTextToClipboard,null,t).then(e=>{this.successMsg=this.$t("searchTorrent.copyLinkToClipboardSuccess").toString()}).catch(()=>{this.errorMsg=this.$t("searchTorrent.copyLinkToClipboardError").toString()})},getSelectedURLs(){let i=[];const t="m-teamdetail";return this.selected.forEach(e=>{var s=e.url;s=this.processURLWithPrefix(t,e.site,s),s&&i.push(s)}),i},processURLWithPrefix(i,t,e){if(e&&e.startsWith(i)){const s=e.substring(i.length);return v.resolveMTDownloadURL(s,t)}else return e},copySelectedToClipboard(){let i=this.getSelectedURLs();this.clearMessage(),g.sendRequest(c.copyTextToClipboard,null,i.join(`
`)).then(t=>{this.successMsg=this.$t("searchTorrent.copySelectedToClipboardSuccess",{count:i.length}).toString(),this.selected=[]}).catch(()=>{this.errorMsg=this.$t("searchTorrent.copyLinkToClipboardError").toString()})},clearMessage(){this.successMsg="",this.errorMsg="",this.haveSuccess=!1,this.haveError=!1},getSiteContentMenus(i){let t=[],e=[],s=i.host;if(!s)return[];if(this.siteContentMenus[s])return this.siteContentMenus[s];function r(a,o){a.forEach(n=>{t.push({client:o,path:n,host:i.host})})}return this.options.clients.forEach(a=>{if(e.push({client:a,path:"",host:i.host}),a.paths){for(const n in a.paths){let h=a.paths[n];n===i.host&&r(h,a)}let o=a.paths[I.allSite];o&&(t.length>0&&t.push({}),r(o,a))}}),t.length>0&&e.splice(0,0,{}),t=t.concat(e),this.siteContentMenus[s]=t,t},showSiteContentMenus(i,t){let e=this.getSiteContentMenus(i.site),s=[];e.forEach(r=>{r.client&&r.client.name?s.push({title:this.$t("searchTorrent.downloadTo",{path:`${r.client.name} -> ${r.client.address}`+(r.path?` -> ${this.pathHandler.replacePathKey(r.path,i.site)}`:"")}).toString(),fn:()=>{if(i.url){let a=this.processURLWithPrefix("m-teamdetail",i.site,i.url);this.sendToClient(a,i.title,r,null,i.link,i.imdbId)}}}):s.push({})}),console.log(e,s),R.show(s,t),$(".basicContext").css({left:"-=20px",top:"+=10px"})},showAllContentMenus(i){let t=[],e=[],s=this;function r(a){let o=s.$vuetify.breakpoint.xs?a.client.name:s.$t("searchTorrent.downloadTo",{path:`${a.client.name} -> ${a.client.address}`}).toString();a.path&&(o+=` -> ${a.path}`),e.push({title:o,fn:()=>{s.sendSelectedToClient(void 0,0,a)}})}this.clientContentMenus.length==0?(this.options.clients.forEach(a=>{t.push({client:a,path:""})}),t.forEach(a=>{if(a.client&&a.client.name){if(r(a),a.client.paths){let o=a.client.paths[I.allSite];o&&o.forEach(n=>{if(n.indexOf("$site.name$")==-1&&n.indexOf("$site.host$")==-1&&n.indexOf("<...>")==-1){let h=this.clone(a);h.path=n,r(h)}})}}else e.push({})}),this.clientContentMenus=e):e=this.clientContentMenus,R.show(e,i),$(".basicContext").css({left:"-=20px",top:"+=10px"})},reSearchWithSite(i){const t=this.options.sites.find(s=>s.host===i);if(!t)return;let e=this.searchResult.failedSites.findIndex(s=>s.site.host===i);e!==-1&&this.searchResult.failedSites.splice(e,1),e=this.searchResult.noResultsSites.findIndex(s=>s.site.host===i),e!==-1&&this.searchResult.noResultsSites.splice(e,1),this.doSearchTorrentWithQueue([t])},reSearchFailedSites(){if(this.searchResult.failedSites.length==0)return!1;let i=[];if(this.searchResult.failedSites.forEach(t=>{i.push(t.site)}),i.length===0){this.errorMsg=this.$t("searchTorrent.noReSearchSites").toString();return}this.searchResult.failedSites=[],this.beginTime=m(),this.writeLog({event:"SearchTorrent.Search.Start",msg:this.$t("searchTorrent.searchStartMsg",{count:i.length}).toString(),data:{key:this.key}}),this.doSearchTorrentWithQueue(i)},clone(i){return JSON.parse(JSON.stringify(i))},searchResultFilter(i,t){if(t=t.toString().toLowerCase(),this.filteredDatas=[],t.trim()==="")return i;let e=t.split(" ");return this.filteredDatas=i.filter(s=>{let r=(s.title+(s.subTitle||"")).toLowerCase(),a=!0;return e.forEach(o=>{o.trim()!=""&&(a=a&&r.indexOf(o)>-1)}),a}),this.filteredDatas},getIMDbIdFromDouban(i){let t=i.match(/douban(\d+)/);return t&&t.length>=2?(this.searchMsg=this.$t("searchTorrent.doubanIdConverting").toString(),g.sendRequest(c.getIMDbIdFromDouban,null,t[1])):new Promise((e,s)=>{s(this.$t("searchTorrent.invalidDoubanId").toString())})},reDownloadFailedTorrents(){this.downloadTorrentFiles(this.downloadFailedTorrents)},shiftCheck(i,t){if(this.lastCheckedIndex===-1){this.lastCheckedIndex=t;return}if(this.shiftKey){let e=t,s=this.lastCheckedIndex,r=Math.min(e,s),a=Math.max(e,s)+1,o=this.clone(this.filteredDatas.length>0?this.filteredDatas:this.datas);o=o.sort(this.arrayObjectSort(this.pagination.sortBy,this.pagination.descending?p.desc:p.asc));for(let n=r;n<a;n++){let h=o[n],d=this.selected.findIndex(u=>u.link===h.link);i?d===-1&&this.selected.push(h):d!==-1&&this.selected.splice(d,1)}}this.lastCheckedIndex=t},arrayObjectSort(i,t=p.asc){function e(s,r){return new Function("o","return o."+r)(s)}return function(s,r){var a=e(s,i),o=e(r,i);return a<o?t==p.desc?1:-1:a>o?t==p.desc?-1:1:0}},addSelectedToCollection(i){this.selected.forEach(t=>{t.url&&this.addToCollection(t,i)})},addToCollection(i,t){let e={title:i.title,url:i.url,link:i.link,host:i.site.host,size:i.size,subTitle:i.subTitle,movieInfo:{imdbId:this.IMDbId||this.searchPayload.imdbId,doubanId:this.searchPayload.doubanId}};t&&t.id&&(e.groups=[t.id]),g.sendRequest(c.addTorrentToCollection,null,e).then(s=>{this.loadTorrentCollections(),console.log(s)})},deleteCollection(i){g.sendRequest(c.deleteTorrentFromCollention,null,{link:v.getCleaningURL(i.link)}).then(t=>{this.loadTorrentCollections()})},loadTorrentCollections(){g.sendRequest(c.getAllTorrentCollectionLinks).then(i=>{this.torrentCollectionLinks=i})},isCollectioned(i){return this.torrentCollectionLinks.includes(v.getCleaningURL(i))},toggleAll(){this.selected.length>0?this.selected=[]:this.filteredDatas.length>0?this.selected=this.filteredDatas.slice():this.selected=this.datas.slice()},changeSort(i){this.pagination.sortBy===i?(this.pagination.descending=!this.pagination.descending,this.headerOrderClickCount++,this.headerOrderClickCount==2&&(this.pagination.sortBy="")):(this.headerOrderClickCount=0,this.pagination.sortBy=i,this.pagination.descending=!1)},getHeaderClass(i){let t=[];return t.push("column"),i.sortable!==!1&&(t.push("sortable"),t.push(this.pagination.descending?"desc":"asc"),i.value===this.pagination.sortBy&&t.push("active")),i.align&&t.push(`text-xs-${i.align}`),t},downloadSuccess(i){this.successMsg=i},downloadError(i){this.errorMsg=i},updateViewOptions(){this.$store.dispatch("updateViewOptions",{key:w.searchTorrent,options:{checkBox:this.checkBox,showCategory:this.showCategory,titleMiddleEllipsis:this.titleMiddleEllipsis}})},handleScroll(){const i=$("#divToolbar");if(!i||!i.offset())return;const e=$("#system-topbar").height(),s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,r=i.offset().top;if(s+e>r){this.toolbarClass="isFixedToolbar",this.toolbarIsFixed=!0;const a=$("#divToobarInner").height()||0;$("#divToobarHeight").height(a),$("#divToobarInner").css({top:e})}else this.toolbarIsFixed=!1,this.toolbarClass="mt-3"}},computed:{headers(){return[{text:this.$t("searchTorrent.headers.site"),align:"center",value:this.$store.state.options.searchResultOrderBySitePriority?"site.priority":"site.host",visible:this.$vuetify.breakpoint.mdAndUp},{text:this.$t("searchTorrent.headers.title"),align:"left",value:"title",visible:!0},{text:this.$t("searchTorrent.headers.category"),align:"center",value:"category.name",width:"150px",visible:this.$vuetify.breakpoint.width>1200},{text:this.$t("searchTorrent.headers.size"),align:"right",value:"size",width:"100px",visible:this.$vuetify.breakpoint.smAndUp},{text:this.$t("searchTorrent.headers.seeders"),align:"right",value:"seeders",width:"60px",visible:this.$vuetify.breakpoint.smAndUp},{text:this.$t("searchTorrent.headers.leechers"),align:"right",value:"leechers",width:"60px",visible:this.$vuetify.breakpoint.mdAndUp},{text:this.$t("searchTorrent.headers.completed"),align:"right",value:"completed",width:"60px",visible:this.$vuetify.breakpoint.mdAndUp},{text:this.$t("searchTorrent.headers.comments"),align:"right",value:"comments",width:"60px",visible:this.$vuetify.breakpoint.smAndUp},{text:this.$t("searchTorrent.headers.time"),align:"left",value:"time",width:"130px",visible:this.$vuetify.breakpoint.mdAndUp},{text:this.$t("searchTorrent.headers.action"),sortable:!1,width:this.$vuetify.breakpoint.mdAndUp?"130px":"80px",align:"center",visible:this.$vuetify.breakpoint.smAndUp}]},orderHeaders(){return this.headers.filter(i=>i.sortable!==!1)},orderMode(){return[{text:this.$t("common.orderMode.asc"),value:p.asc},{text:this.$t("common.orderMode.desc"),value:p.desc}]},indeterminate(){return this.selected.length>0&&this.selected.length<this.datas.length},selectedSize(){if(this.selected.length>0){let i=0;return this.selected.forEach(t=>{const e=t.size;e>0&&(i+=e)}),i}return 0}}});var gt=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"search-torrent"},[t.options.showMovieInfoCardOnSearch?e("MovieInfoCard",{attrs:{IMDbId:t.IMDbId,doubanId:t.searchPayload.doubanId}}):t._e(),e("v-alert",{staticStyle:{padding:"8px 16px"},attrs:{value:!0,type:"info"}},[t._v(" "+t._s(t.$t("searchTorrent.title"))+" ["+t._s(t.key)+"], "+t._s(t.searchMsg)+" "+t._s(t.skipSites)+" "),!t.loading&&t.key!=""?e("v-btn",{attrs:{flat:"",icon:"",small:"",color:"white",title:t.$t("searchTorrent.reSearch")},on:{click:function(s){return s.stopPropagation(),t.doSearch(t.searchPayload)}}},[e("v-icon",[t._v("cached")])],1):t._e(),t.searchResult.noResultsSites.length>0?e("v-btn",{staticClass:"mt-1",attrs:{flat:"",small:"",color:"white"},on:{click:function(s){s.stopPropagation(),t.showNoResultsSites=!t.showNoResultsSites}}},[e("v-icon",{staticClass:"mr-1",attrs:{small:"",color:"grey darken-2"}},[t._v("face")]),t._v(" "+t._s(t.$t("searchTorrent.noResultsSites"))+" "+t._s(t.searchResult.noResultsSites.length)+" ")],1):t._e(),t.searchResult.failedSites.length>0?e("v-btn",{staticClass:"mt-1",attrs:{flat:"",small:"",color:"white"},on:{click:function(s){s.stopPropagation(),t.showFailedSites=!t.showFailedSites}}},[e("v-icon",{staticClass:"mr-1",attrs:{small:"",color:"orange"}},[t._v("warning")]),t._v(" "+t._s(t.$t("searchTorrent.failedSites"))+" "+t._s(t.searchResult.failedSites.length)+" ")],1):t._e(),t.searchResult.failedSites.length>0&&t.showFailedSites?e("v-btn",{staticClass:"mt-1",attrs:{flat:"",small:"",color:"white"},on:{click:function(s){return s.stopPropagation(),t.reSearchFailedSites.apply(null,arguments)}}},[e("v-icon",{staticClass:"mr-1",attrs:{small:""}},[t._v("autorenew")]),t._v(" "+t._s(t.$t("searchTorrent.reSearchFailedSites"))+" ")],1):t._e()],1),t.searchQueue&&t.searchQueue.length?e("v-list",{attrs:{small:""}},[t._l(t.searchQueue,function(s,r){return[e("v-list-tile",{key:s.site.host},[e("v-list-tile-action",[e("v-progress-circular",{attrs:{size:18,width:2,indeterminate:"",color:"primary"}})],1),e("v-list-tile-content",[e("v-list-tile-title",[e("v-avatar",{staticClass:"mr-2",attrs:{size:"18"}},[e("img",{attrs:{src:s.site.icon}})]),t._v(" "+t._s(s.site.name)+" "+t._s(t.$t("searchTorrent.searching"))+" ")],1)],1),e("v-list-tile-action",{staticClass:"mr-5"},[e("v-icon",{attrs:{color:"red",title:t.$t("searchTorrent.cancelSearch")},on:{click:function(a){return t.abortSearch(s.site)}}},[t._v("cancel")])],1)],1),r+1<t.searchQueue.length?e("v-divider",{key:"line"+s.site.host+r}):t._e()]})],2):t._e(),e("v-card",[e("v-card-title",{staticStyle:{padding:"0 5px 0 3px"}},[e("v-flex",{attrs:{xs12:""}},[t.searchSiteCount>1?e("div",[t._l(t.searchResult.sites,function(s,r){return[e("v-chip",{key:r,staticClass:"mr-1 py-3 pl-1",attrs:{label:"",color:s.length?"blue-grey darken-2":"grey","text-color":"white",small:"",disabled:!s.length},on:{click:function(a){return a.stopPropagation(),t.resetDatas(s)}}},[r===t.allSitesKey?e("v-icon",{staticClass:"mr-1",attrs:{left:""}},[t._v("public")]):[s.length>0?e("v-avatar",{staticClass:"mr-1"},[e("img",{staticStyle:{width:"60%",height:"60%"},attrs:{src:s[0].site.icon}})]):e("v-avatar",{staticClass:"mr-1"},[e("img",{staticStyle:{width:"60%",height:"60%"},attrs:{src:s.site.icon}})])],e("span",[t._v(" "+t._s(r===t.allSitesKey?t.$t("searchTorrent.allSites"):r)+" ")]),e("v-chip",{staticClass:"ml-2 py-3",staticStyle:{"margin-right":"-13px"},attrs:{label:"",color:s.length?"blue-grey":"grey",small:"","text-color":"white",disabled:""}},[e("span",[t._v(t._s(s.length||s.msg))])])],2)]})],2):t._e(),t.searchResult.noResultsSites.length>0&&t.showNoResultsSites?e("div",[t._l(t.searchResult.noResultsSites,function(s,r){return[e("v-chip",{key:r,staticClass:"mr-1 py-3 pl-1",attrs:{label:"",color:"grey darken-1","text-color":"white",small:"",disabled:""}},[[e("v-avatar",{staticClass:"mr-1"},[e("img",{staticStyle:{width:"60%",height:"60%"},attrs:{src:s.site.icon}})])],s.site.activeURL||s.site.url?e("a",{attrs:{href:s.site.activeURL||s.site.url,rel:"noopener noreferrer nofollow",target:"_blank"}},[t._v(t._s(s.site.name))]):e("span",[t._v(t._s(s.site.name))]),e("v-chip",{staticClass:"ml-2 py-3 chip-compact",staticStyle:{"margin-right":"-13px"},attrs:{label:"",color:"grey",small:"","text-color":"white",disabled:""}},[e("span",[t._v(t._s(s.msg))]),e("v-btn",{attrs:{flat:"",icon:"",small:"",color:"grey lighten-2",title:t.$t("searchTorrent.reSearch")},on:{click:function(a){return a.stopPropagation(),t.reSearchWithSite(s.site.host)}}},[e("v-icon",{attrs:{small:""}},[t._v("refresh")])],1)],1)],2)]})],2):t._e(),t.searchResult.failedSites.length>0&&t.showFailedSites?e("div",[t._l(t.searchResult.failedSites,function(s,r){return[e("v-chip",{key:r,staticClass:"mr-1 py-3 pl-1",attrs:{label:"",color:"orange darken-3","text-color":"white",small:"",disabled:""}},[[e("v-avatar",{staticClass:"mr-1"},[e("img",{staticStyle:{width:"60%",height:"60%"},attrs:{src:s.site.icon}})])],e("span",[t._v(t._s(s.site.name))]),e("v-chip",{staticClass:"ml-2 py-3",staticStyle:{"margin-right":"-13px"},attrs:{label:"",color:s.color,small:"","text-color":"white",disabled:""}},[s.url?e("a",{attrs:{href:s.url,rel:"noopener noreferrer nofollow",target:"_blank"}},[t._v(t._s(s.msg))]):t._e(),s.url?t._e():e("span",[t._v(t._s(s.msg))]),e("v-btn",{attrs:{flat:"",icon:"",small:"",color:"grey lighten-2",title:t.$t("searchTorrent.reSearch")},on:{click:function(a){return a.stopPropagation(),t.reSearchWithSite(s.site.host)}}},[e("v-icon",{attrs:{small:""}},[t._v("refresh")])],1)],1)],2)]})],2):t._e()]),e("v-flex",{attrs:{xs6:""}},[e("div",{staticClass:"mt-1"},[t._l(t.searchResult.tags,function(s,r){return[e("v-chip",{key:r,staticClass:"mr-1 pl-0",attrs:{label:"",color:s.tag.color,"text-color":"white",small:""},on:{click:function(a){return a.stopPropagation(),t.resetDatas(s.items)}}},[e("span",[t._v(t._s(r))]),e("v-chip",{staticClass:"ml-2",staticStyle:{"margin-right":"-13px"},attrs:{label:"",color:"blue-grey",small:"","text-color":"white",disabled:""}},[e("span",[t._v(t._s(s.items.length))])])],1)]})],2),t.showCategory?e("div",{staticClass:"mt-1"},[t._l(t.searchResult.categories,function(s,r){return[e("v-chip",{key:r,staticClass:"mr-1 pl-0",attrs:{label:"",color:"grey darken-1","text-color":"white",small:""},on:{click:function(a){return a.stopPropagation(),t.resetDatas(s.items)}}},[e("span",[t._v(t._s(r))]),e("v-chip",{staticClass:"ml-2",staticStyle:{"margin-right":"-13px"},attrs:{label:"",color:"grey",small:"","text-color":"white",disabled:""}},[e("span",[t._v(t._s(s.items.length))])])],1)]})],2):t._e()]),e("v-flex",{attrs:{xs6:""}},[e("div",[e("v-text-field",{attrs:{"append-icon":"search",label:t.$t("searchTorrent.filterSearchResults"),"single-line":"","hide-details":"",enterkeyhint:"search"},model:{value:t.filterKey,callback:function(s){t.filterKey=s},expression:"filterKey"}})],1)])],1),e("div",{ref:"divToolbar",attrs:{id:"divToolbar"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.toolbarIsFixed,expression:"toolbarIsFixed"}],attrs:{id:"divToobarHeight"}}),e("div",{class:t.toolbarClass,attrs:{id:"divToobarInner"}},[t.$vuetify.breakpoint.smAndDown?e("div",{staticStyle:{display:"inline-flex"}},[e("v-flex",{staticClass:"px-2",staticStyle:{height:"50px"},attrs:{xs6:""}},[e("v-select",{attrs:{items:t.orderHeaders,label:t.$t("common.orderBy")},model:{value:t.pagination.sortBy,callback:function(s){t.$set(t.pagination,"sortBy",s)},expression:"pagination.sortBy"}})],1),e("v-flex",{staticClass:"px-0",staticStyle:{height:"50px"},attrs:{xs6:""}},[e("v-radio-group",{attrs:{row:""},model:{value:t.currentOrderMode,callback:function(s){t.currentOrderMode=s},expression:"currentOrderMode"}},t._l(t.orderMode,function(s,r){return e("v-radio",{key:r,staticClass:"mr-2",attrs:{label:s.text,value:s.value}})}),1)],1)],1):t._e(),e("div",{staticStyle:{display:"inline-flex","overflow-x":"auto",width:"100%","overflow-y":"hidden"}},[e("v-checkbox",{directives:[{name:"show",rawName:"v-show",value:t.checkBox&&t.toolbarIsFixed,expression:"checkBox && toolbarIsFixed"}],staticStyle:{margin:"8px 0 0 3px",padding:"0",height:"32px",flex:"unset"},attrs:{indeterminate:t.indeterminate,value:t.selected.length>0&&t.selected.length==t.datas.length},on:{click:function(s){return s.stopPropagation(),t.toggleAll.apply(null,arguments)}}}),t.selected.length>0?[e("v-btn",{class:t.$vuetify.breakpoint.smAndUp?"":"mini",attrs:{disabled:t.selected.length==0,color:"success",small:"",title:t.$t("searchTorrent.sendToClientTip")},on:{click:function(s){return s.stopPropagation(),t.showAllContentMenus(s)}}},[e("v-icon",{attrs:{small:""}},[t._v("cloud_download")]),t.$vuetify.breakpoint.smAndUp?e("span",{staticClass:"ml-2"},[t._v(" "+t._s(t.$t("searchTorrent.sendToClient"))+" ("+t._s(t.selected.length)+") ")]):e("span",{staticClass:"ml-2"},[t._v(t._s(t.selected.length))]),e("span",{staticClass:"ml-1"},[t._v(t._s(t._f("formatSize")(t.selectedSize)))])],1),t.sending.count>0?e("v-progress-circular",{attrs:{rotate:-90,size:60,width:10,value:t.sending.progress,color:"primary"}},[t._v(t._s(t.sending.progress.toFixed(0))+"%")]):t._e(),e("v-btn",{class:t.$vuetify.breakpoint.smAndUp?"":"mini",attrs:{disabled:t.selected.length==0,color:"success",small:"",title:t.$t("searchTorrent.copyToClipboardTip")},on:{click:function(s){return t.copySelectedToClipboard()}}},[e("v-icon",{attrs:{small:""}},[t._v("file_copy")]),t.$vuetify.breakpoint.smAndUp?e("span",{staticClass:"ml-2"},[t._v(" "+t._s(t.$t("searchTorrent.copyToClipboard"))+" ("+t._s(t.selected.length)+") ")]):e("span",{staticClass:"ml-2"},[t._v(t._s(t.selected.length))])],1),t.$vuetify.breakpoint.mdAndUp?e("v-btn",{attrs:{disabled:t.selected.length==0,color:"success",small:"",title:t.$t("searchTorrent.saveTip")},on:{click:t.downloadSelected}},[e("v-icon",{staticClass:"mr-2",attrs:{small:""}},[t._v("save")]),t._v(" "+t._s(t.$t("searchTorrent.save"))+" ("+t._s(t.selected.length)+") ")],1):t._e(),t.downloading.count>0?e("v-progress-circular",{attrs:{rotate:-90,size:60,width:10,value:t.downloading.progress,color:"primary"}},[t._v(t._s(t.downloading.progress.toFixed(0))+"%")]):t._e(),t.downloadFailedTorrents.length>0?e("v-btn",{staticClass:"error",attrs:{small:"",title:t.$t("searchTorrent.downloadFailed"),loading:t.downloading.count>0},on:{click:t.reDownloadFailedTorrents}},[e("v-icon",{staticClass:"mr-2",attrs:{small:""}},[t._v("get_app")]),t._v(" "+t._s(t.$t("searchTorrent.downloadFailed"))+" ("+t._s(t.downloadFailedTorrents.length)+") ")],1):t._e(),e("AddToCollectionGroup",{attrs:{disabled:t.selected.length==0,label:t.$vuetify.breakpoint.smAndUp?t.$t("searchTorrent.collection")+` (${t.selected.length})`:t.selected.length,small:""},on:{add:t.addSelectedToCollection}}),e("KeepUpload",{attrs:{items:t.selected,label:t.$vuetify.breakpoint.smAndUp?`${t.$t("keepUploadTask.keepUpload")} (${t.selected.length})`:t.selected.length,color:"success"}})]:t._e(),t.$store.state.options.allowSaveSnapshot?e("v-btn",{class:t.$vuetify.breakpoint.smAndUp?"":"mini",attrs:{loading:t.loading,color:"cyan",small:"",dark:"",title:t.$t("searchResultSnapshot.create")},on:{click:function(s){return s.stopPropagation(),t.createSearchResultSnapshot()}}},[e("v-icon",{attrs:{small:""}},[t._v("add_a_photo")]),t.$vuetify.breakpoint.smAndUp?e("span",{staticClass:"ml-2"},[t._v(" "+t._s(t.$t("searchResultSnapshot.create"))+" ")]):t._e()],1):t._e(),e("v-menu",{staticClass:"ml-2",attrs:{"close-on-content-click":!1,"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:s}){return[e("v-btn",t._g({class:t.$vuetify.breakpoint.smAndUp?"":"mini",attrs:{color:"blue",dark:"",title:t.$t("home.settings"),small:""}},s),[e("v-icon",{attrs:{small:""}},[t._v("settings")])],1)]}}])},[e("v-card",[e("v-container",{attrs:{"grid-list-xs":""}},[e("v-switch",{attrs:{color:"success",label:t.$t("searchTorrent.showCheckbox")},on:{change:t.updateViewOptions},model:{value:t.checkBox,callback:function(s){t.checkBox=s},expression:"checkBox"}}),e("v-switch",{attrs:{color:"success",label:t.$t("searchTorrent.showCategory")},on:{change:t.updateViewOptions},model:{value:t.showCategory,callback:function(s){t.showCategory=s},expression:"showCategory"}}),e("v-switch",{attrs:{color:"success",label:t.$t("searchTorrent.titleMiddleEllipsis")},on:{change:t.updateViewOptions},model:{value:t.titleMiddleEllipsis,callback:function(s){t.titleMiddleEllipsis=s},expression:"titleMiddleEllipsis"}})],1)],1)],1)],2)])]),e("v-data-table",{class:"torrent"+(t.fixedTable?" fixed-table fixed-header v-table__overflow":""),attrs:{search:t.filterKey,"custom-filter":t.searchResultFilter,headers:t.headers,items:t.datas,pagination:t.pagination,loading:t.loading,"item-key":"link","select-all":t.checkBox,"rows-per-page-items":t.options.rowsPerPageItems},on:{"update:pagination":function(s){t.pagination=s}},scopedSlots:t._u([{key:"headers",fn:function(s){return[e("tr",[t.checkBox?e("th",[e("v-checkbox",{attrs:{"input-value":s.all,indeterminate:s.indeterminate,primary:"","hide-details":""},on:{click:function(r){return r.stopPropagation(),t.toggleAll.apply(null,arguments)}}})],1):t._e(),t._l(s.headers,function(r){return[r.visible?e("th",{key:r.text,class:t.getHeaderClass(r),style:r.width?`width:${r.width};`:"",on:{click:function(a){r.sortable!==!1&&t.changeSort(r.value)}}},[r.sortable!==!1?e("v-icon",{attrs:{small:""}},[t._v("arrow_upward")]):t._e(),t._v(" "+t._s(r.text)+" ")],1):t._e()]})],2)]}},{key:"items",fn:function(s){return[t.checkBox?e("td",[e("v-checkbox",{attrs:{primary:"","hide-details":""},on:{change:function(r){return t.shiftCheck(r,s.index)}},model:{value:s.selected,callback:function(r){t.$set(s,"selected",r)},expression:"props.selected"}})],1):t._e(),t.$vuetify.breakpoint.mdAndUp?e("td",{staticClass:"center"},[e("v-avatar",{attrs:{size:"18"}},[e("img",{attrs:{src:s.item.site.icon}})]),t.$vuetify.breakpoint.width>1200?[e("br"),e("a",{staticClass:"captionText",attrs:{href:s.item.site.activeURL||s.item.site.url,target:"_blank",rel:"noopener noreferrer nofollow"},domProps:{innerHTML:t._s(s.item.site.name)}})]:t._e()],2):t._e(),e("td",{class:t.$vuetify.breakpoint.xs?"titleCell-mobile":"titleCell"},[t.$vuetify.breakpoint.smAndDown?e("v-avatar",{staticClass:"mr-1",staticStyle:{"vertical-align":"unset"},attrs:{size:"14"}},[e("img",{attrs:{src:s.item.site.icon}})]):t._e(),t.titleMiddleEllipsis&&!t.$vuetify.breakpoint.xs?e("div",{staticClass:"titleWrap"},[e("a",{class:[t.$vuetify.breakpoint.xs?"body-2":"subheading titleFull","font-weight-medium"],attrs:{href:s.item.link,target:"_blank",title:s.item.title,rel:"noopener noreferrer nofollow"},domProps:{innerHTML:t._s(s.item.titleHTML)}}),e("a",{class:[t.$vuetify.breakpoint.xs?"body-2":"subheading titleEllipsisMiddle","font-weight-medium"],attrs:{href:s.item.link,target:"_blank",title:"·title:"+s.item.title,rel:"noopener noreferrer nofollow"},domProps:{innerHTML:t._s(s.item.titleHTML)}})]):e("a",{class:[t.$vuetify.breakpoint.xs?"body-2":"subheading","font-weight-medium"],attrs:{href:s.item.link,target:"_blank",title:s.item.title,rel:"noopener noreferrer nofollow"},domProps:{innerHTML:t._s(s.item.titleHTML)}}),s.item.tags&&s.item.tags.length||s.item.subTitle?e("div",{staticClass:"sub-title captionText"},[s.item.tags&&s.item.tags.length?e("span",{staticClass:"mr-1"},t._l(s.item.tags,function(r,a){return e("span",{key:a,class:["tag",`${r.color}`],style:{"background-color":`${r.color}`,"border-color":`${r.color}`},attrs:{title:r.title}},[t._v(t._s(r.name))])}),0):t._e(),s.item.subTitle?e("span",{attrs:{title:s.item.subTitle}},[t._v(t._s(s.item.subTitle))]):t._e()]):t._e(),t.$vuetify.breakpoint.xs?e("v-layout",[e("v-flex",{staticClass:"pt-2 captionText",attrs:{xs3:""}},[t._v(" "+t._s(t._f("formatSize")(s.item.size))+" ")]),e("v-flex",{staticClass:"pt-2 captionText",attrs:{xs3:""}},[e("v-icon",{staticStyle:{"font-size":"12px","margin-bottom":"2px"}},[t._v("arrow_upward")]),t._v(" "+t._s(s.item.seeders)+" "),e("v-icon",{staticStyle:{"font-size":"12px","margin-bottom":"2px"}},[t._v("arrow_downward")]),t._v(" "+t._s(s.item.leechers)+" ")],1),e("v-flex",{attrs:{xs3:""}},[s.item.progress!=null?e("TorrentProgress",{staticClass:"progress",staticStyle:{position:"unset","padding-top":"2px"},attrs:{progress:parseInt(s.item.progress),status:s.item.status}}):t._e()],1),e("v-flex",{attrs:{xs3:""}},[t.$vuetify.breakpoint.xs?e("Actions",{attrs:{url:s.item.url,downloadMethod:s.item.site.downloadMethod,isCollectioned:t.isCollectioned(s.item.link),item:s.item},on:{copyLinkToClipboard:function(r){return t.copyLinkToClipboard(s.item)},saveTorrentFile:function(r){return t.saveTorrentFile(s.item)},addToCollection:function(r){return t.addToCollection(s.item)},deleteCollection:function(r){return t.deleteCollection(s.item)},downloadSuccess:t.downloadSuccess,downloadError:t.downloadError}}):t._e()],1)],1):t._e()],1),t.$vuetify.breakpoint.width>1200?e("td",{staticClass:"category center"},[s.item.category&&s.item.category.name?e("span",{staticClass:"captionText",attrs:{title:s.item.category.name}},[t._v(t._s(s.item.category.name))]):t._e(),e("br"),e("span",{staticClass:"captionText"},[t._v("<"+t._s(s.item.entryName)+">")])]):t._e(),t.$vuetify.breakpoint.smAndUp?e("td",{staticClass:"size"},[t._v(" "+t._s(t._f("formatSize")(s.item.size))+" "),s.item.progress!=null?e("TorrentProgress",{staticClass:"progress",attrs:{progress:parseInt(s.item.progress),status:s.item.status}}):t._e()],1):t._e(),t.$vuetify.breakpoint.smAndUp?e("td",{staticClass:"size"},[t._v(t._s(s.item.seeders))]):t._e(),t.$vuetify.breakpoint.mdAndUp?e("td",{staticClass:"size"},[t._v(t._s(s.item.leechers))]):t._e(),t.$vuetify.breakpoint.mdAndUp?e("td",{staticClass:"size"},[t._v(t._s(s.item.completed))]):t._e(),t.$vuetify.breakpoint.smAndUp?e("td",{staticClass:"size"},[t._v(t._s(s.item.comments))]):t._e(),t.$vuetify.breakpoint.mdAndUp?e("td",[t._v(t._s(t._f("formatDate")(s.item.time)))]):t._e(),t.$vuetify.breakpoint.smAndUp?e("td",{staticClass:"text-xs-center"},[s.item.url?[e("Actions",{attrs:{url:s.item.url,downloadMethod:s.item.site.downloadMethod,isCollectioned:t.isCollectioned(s.item.link),item:s.item},on:{copyLinkToClipboard:function(r){return t.copyLinkToClipboard(s.item)},saveTorrentFile:function(r){return t.saveTorrentFile(s.item)},addToCollection:function(r){return t.addToCollection(s.item)},deleteCollection:function(r){return t.deleteCollection(s.item)},downloadSuccess:t.downloadSuccess,downloadError:t.downloadError}})]:e("span",[t._v(t._s(t.$t("searchTorrent.failUrl")))])],2):t._e()]}}]),model:{value:t.selected,callback:function(s){t.selected=s},expression:"selected"}})],1),e("v-snackbar",{attrs:{top:"",timeout:3e3,"multi-line":"",color:"error"},model:{value:t.haveError,callback:function(s){t.haveError=s},expression:"haveError"}},[e("div",{domProps:{innerHTML:t._s(t.errorMsg)}})]),e("v-snackbar",{attrs:{bottom:"",timeout:3e3,"multi-line":"",color:"success"},model:{value:t.haveSuccess,callback:function(s){t.haveSuccess=s},expression:"haveSuccess"}},[e("div",{domProps:{innerHTML:t._s(t.successMsg)}})])],1)},pt=[],vt=y(ft,gt,pt,!1,null,null,null,null);const yt=vt.exports;export{yt as default};
