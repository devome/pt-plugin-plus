import{V as f,g as c,D as r,G as v,E as u,P as p,x,F as g,b as h,n as _}from"./index-CFTjSAoW.js";import{d as S}from"./dom-to-image-Bh0__-5e.js";const m=new h,b=f.extend({data(){return{shareMessage:this.$t("timeline.shareMessage").toString(),displayUserName:"",sites:[],showSites:[],infos:{nameInfo:{name:"test",maxCount:0},joinTimeInfo:{site:{},time:new Date().getTime(),years:0},maxUploadsInfo:{site:{},maxValue:0,subSite:{},submaxValue:0},maxUploadedInfo:{site:{},maxValue:0,subSite:{},submaxValue:0},maxDownloadedInfo:{site:{},maxValue:0,subSite:{},submaxValue:0},maxSeedingInfo:{site:{},maxValue:0,subSite:{},submaxValue:0},maxSeedingSizeInfo:{site:{},maxValue:0,subSite:{},submaxValue:0},total:{uploads:0,uploaded:0,downloaded:0,seedingSize:0,ratio:-1,seeding:0}},options:this.$store.state.options,version:"",datas:[],shareTime:new Date,shareing:!1,showUserName:!0,showSiteName:!1,showUserLevel:!0,showUserUploads:!0,showUid:!0,blurSiteIcon:!0,iconCache:{}}},created(){if(chrome&&chrome.runtime){let t=chrome.runtime.getManifest();this.version="v"+(t.version_name||t.version)}this.init()},mounted(){},computed:{selectedTagValues(){let{selectedTags:t}=this.$store.getters.viewsOptions(c.home,{});return t&&Array.isArray(t)&&t.length>0?t.map(e=>e.value):[]}},methods:{filteredSitesByTags(t){var s;if(this.selectedTagValues.length===0||this.selectedTagValues.includes(r.all))return t;let e=this.clone(this.selectedTagValues),a=[];if(e.includes(r.unTagged)){let o=t.filter(n=>!n.tags||n.tags.length===0);a=a.concat(o)}if(e.includes(r.unReadMsg)){let o=t.filter(n=>{var l;return(((l=n.user)==null?void 0:l.messageCount)||0)>0});a=a.concat(o)}if(e.includes(r.statusError)){let o=t.filter(n=>{var l,d;return((l=n.user)==null?void 0:l.lastErrorMsg)||((d=n.user)==null?void 0:d.lastUpdateStatus)!==v.success});a=a.concat(o)}let i=t.filter(o=>Array.isArray(o.tags)&&o.tags.length>0);for(let o of i)(s=o.tags)!=null&&s.some(n=>e.includes(n))&&a.push(o);return a},init(){m.sendRequest(u.readConfig).then(t=>{this.options=this.clone(t),this.sites=this.options.sites,this.options.shareMessage&&(this.shareMessage=this.options.shareMessage),this.options.displayUserName&&(this.displayUserName=this.options.displayUserName);let e=this.sites.filter(a=>a.allowGetUserInfo);e=this.filteredSitesByTags(e),this.showSites=[...new Set(e.map(a=>a.name))],this.formatData()}).catch()},formatData(){let t={},e=this.infos;e={nameInfo:{name:"test",maxCount:0},joinTimeInfo:{site:{},time:new Date().getTime(),years:0},maxUploadsInfo:{site:{},maxValue:0,subSite:{},submaxValue:0},maxUploadedInfo:{site:{},maxValue:0,subSite:{},submaxValue:0},maxDownloadedInfo:{site:{},maxValue:0,subSite:{},submaxValue:0},maxSeedingInfo:{site:{},maxValue:0,subSite:{},submaxValue:0},maxSeedingSizeInfo:{site:{},maxValue:0,subSite:{},submaxValue:0},total:{uploads:0,uploaded:0,downloaded:0,seedingSize:0,ratio:-1,seeding:0}};let a=[];this.sites.forEach(i=>{if(!i.allowGetUserInfo||!this.showSites.includes(i.name))return;let s=i.user;s&&s.name&&s.joinTime&&(s.joinTime=p.transformTime(s.joinTime,i.timezoneOffset),a.push(i),t[s.name]||(t[s.name]=0),t[s.name]++,t[s.name]>e.nameInfo.maxCount&&(e.nameInfo.name=s.name,e.nameInfo.maxCount=t[s.name]),s.joinTime&&s.joinTime<e.joinTimeInfo.time&&(e.joinTimeInfo.time=Math.round(s.joinTime),e.joinTimeInfo.site=i),s.uploads&&s.uploads>0&&(typeof s.uploads!="number"&&(console.log(`${i.url}: 当前站点 uploads 类型为 ${typeof s.uploads}，强制转换为 number 类型`),s.uploads=parseInt(s.uploads)||0),e.total.uploads+=s.uploads,s.uploads>e.maxUploadsInfo.maxValue?(e.maxUploadsInfo.submaxValue=e.maxUploadsInfo.maxValue,e.maxUploadsInfo.subSite=e.maxUploadsInfo.site,e.maxUploadsInfo.maxValue=s.uploads,e.maxUploadsInfo.site=i):s.uploads>e.maxUploadsInfo.submaxValue&&(e.maxUploadsInfo.submaxValue=s.uploads,e.maxUploadsInfo.subSite=i)),s.uploaded&&s.uploaded>0&&(e.total.uploaded+=s.uploaded,s.uploaded>e.maxUploadedInfo.maxValue?(e.maxUploadedInfo.submaxValue=e.maxUploadedInfo.maxValue,e.maxUploadedInfo.subSite=e.maxUploadedInfo.site,e.maxUploadedInfo.maxValue=s.uploaded,e.maxUploadedInfo.site=i):s.uploaded>e.maxUploadedInfo.submaxValue&&(e.maxUploadedInfo.submaxValue=s.uploaded,e.maxUploadedInfo.subSite=i)),s.downloaded&&s.downloaded>0&&(e.total.downloaded+=s.downloaded,s.downloaded>e.maxDownloadedInfo.maxValue?(e.maxDownloadedInfo.submaxValue=e.maxDownloadedInfo.maxValue,e.maxDownloadedInfo.subSite=e.maxDownloadedInfo.site,e.maxDownloadedInfo.maxValue=s.downloaded,e.maxDownloadedInfo.site=i):s.downloaded>e.maxDownloadedInfo.submaxValue&&(e.maxDownloadedInfo.submaxValue=s.downloaded,e.maxDownloadedInfo.subSite=i)),s.seeding&&s.seeding>0&&(e.total.seeding+=Math.round(s.seeding),s.seeding>e.maxSeedingInfo.maxValue?(e.maxSeedingInfo.submaxValue=e.maxSeedingInfo.maxValue,e.maxSeedingInfo.subSite=e.maxSeedingInfo.site,e.maxSeedingInfo.maxValue=Math.round(s.seeding),e.maxSeedingInfo.site=i):s.seeding>e.maxSeedingInfo.submaxValue&&(e.maxSeedingInfo.submaxValue=Math.round(s.seeding),e.maxSeedingInfo.subSite=i)),s.seedingSize&&s.seedingSize>0&&(e.total.seedingSize+=s.seedingSize,s.seedingSize>e.maxSeedingSizeInfo.maxValue?(e.maxSeedingSizeInfo.submaxValue=e.maxSeedingSizeInfo.maxValue,e.maxSeedingSizeInfo.subSite=e.maxSeedingSizeInfo.site,e.maxSeedingSizeInfo.maxValue=s.seedingSize,e.maxSeedingSizeInfo.site=i):s.seedingSize>e.maxSeedingSizeInfo.submaxValue&&(e.maxSeedingSizeInfo.submaxValue=s.seedingSize,e.maxSeedingSizeInfo.subSite=i)),s.ratio=this.getRatio(s))}),e.joinTimeInfo.time>0&&(e.joinTimeInfo.years=x(new Date).diff(e.joinTimeInfo.time,"year",!0).toFixed(2)),this.infos=e,this.datas=a.sort((i,s)=>{if(!i.user||!s.user)return 0;const o=i.user.joinTime||0,n=s.user.joinTime||0;return o<n?-1:o>n?1:0}),this.infos.total.ratio=this.getRatio(this.infos.total)},getRatio(t){let e=t.downloaded,a=t.uploaded;return e==0&&a>0?-1:e>0?a/e:-1},clone(t){return JSON.parse(JSON.stringify(t))},share(){this.shareing=!0,this.shareTime=new Date,this.formatData(),setTimeout(()=>{let t=this.$refs.userDataCard;S.toBlob(t,{imagePlaceholder:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",filter:e=>e.nodeType===1?!e.classList.contains("by_pass_canvas"):!0}).then(e=>{e&&g.saveAs(e,"PT-Plugin-Plus-UserData.png"),this.shareing=!1}).catch(e=>{console.log("error:",e),this.shareing=!1})},500)},replaceImageToBase64(){let t=this.$refs.userDataCard;$("img",t).each((a,i)=>{let s=$(i).attr("src")+"";if(s.indexOf("http")>-1){if(this.iconCache[s]){$(i).attr("src",this.iconCache[s]);return}m.sendRequest(u.getBase64FromImageUrl,null,s).then(o=>{this.iconCache[s]=o,$(i).attr("src",o)}).catch(o=>{console.log(o)})}})},changeDisplayUserName(){let t=prompt(this.$t("timeline.inputDisplayName").toString(),this.displayUserName);t!=null&&(this.displayUserName=t,this.$store.dispatch("saveConfig",{displayUserName:t}))},changeShareMessage(){let t=prompt(this.$t("timeline.inputShareMessage").toString(),this.shareMessage);t!=null&&(this.shareMessage=t,this.$store.dispatch("saveConfig",{shareMessage:t}))}},filters:{formatRatio(t){if(t>1e4||t==-1)return"∞";let e=parseFloat(t);return isNaN(e)?"-":e.toFixed(2)}}});var I=function(){var e=this,a=e._self._c;return e._self._setupProxy,a("div",{staticClass:"userDataTimeline"},[a("div",{ref:"userDataCard",staticClass:"card"},[a("v-card",{staticClass:"white--text",attrs:{color:"blue-grey darken-2"}},[a("v-card-actions",[a("v-chip",{attrs:{color:"blue-grey darken-2","text-color":"white",label:"",outline:""},on:{click:function(i){return i.stopPropagation(),e.changeDisplayUserName.apply(null,arguments)}}},[a("v-avatar",[a("v-icon",[e._v("account_circle")])],1),a("div",{staticClass:"title"},[e._v(e._s(e.displayUserName||e.infos.nameInfo.name))])],1),a("v-spacer"),e.shareing?e._e():a("v-btn",{staticClass:"white--text",attrs:{flat:"",icon:"",title:e.$t("timeline.share")},on:{click:e.share}},[a("v-icon",[e._v("share")])],1),e.shareing?e._e():a("v-btn",{staticClass:"white--text",attrs:{flat:"",icon:"",to:"/home",title:e.$t("timeline.close")}},[a("v-icon",[e._v("close")])],1),e.shareing?a("v-progress-circular",{staticClass:"by_pass_canvas",attrs:{indeterminate:"",width:3,size:"30",color:"green"}}):e._e()],1),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-card-title",{attrs:{"primary-title":""}},[a("div",{staticClass:"headline font-weight-bold"},[a("div",[e._v(e._s(e.$t("timeline.total.sites"))+e._s(e.datas.length))]),e.showUserUploads&&e.infos.total.uploads&&e.infos.total.uploads>0?a("div",[e._v(e._s(e.$t("timeline.total.uploads"))+e._s(e.infos.total.uploads))]):e._e(),a("div",[e._v(e._s(e.$t("timeline.total.uploaded"))+e._s(e._f("formatSizetoPrecision")(e.infos.total.uploaded)))]),a("div",[e._v(e._s(e.$t("timeline.total.downloaded"))+e._s(e._f("formatSizetoPrecision")(e.infos.total.downloaded)))]),a("div",[e._v(e._s(e.$t("timeline.total.seedingSize"))+e._s(e._f("formatSizetoPrecision")(e.infos.total.seedingSize)))]),a("div",[e._v(e._s(e.$t("timeline.total.seeding"))+e._s(e.infos.total.seeding))]),a("div",[e._v(e._s(e.$t("timeline.total.ratio"))+e._s(e._f("formatRatio")(e.infos.total.ratio)))]),a("div",[e._v(e._s(e.$t("timeline.total.years",{year:e.infos.joinTimeInfo.years})))])])]),a("v-divider",{attrs:{vertical:""}}),a("v-card-title",{attrs:{"primary-title":""}},[a("div",{staticClass:"headline font-weight-bold"},[a("div",[a("v-icon",{attrs:{color:"#C9B037"}},[e._v("emoji_events")])],1),e.showUserUploads&&e.infos.total.uploads&&e.infos.total.uploads>0?a("div",[a("div",[a("v-avatar",{attrs:{size:"20"}},[e.infos.maxUploadsInfo.site.icon?a("img",{class:{"icon-blur":e.blurSiteIcon},attrs:{src:e.infos.maxUploadsInfo.site.icon}}):e._e()]),a("span",[e._v(e._s(e.infos.maxUploadsInfo.maxValue))])],1)]):e._e(),a("div",[a("v-avatar",{attrs:{size:"20"}},[e.infos.maxUploadedInfo.site.icon?a("img",{class:{"icon-blur":e.blurSiteIcon},attrs:{src:e.infos.maxUploadedInfo.site.icon}}):e._e()]),a("span",[e._v(e._s(e._f("formatSizetoPrecision")(e.infos.maxUploadedInfo.maxValue)))])],1),a("div",[a("v-avatar",{attrs:{size:"20"}},[e.infos.maxDownloadedInfo.site.icon?a("img",{class:{"icon-blur":e.blurSiteIcon},attrs:{src:e.infos.maxDownloadedInfo.site.icon}}):e._e()]),a("span",[e._v(e._s(e._f("formatSizetoPrecision")(e.infos.maxDownloadedInfo.maxValue)))])],1),a("div",[a("v-avatar",{attrs:{size:"20"}},[e.infos.maxSeedingSizeInfo.site.icon?a("img",{class:{"icon-blur":e.blurSiteIcon},attrs:{src:e.infos.maxSeedingSizeInfo.site.icon}}):e._e()]),a("span",[e._v(e._s(e._f("formatSizetoPrecision")(e.infos.maxSeedingSizeInfo.maxValue)))])],1),a("div",[a("v-avatar",{attrs:{size:"20"}},[e.infos.maxSeedingInfo.site.icon?a("img",{class:{"icon-blur":e.blurSiteIcon},attrs:{src:e.infos.maxSeedingInfo.site.icon}}):e._e()]),a("span",[e._v(e._s(e.infos.maxSeedingInfo.maxValue))])],1),a("div",[a("v-icon")],1),a("div",[a("v-icon")],1)])]),e.infos.maxUploadsInfo.subSite?a("v-card-title",{attrs:{"primary-title":""}},[a("div",{staticClass:"headline font-weight-bold"},[a("div",[a("v-icon",{attrs:{color:"#B4B4B4"}},[e._v("emoji_events")])],1),e.showUserUploads&&e.infos.total.uploads&&e.infos.total.uploads>0?a("div",[a("div",[a("v-avatar",{attrs:{size:"20"}},[e.infos.maxUploadsInfo.subSite.icon?a("img",{class:{"icon-blur":e.blurSiteIcon},attrs:{src:e.infos.maxUploadsInfo.subSite.icon}}):e._e()]),e.infos.maxUploadsInfo.submaxValue&&e.infos.maxUploadsInfo.submaxValue>0?a("span",[e._v(e._s(e.infos.maxUploadsInfo.submaxValue))]):e._e()],1)]):e._e(),a("div",[a("v-avatar",{attrs:{size:"20"}},[e.infos.maxUploadedInfo.subSite.icon?a("img",{class:{"icon-blur":e.blurSiteIcon},attrs:{src:e.infos.maxUploadedInfo.subSite.icon}}):e._e()]),a("span",[e._v(e._s(e._f("formatSizetoPrecision")(e.infos.maxUploadedInfo.submaxValue)))])],1),a("div",[a("v-avatar",{attrs:{size:"20"}},[e.infos.maxDownloadedInfo.subSite.icon?a("img",{class:{"icon-blur":e.blurSiteIcon},attrs:{src:e.infos.maxDownloadedInfo.subSite.icon}}):e._e()]),a("span",[e._v(e._s(e._f("formatSizetoPrecision")(e.infos.maxDownloadedInfo.submaxValue)))])],1),a("div",[a("v-avatar",{attrs:{size:"20"}},[e.infos.maxSeedingSizeInfo.subSite.icon?a("img",{class:{"icon-blur":e.blurSiteIcon},attrs:{src:e.infos.maxSeedingSizeInfo.subSite.icon}}):e._e()]),a("span",[e._v(e._s(e._f("formatSizetoPrecision")(e.infos.maxSeedingSizeInfo.submaxValue)))])],1),a("div",[a("v-avatar",{attrs:{size:"20"}},[e.infos.maxSeedingInfo.subSite.icon?a("img",{class:{"icon-blur":e.blurSiteIcon},attrs:{src:e.infos.maxSeedingInfo.subSite.icon}}):e._e()]),a("span",[e._v(e._s(e.infos.maxSeedingInfo.submaxValue))])],1),a("div",[a("v-icon")],1),a("div",[a("v-icon")],1)])]):e._e()],1),a("v-card-text",[a("v-divider"),a("div",{staticStyle:{"text-align":"center"}},[a("div",{staticClass:"headline font-weight-bold mt-2",on:{click:function(i){return i.stopPropagation(),e.changeShareMessage.apply(null,arguments)}}},[e._v("... "+e._s(e.shareMessage)+" ...")]),a("div",{staticStyle:{color:"#b5b5b5"}},[e._v("("+e._s(e.$t("timeline.updateat"))+e._s(e._f("formatDate")(e.options.autoRefreshUserDataLastTime,"YYYY-MM-DD HH:mm:ss"))+")")])]),a("v-timeline",{staticClass:"my-2"},e._l(e.datas,function(i,s){return a("v-timeline-item",{key:s,attrs:{color:"transparent",large:""},scopedSlots:e._u([{key:"icon",fn:function(){return[a("v-avatar",{attrs:{size:"38"}},[i.icon?a("img",{class:{"icon-blur":e.blurSiteIcon},attrs:{src:i.icon}}):e._e()])]},proxy:!0},{key:"opposite",fn:function(){return[a("div",{staticClass:"headline font-weight-bold"},[e._v(e._s(e._f("timeAgo")(i.user.joinTime)))]),a("div",{staticClass:"caption"},[e.showUserName?a("span",{staticClass:"mr-2"},[e._v(e._s(i.user.name))]):e._e(),e.showUserLevel?a("span",[e._v("<"+e._s(i.user.levelName)+">")]):e._e(),i.user.id&&i.user.id.length>0&&e.showUid?a("span",[e._v("<"+e._s(i.user.id)+">")]):e._e()])]},proxy:!0}],null,!0)},[a("div",[s>0?a("v-divider",{staticClass:"mb-2"}):e._e(),e.showSiteName?a("div",{staticClass:"headline font-weight-light mb-2"},[e._v(e._s(i.name))]):e._e(),e.showUserUploads&&i.user.uploads&&i.user.uploads>0?a("div",[e._v(e._s(e.$t("timeline.user.uploads"))+e._s(i.user.uploads))]):e._e(),a("div",[e._v(e._s(e.$t("timeline.user.uploaded"))+e._s(e._f("formatSize")(i.user.uploaded)))]),a("div",[e._v(e._s(e.$t("timeline.user.downloaded"))+e._s(e._f("formatSize")(i.user.downloaded)))]),a("div",[e._v(e._s(e.$t("timeline.user.ratio"))+e._s(e._f("formatRatio")(i.user.ratio)))]),a("div",[e._v(e._s(e.$t("timeline.user.seedingSize"))+e._s(e._f("formatSize")(i.user.seedingSize))+" ("+e._s(i.user.seeding)+")")]),i.user.averageSeedtime&&i.user.averageSeedtime>0?a("div",[e._v(e._s(e.$t("timeline.user.averageSeedtime",{day:i.user.averageSeedtime|e.formatInteger})))]):e._e(),a("div",[e._v(e._s(e.$t("timeline.user.bonus"))+e._s(e._f("formatNumber")(i.user.bonus)))]),i.user.bonusPerHour&&i.user.bonusPerHour!="N/A"?a("div",[e._v(e._s(e.$t("timeline.user.bonusPerHour"))+e._s(e._f("formatNumber")(i.user.bonusPerHour)))]):e._e()],1)])}),1)],1),a("v-divider"),a("v-card-actions",[a("v-spacer"),a("span",[e._v(e._s(e._f("formatDate")(e.shareTime,"YYYY-MM-DD HH:mm:ss")))]),a("span",{staticClass:"ml-1"},[e._v("Created By "+e._s(e.$t("app.name"))+" "+e._s(e.version))])],1)],1)],1),a("div",{staticClass:"toolbar"},[a("v-switch",{staticClass:"my-0",attrs:{color:"success",label:e.$t("timeline.siteName")},model:{value:e.showSiteName,callback:function(i){e.showSiteName=i},expression:"showSiteName"}}),a("v-switch",{staticClass:"my-0",attrs:{color:"success",label:e.$t("timeline.blurSiteIcon")},model:{value:e.blurSiteIcon,callback:function(i){e.blurSiteIcon=i},expression:"blurSiteIcon"}}),a("v-switch",{staticClass:"my-0",attrs:{color:"success",label:e.$t("timeline.userName")},model:{value:e.showUserName,callback:function(i){e.showUserName=i},expression:"showUserName"}}),a("v-switch",{staticClass:"my-0",attrs:{color:"success",label:e.$t("timeline.userLevel")},model:{value:e.showUserLevel,callback:function(i){e.showUserLevel=i},expression:"showUserLevel"}}),a("v-switch",{staticClass:"my-0",attrs:{color:"success",label:e.$t("timeline.userUploads")},model:{value:e.showUserUploads,callback:function(i){e.showUserUploads=i},expression:"showUserUploads"}}),a("v-switch",{staticClass:"my-0",attrs:{color:"success",label:e.$t("timeline.userId")},model:{value:e.showUid,callback:function(i){e.showUid=i},expression:"showUid"}}),a("v-divider"),a("h1",{staticStyle:{padding:"5px"}},[e._v(e._s(e.$t("timeline.showSites")))]),a("v-layout",{attrs:{"justify-start":"",row:"",wrap:""}},e._l(e.sites,function(i,s){return a("v-flex",{key:s,attrs:{xs3:""}},[a("v-switch",{staticClass:"my-0",attrs:{color:"success",label:i.name,value:i.name,disabled:!i.allowGetUserInfo},on:{change:e.formatData},model:{value:e.showSites,callback:function(o){e.showSites=o},expression:"showSites"}})],1)}),1)],1)])},w=[],U=_(b,I,w,!1,null,"d329dd94",null,null);const z=U.exports;export{z as default};
