import{V as n,n as a,P as d,F as h}from"./index-C2uF3Qql.js";const m=n.extend({data(){return{rules:{require:[i=>!!i||"!"]},valid:!1,option:{name:"",id:null,pages:[],scripts:[],styles:[],script:"",style:"",readonly:!1}}},props:{initData:{type:Object,default:()=>({valid:!1,readonly:!1})}},watch:{option:{handler(){this.$emit("change",{data:this.option,valid:this.valid})},deep:!0},initData(){this.initData&&(this.option=Object.assign({},this.initData))}}});var u=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("v-card",{staticClass:"mb-5",attrs:{color:t.$vuetify.dark?"":"grey lighten-4"}},[e("v-card-text",[e("v-form",{model:{value:t.valid,callback:function(s){t.valid=s},expression:"valid"}},[e("v-text-field",{ref:"name",attrs:{label:t.$t("settings.sitePlugins.editor.name"),placeholder:t.$t("settings.sitePlugins.editor.name"),required:"",rules:t.rules.require,disabled:t.option.readonly},model:{value:t.option.name,callback:function(s){t.$set(t.option,"name",s)},expression:"option.name"}}),e("v-combobox",{attrs:{"hide-selected":"",hint:t.$t("settings.sitePlugins.editor.pagesTip"),label:t.$t("settings.sitePlugins.editor.pages"),multiple:"","persistent-hint":"","small-chips":"",disabled:t.option.readonly},model:{value:t.option.pages,callback:function(s){t.$set(t.option,"pages",s)},expression:"option.pages"}}),e("v-combobox",{attrs:{"hide-selected":"",hint:t.$t("settings.sitePlugins.editor.scriptsTip"),label:t.$t("settings.sitePlugins.editor.scripts"),multiple:"","persistent-hint":"","small-chips":"",disabled:t.option.readonly},model:{value:t.option.scripts,callback:function(s){t.$set(t.option,"scripts",s)},expression:"option.scripts"}}),e("v-combobox",{attrs:{"hide-selected":"",hint:t.$t("settings.sitePlugins.editor.stylesTip"),label:t.$t("settings.sitePlugins.editor.styles"),multiple:"","persistent-hint":"","small-chips":"",disabled:t.option.readonly},model:{value:t.option.styles,callback:function(s){t.$set(t.option,"styles",s)},expression:"option.styles"}}),e("v-textarea",{attrs:{label:t.$t("settings.sitePlugins.editor.script"),height:"200",disabled:t.option.readonly},model:{value:t.option.script,callback:function(s){t.$set(t.option,"script",s)},expression:"option.script"}}),e("v-textarea",{attrs:{label:t.$t("settings.sitePlugins.editor.style"),height:"200",disabled:t.option.readonly},model:{value:t.option.style,callback:function(s){t.$set(t.option,"style",s)},expression:"option.style"}})],1)],1)],1)},v=[],g=a(m,u,v,!1,null,null,null,null);const c=g.exports,p=n.extend({components:{Editor:c},data(){return{show:!1,selected:{script:`(function() {
  console.log("I'm a plugin.");
})();`},valid:!1,newData:{}}},props:{value:Boolean},model:{prop:"value",event:"change"},watch:{show(){this.$emit("change",this.show),this.show||(this.selected={})},value(){this.show=this.value}},methods:{save(){this.$emit("save",Object.assign({isCustom:!0},this.newData)),this.show=!1},cancel(){this.show=!1},change(i){console.log(i),this.newData=i.data,this.valid=i.valid}}});var f=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",[e("v-dialog",{attrs:{fullscreen:""},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[e("v-card",[e("v-toolbar",{attrs:{dark:"",color:"blue-grey darken-2"}},[e("v-toolbar-title",[t._v(t._s(t.$t("settings.sitePlugins.add.title")))]),e("v-spacer"),e("v-btn",{attrs:{icon:"",flat:"",color:"success",href:"https://github.com/pt-plugins/PT-Plugin-Plus/wiki/config-custom-plugin",target:"_blank",rel:"noopener noreferrer nofollow",title:t.$t("common.help")}},[e("v-icon",[t._v("help")])],1)],1),e("v-card-text",{staticClass:"body"},[e("Editor",{attrs:{initData:t.selected},on:{change:t.change}})],1),e("v-divider"),e("v-card-actions",{staticClass:"pa-3 toolbar"},[e("v-spacer"),e("v-btn",{attrs:{flat:"",color:"error"},on:{click:t.cancel}},[e("v-icon",[t._v("cancel")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("common.cancel")))])],1),e("v-btn",{attrs:{flat:"",color:"success",disabled:!t.valid},on:{click:t.save}},[e("v-icon",[t._v("check_circle_outline")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("common.ok")))])],1)],1)],1)],1)],1)},_=[],b=a(p,f,_,!1,null,"efedd329",null,null);const $=b.exports,x=n.extend({components:{Editor:c},data(){return{show:!1,defaultItem:{},newData:{},valid:!1}},props:{value:Boolean,initData:Object},model:{prop:"value",event:"change"},watch:{show(){this.$emit("change",this.show)},value(){this.show=this.value,this.show&&(this.defaultItem=Object.assign({},this.initData))}},methods:{save(){this.$emit("save",this.newData),this.show=!1},cancel(){this.show=!1},change(i){console.log(i),this.newData=i.data,this.valid=i.valid}}});var P=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("v-dialog",{attrs:{fullscreen:""},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[e("v-card",[e("v-toolbar",{attrs:{dark:"",color:"blue-grey darken-2"}},[e("v-toolbar-title",[t._v(t._s(t.$t("settings.sitePlugins.edit.title")))]),e("v-spacer"),e("v-btn",{attrs:{icon:"",flat:"",color:"success",href:"https://github.com/pt-plugins/PT-Plugin-Plus/wiki/config-custom-plugin",target:"_blank",rel:"noopener noreferrer nofollow",title:t.$t("common.help")}},[e("v-icon",[t._v("help")])],1)],1),e("v-card-text",{staticClass:"body"},[e("Editor",{attrs:{initData:t.defaultItem},on:{change:t.change}})],1),e("v-divider"),e("v-card-actions",{staticClass:"pa-3 toolbar"},[e("v-spacer"),e("v-btn",{attrs:{flat:"",color:"error"},on:{click:t.cancel}},[e("v-icon",[t._v("cancel")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("common.cancel")))])],1),e("v-btn",{attrs:{flat:"",color:"success",disabled:!t.valid||t.defaultItem.readonly},on:{click:t.save}},[e("v-icon",[t._v("check_circle_outline")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("common.ok")))])],1)],1)],1)],1)},w=[],k=a(x,P,w,!1,null,"e92e93b4",null,null);const y=k.exports,C=n.extend({components:{AddItem:$,EditItem:y},data(){return{selected:[],pagination:{rowsPerPage:-1},showAddDialog:!1,showEditDialog:!1,site:{},selectedItem:{name:"",id:null,pages:[],scripts:[],styles:[],script:"",style:"",readonly:!1},dialogRemoveConfirm:!1,plugins:[],fileImport:null,errorMsg:"",haveError:!1,haveSuccess:!1,successMsg:""}},methods:{add(){this.showAddDialog=!0},edit(i){this.selectedItem=d.clone(i),i.id||(this.selectedItem.readonly=!0),this.showEditDialog=!0},removeConfirm(i){this.selectedItem=i,this.dialogRemoveConfirm=!0},remove(){this.dialogRemoveConfirm=!1,this.$store.commit("removePlugin",{host:this.site.host,plugin:this.selectedItem}),this.selectedItem={},this.reloadPlugins(this.site.host)},removeSelected(){confirm(this.$t("settings.sitePlugins.index.removeSelectedConfirm").toString())&&(this.selected.forEach(i=>{i.isCustom&&this.$store.commit("removePlugin",{host:this.site.host,plugin:i})}),this.selected=[],this.reloadPlugins(this.site.host))},updateItem(i){console.log(i),this.selectedItem=i,this.$store.commit("updatePlugin",{host:this.site.host,plugin:i}),this.reloadPlugins(this.site.host)},addItem(i){console.log(i),this.$store.commit("addPlugin",{host:this.site.host,plugin:i}),this.reloadPlugins(this.site.host)},reloadPlugins(i){if(this.site=this.$store.state.options.sites.find(t=>t.host==i),this.site){let t=[],e=this.site.schema;if(typeof e=="string"){let s=this.$store.state.options.system.schemas.find(l=>l.name==e);s&&t.push(...s.plugins)}else if(e&&e.plugins){let s=this.$store.state.options.system.sites.find(l=>l.host==i);s&&s.schema&&s.schema.plugins&&t.push(...s.schema.plugins)}this.site.plugins&&t.push(...this.site.plugins),this.plugins=t}},clearMessage(){this.successMsg="",this.errorMsg=""},share(i){let t=(this.site.host||this.site.name)+"-plugin-"+i.name+".json";const e=new Blob([JSON.stringify(i)],{type:"text/plain"});h.saveAs(e,t)},importConfig(){this.fileImport.click()},importConfigFile(i){this.clearMessage();let t=i.srcElement;if(t.files.length>0&&t.files[0].name.length>0){for(let e=0;e<t.files.length;e++){const s=t.files[e],l=new FileReader;l.onload=o=>{try{const r=JSON.parse(o.target.result);this.importPlugin(r)}catch(r){console.log(r),this.errorMsg=this.$t("common.importFailed").toString()}},l.onerror=()=>{this.errorMsg=this.$t("settings.backup.loadError").toString()},l.readAsText(s)}t.value=""}},importPlugin(i){if(!(i.name&&i.id&&i.isCustom&&i.pages&&i.pages.length>0)){this.errorMsg=this.$t("settings.sitePlugins.index.invalidPlugin").toString();return}const t=this.getPlugin(i);if(t){const e=window.prompt(this.$t("settings.sitePlugins.index.importNameDuplicate",{name:t.name}).toString());if(e){i.name=e,this.importPlugin(i);return}else return}this.addItem(i),this.successMsg=this.$t("common.importSuccess").toString()},getPlugin(i){const t=this.site.plugins;return t&&t.length>0?t.find(e=>e.name===i.name):null}},created(){let i=this.$route.params.host;console.log("create",this.$route.params),i&&this.reloadPlugins(i)},mounted(){this.fileImport=this.$refs.fileImport,this.fileImport.addEventListener("change",this.importConfigFile)},beforeDestroy(){this.fileImport.removeEventListener("change",this.importConfigFile)},computed:{headers(){return[{text:this.$t("settings.sitePlugins.index.headers.name"),align:"left",value:"name"},{text:this.$t("settings.sitePlugins.index.headers.pages"),align:"left",value:"pages"},{text:this.$t("settings.sitePlugins.index.headers.enable"),align:"left",value:"enable"},{text:this.$t("settings.sitePlugins.index.headers.action"),value:"name",sortable:!1}]}},watch:{successMsg(){this.haveSuccess=this.successMsg!=""},errorMsg(){this.haveError=this.errorMsg!=""}}});var I=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"site-plugins"},[e("v-alert",{attrs:{value:!0,type:"info"}},[t._v(t._s(t.$t("settings.sitePlugins.index.title"))+" ["+t._s(t.site.name)+"]")]),e("v-card",[e("v-card-title",[e("v-btn",{attrs:{color:"success"},on:{click:t.add}},[e("v-icon",{staticClass:"mr-2"},[t._v("add")]),t._v(" "+t._s(t.$t("common.add"))+" ")],1),e("v-btn",{attrs:{color:"error",disabled:t.selected.length==0},on:{click:t.removeSelected}},[e("v-icon",{staticClass:"mr-2"},[t._v("remove")]),t._v(" "+t._s(t.$t("common.remove"))+" ")],1),e("v-divider",{staticClass:"mx-3 mt-0",attrs:{inset:"",vertical:""}}),e("input",{ref:"fileImport",staticStyle:{display:"none"},attrs:{type:"file",multiple:"",accept:"application/json"}}),e("v-btn",{attrs:{color:"info"},on:{click:t.importConfig}},[e("v-icon",{staticClass:"mr-2"},[t._v("folder_open")]),t._v(" "+t._s(t.$t("settings.sites.index.importConfig"))+" ")],1),e("v-divider",{staticClass:"mx-3 mt-0",attrs:{inset:"",vertical:""}}),e("v-btn",{attrs:{color:"info",href:"https://github.com/pt-plugins/PT-Plugin-Plus/wiki/config-custom-plugin",target:"_blank",rel:"noopener noreferrer nofollow"}},[e("v-icon",{staticClass:"mr-2"},[t._v("help")]),t._v(" "+t._s(t.$t("settings.siteSearchEntry.index.help"))+" ")],1),e("v-spacer"),e("v-text-field",{staticClass:"search",attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""}})],1),e("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.plugins,pagination:t.pagination,"item-key":"name","select-all":""},on:{"update:pagination":function(s){t.pagination=s}},scopedSlots:t._u([{key:"items",fn:function(s){return[e("td",{staticStyle:{width:"20px"}},[s.item.isCustom?e("v-checkbox",{attrs:{primary:"","hide-details":""},model:{value:s.selected,callback:function(l){t.$set(s,"selected",l)},expression:"props.selected"}}):t._e()],1),e("td",[e("a",{on:{click:function(l){return t.edit(s.item)}}},[e("span",{staticClass:"ml-2"},[t._v(t._s(s.item.name))])])]),e("td",t._l(s.item.pages,function(l,o){return e("v-chip",{key:o,attrs:{label:"",color:"light-blue","text-color":"white",small:""}},[t._v(" "+t._s(l)+" ")])}),1),e("td",[t._v(t._s(s.item.url))]),e("td",[s.item.isCustom?e("v-icon",{staticClass:"mr-2",attrs:{small:"",title:t.$t("common.edit")},on:{click:function(l){return t.edit(s.item)}}},[t._v("edit")]):t._e(),s.item.isCustom?e("v-icon",{attrs:{small:"",color:"error",title:t.$t("common.remove")},on:{click:function(l){return t.removeConfirm(s.item)}}},[t._v("delete")]):t._e(),s.item.isCustom?e("v-icon",{staticClass:"ml-2",attrs:{small:"",color:"info",title:t.$t("common.share")},on:{click:function(l){return t.share(s.item)}}},[t._v("share")]):t._e()],1)]}}]),model:{value:t.selected,callback:function(s){t.selected=s},expression:"selected"}})],1),e("AddItem",{on:{save:t.addItem},model:{value:t.showAddDialog,callback:function(s){t.showAddDialog=s},expression:"showAddDialog"}}),e("EditItem",{attrs:{initData:t.selectedItem},on:{save:t.updateItem},model:{value:t.showEditDialog,callback:function(s){t.showEditDialog=s},expression:"showEditDialog"}}),e("v-dialog",{attrs:{width:"300"},model:{value:t.dialogRemoveConfirm,callback:function(s){t.dialogRemoveConfirm=s},expression:"dialogRemoveConfirm"}},[e("v-card",[e("v-card-title",{staticClass:"headline red lighten-2"},[t._v(t._s(t.$t("settings.sitePlugins.index.removeTitle")))]),e("v-card-text",[t._v(t._s(t.$t("settings.sitePlugins.index.removeConfirm")))]),e("v-divider"),e("v-card-actions",[e("v-spacer"),e("v-btn",{attrs:{flat:"",color:"info"},on:{click:function(s){t.dialogRemoveConfirm=!1}}},[e("v-icon",[t._v("cancel")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("common.cancel")))])],1),e("v-btn",{attrs:{color:"error",flat:""},on:{click:t.remove}},[e("v-icon",[t._v("check_circle_outline")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("common.ok")))])],1)],1)],1)],1),e("v-snackbar",{attrs:{top:"",timeout:3e3,color:"error"},model:{value:t.haveError,callback:function(s){t.haveError=s},expression:"haveError"}},[t._v(t._s(t.errorMsg))]),e("v-snackbar",{attrs:{bottom:"",timeout:3e3,color:"success"},model:{value:t.haveSuccess,callback:function(s){t.haveSuccess=s},expression:"haveSuccess"}},[t._v(t._s(t.successMsg))])],1)},D=[],S=a(C,I,D,!1,null,"f7fccac8",null,null);const M=S.exports;export{M as default};
