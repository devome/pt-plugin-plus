import{V as u,E as i,P as n,b as d,n as m}from"./index-CFTjSAoW.js";import{D as v}from"./DownloadTo-CBJzoX4I.js";const l=new d,h=u.extend({components:{DownloadTo:v},data(){return{selected:[],selectedItem:{},pagination:{rowsPerPage:10,sortBy:"time",descending:!0},items:[],dialogRemoveConfirm:!1,options:this.$store.state.options,errorMsg:"",haveError:!1,haveSuccess:!1,successMsg:"",siteCache:{},filterKey:"",filteredDatas:[]}},methods:{setDownloadOptions(o){console.log(o),o.payload.downloadOptions=o.downloadOptions,l.sendRequest(i.updateKeepUploadTask,null,o.payload)},clear(){confirm(this.$t("keepUploadTask.clearConfirm").toString())&&l.sendRequest(i.clearKeepUploadTask).then(o=>{console.log("clearKeepUploadTask",o),this.items=[]})},removeSelected(){this.selected&&this.selected.length>0&&confirm(this.$t("common.removeSelectedConfirm",{count:this.selected.length}).toString())&&this.remove(this.selected)},remove(o){o||(o=[this.selectedItem]),l.sendRequest(i.removeKeepUploadTask,null,o).then(e=>{console.log("removeKeepUploadTask",e),this.resetItems(e)}),this.dialogRemoveConfirm=!1},removeConfirm(o){this.selectedItem=o,this.dialogRemoveConfirm=!0},resetItems(o){this.items=[],o.forEach(e=>{e.items.forEach(t=>{t.site=n.getSiteFromHost(t.host,this.options)}),e.site=n.getSiteFromHost(e.items[0].host,this.options),this.items.push(e)})},loadKeepUploadTask(){l.sendRequest(i.loadKeepUploadTask).then(o=>{console.log(o),this.resetItems(o)})},getInfos(o){return""},clearMessage(){this.successMsg="",this.errorMsg=""},sendBaseTorrent(o){this.sendTorrentsInBackground(o.downloadOptions)},sendOtherTorrents(o){let e=[];o.items.slice(1).forEach(t=>{let s=n.clone(o.downloadOptions);s=Object.assign(s,{title:t.title,url:t.url,link:t.link,imdbId:t.imdbId}),e.push(s)}),this.sendTorrentsInBackground(e)},sendAllTorrents(o){let e=[];o.items.forEach(t=>{let s=n.clone(o.downloadOptions);s=Object.assign(s,{title:t.title,url:t.url,link:t.link,imdbId:t.imdbId}),e.push(s)}),this.sendTorrentsInBackground(e)},sendTorrentsInBackground(o){console.log(o),!(o.length>1&&!confirm(this.$t("keepUploadTask.sendConfirm",{count:o.length}).toString()))&&l.sendRequest(i.sendTorrentsInBackground,null,o).then(e=>{this.successMsg=this.$t("keepUploadTask.sendSuccess").toString(),console.log("命令执行完成",e),this.$emit("success",e)}).catch(e=>{console.log(e),this.errorMsg=this.$t("keepUploadTask.sendError").toString()}).finally(()=>{})},copyLinksToClipboard(o){let e=[];o.items.forEach(t=>{e.push(t.url)}),this.clearMessage(),l.sendRequest(i.copyTextToClipboard,null,e.join(`
`)).then(t=>{this.successMsg=this.$t("searchTorrent.copySelectedToClipboardSuccess",{count:e.length}).toString()}).catch(()=>{this.errorMsg=this.$t("searchTorrent.copyLinkToClipboardError").toString()})},searchResultFilter(o,e){if(e=e.toString().toLowerCase(),this.filteredDatas=[],e.trim()==="")return o;let t=e.split(" ");return this.filteredDatas=o.filter(s=>{let a=(s.title+(s.items[0].subTitle||"")).toLowerCase(),r=!0;return t.forEach(c=>{c.trim()!=""&&(r=r&&a.indexOf(c)>-1)}),r}),this.filteredDatas}},created(){this.loadKeepUploadTask()},computed:{headers(){return[{text:this.$t("keepUploadTask.headers.site"),align:"center",width:"60px",value:"site.name"},{text:this.$t("keepUploadTask.headers.title"),align:"left",value:"title"},{text:this.$t("keepUploadTask.headers.size"),align:"right",value:"size"},{text:this.$t("keepUploadTask.headers.time"),align:"left",value:"time"},{text:this.$t("history.headers.action"),value:"name",sortable:!1}]}},watch:{successMsg(){this.haveSuccess=this.successMsg!=""},errorMsg(){this.haveError=this.errorMsg!=""}}});var p=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",[t("v-alert",{attrs:{value:!0,type:"info"}},[e._v(e._s(e.$t("keepUploadTask.title")))]),t("v-card",[t("v-card-title",[t("v-btn",{attrs:{color:"error",disabled:e.selected.length==0},on:{click:e.removeSelected}},[t("v-icon",{staticClass:"mr-2"},[e._v("remove")]),e._v(" "+e._s(e.$t("common.remove"))+" ")],1),t("v-btn",{attrs:{color:"error",disabled:e.items.length==0},on:{click:e.clear}},[t("v-icon",{staticClass:"mr-2"},[e._v("clear")]),e._v(" "+e._s(e.$t("common.clear"))+" ")],1),t("v-btn",{attrs:{color:"info",href:"https://github.com/pt-plugins/PT-Plugin-Plus/wiki/keep-upload-task",target:"_blank",rel:"noopener noreferrer nofollow"}},[t("v-icon",{staticClass:"mr-2"},[e._v("help")]),e._v(" "+e._s(e.$t("settings.searchSolution.index.help"))+" ")],1),t("v-spacer"),t("v-text-field",{staticClass:"search",attrs:{"append-icon":"search",label:e.$t("keepUploadTask.filterSearchResults"),"single-line":"","hide-details":"",enterkeyhint:"search"},model:{value:e.filterKey,callback:function(s){e.filterKey=s},expression:"filterKey"}})],1),t("v-data-table",{staticClass:"elevation-1",attrs:{search:e.filterKey,"custom-filter":e.searchResultFilter,headers:e.headers,items:e.items,pagination:e.pagination,"item-key":"id","select-all":""},on:{"update:pagination":function(s){e.pagination=s}},scopedSlots:e._u([{key:"items",fn:function(s){return[t("tr",{on:{click:function(a){s.expanded=!s.expanded}}},[t("td",{staticStyle:{width:"20px"}},[t("v-checkbox",{attrs:{primary:"","hide-details":""},model:{value:s.selected,callback:function(a){e.$set(s,"selected",a)},expression:"props.selected"}})],1),t("td",{staticClass:"text-xs-center"},[t("v-avatar",{attrs:{size:"18"}},[t("img",{attrs:{src:s.item.site.icon}})]),t("br"),t("span",{staticClass:"caption"},[e._v(e._s(s.item.site.name))])],1),t("td",{staticClass:"py-2"},[t("a",{staticClass:"subheading",attrs:{href:s.item.items[0].link,target:"_blank",title:s.item.title,rel:"noopener noreferrer nofollow"},domProps:{innerHTML:e._s(s.item.title)}}),t("div",{staticClass:"body-1"},[s.item.items[0].subTitle?t("span",[e._v(e._s(s.item.items[0].subTitle))]):e._e()]),t("div",{staticClass:"caption"},[e._v(" "+e._s(e.$t("keepUploadTask.savePath"))+e._s(s.item.downloadOptions.clientName)+" -> "+e._s(s.item.downloadOptions.savePath||e.$t("keepUploadTask.defaultPath"))+" "),t("DownloadTo",{attrs:{flat:"",icon:"",small:"",title:e.$t("keepUploadTask.setSavePath"),iconText:"edit","get-options-only":"",payload:s.item,downloadOptions:s.item.items[0]},on:{itemClick:e.setDownloadOptions}})],1),t("div",{staticClass:"caption"},[e._v(" "+e._s(e.$t("keepUploadTask.torrentCount"))+e._s(s.item.items.length)+" ")])]),t("td",{staticClass:"text-xs-right"},[e._v(e._s(e._f("formatSize")(s.item.size)))]),t("td",[e._v(e._s(e._f("formatDate")(s.item.time)))]),t("td",[t("v-btn",{staticClass:"mx-0",attrs:{small:"",color:"success",icon:"",flat:"",title:e.$t("keepUploadTask.sendBaseTorrent")},on:{click:function(a){return a.stopPropagation(),e.sendBaseTorrent(s.item)}}},[t("v-icon",{attrs:{small:""}},[e._v("filter_1")])],1),t("v-btn",{staticClass:"mx-0",attrs:{small:"",color:"info",icon:"",flat:"",title:e.$t("keepUploadTask.sendOtherTorrents")},on:{click:function(a){return a.stopPropagation(),e.sendOtherTorrents(s.item)}}},[t("v-icon",{attrs:{small:""}},[e._v("filter_2")])],1),t("v-btn",{staticClass:"mx-0",attrs:{small:"",color:"primary",icon:"",flat:"",title:e.$t("keepUploadTask.sendAllTorrents")},on:{click:function(a){return a.stopPropagation(),e.sendAllTorrents(s.item)}}},[t("v-icon",{attrs:{small:""}},[e._v("save_alt")])],1),t("v-btn",{staticClass:"mx-0",attrs:{color:"info",small:"",icon:"",flat:"",title:e.$t("searchTorrent.copyToClipboardTip")},on:{click:function(a){return a.stopPropagation(),e.copyLinksToClipboard(s.item)}}},[t("v-icon",{attrs:{small:""}},[e._v("file_copy")])],1),t("v-btn",{staticClass:"mx-0",attrs:{small:"",color:"error",icon:"",flat:"",title:e.$t("common.remove")},on:{click:function(a){return a.stopPropagation(),e.removeConfirm(s.item)}}},[t("v-icon",{attrs:{small:""}},[e._v("delete")])],1)],1)])]}},{key:"expand",fn:function(s){return[t("v-list",{staticClass:"ml-5",attrs:{subheader:"",dense:""}},[e._l(s.item.items,function(a){return[t("v-list-tile",{key:a.link,staticClass:"ml-5"},[t("v-list-tile-avatar",[t("v-avatar",{attrs:{size:"18"}},[t("img",{attrs:{src:a.site.icon}})])],1),t("v-list-tile-content",[t("v-list-tile-title",[t("a",{attrs:{href:a.link,target:"_blank",title:a.title,rel:"noopener noreferrer nofollow"},domProps:{innerHTML:e._s(a.title)}})]),t("v-list-tile-sub-title",[e._v(e._s(a.subTitle))])],1)],1)]})],2)]}}]),model:{value:e.selected,callback:function(s){e.selected=s},expression:"selected"}})],1),t("v-alert",{attrs:{value:!0,color:"warning"}},[t("div",[e._v(" 警告： "),t("ul",[t("li",[e._v(" 辅种前请确认下载服务器已关闭类似于 “自动开始下载” 的选项（如果有）。 ")]),t("li",[e._v(" 助手仅对种子文件做简单验证，不保证辅种成功，请自行斟酌是否要使用辅种功能！ ")]),t("li",[e._v(" 如出现因辅种失败造成的爆仓，由用户自行负责！别找我，别找我，别找我。 ")])])])]),t("v-dialog",{attrs:{width:"300"},model:{value:e.dialogRemoveConfirm,callback:function(s){e.dialogRemoveConfirm=s},expression:"dialogRemoveConfirm"}},[t("v-card",[t("v-card-title",{staticClass:"headline red lighten-2"},[e._v(e._s(e.$t("keepUploadTask.removeConfirmTitle")))]),t("v-card-text",[e._v(e._s(e.$t("keepUploadTask.removeConfirm")))]),t("v-divider"),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{flat:"",color:"info"},on:{click:function(s){e.dialogRemoveConfirm=!1}}},[t("v-icon",[e._v("cancel")]),t("span",{staticClass:"ml-1"},[e._v(e._s(e.$t("common.cancel")))])],1),t("v-btn",{attrs:{color:"error",flat:""},on:{click:function(s){return e.remove()}}},[t("v-icon",[e._v("check_circle_outline")]),t("span",{staticClass:"ml-1"},[e._v(e._s(e.$t("common.ok")))])],1)],1)],1)],1),t("v-snackbar",{attrs:{top:"",timeout:3e3,color:"error"},model:{value:e.haveError,callback:function(s){e.haveError=s},expression:"haveError"}},[e._v(e._s(e.errorMsg))]),t("v-snackbar",{attrs:{bottom:"",timeout:3e3,color:"success"},model:{value:e.haveSuccess,callback:function(s){e.haveSuccess=s},expression:"haveSuccess"}},[e._v(e._s(e.successMsg))])],1)},f=[],k=m(h,p,f,!1,null,null,null,null);const C=k.exports;export{C as default};
