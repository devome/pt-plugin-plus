import{z as l,F as n}from"./index-C2uF3Qql.js";const p=["red","pink","purple","deep-purple","indigo","blue","light-blue","cyan","teal","green","light-green","lime","yellow","amber","orange","deep-orange","brown","blue-grey","grey","black"];class f{constructor(e){this.options=e,this.count=0,this.completedCount=0,this.downloadingCount=0,this.files={},this.queues=[],e.files&&e.files.forEach(t=>{this.push(t)})}push(e){if(!(!e.url||e.url&&this.files[e.url])){var t=new d(e);t.onCompleted=()=>{this.downloadingCount--,this.completedCount++,this.onCompleted(t),delete this.files[t.url]},t.onStart=()=>{this.downloadingCount++},t.onError=s=>{this.downloadingCount--,this.completedCount++,this.options.onError&&this.options.onError.call(this,t,s),delete this.files[t.url]},t.onProgress=(s,i,o)=>{this.options.onProgress&&this.options.onProgress.call(this,t,s,i,o)},this.files[t.url]=t,this.queues.push(t),this.count++,this.options.autoStart&&t.start()}}start(){}onCompleted(e){this.options.onCompleted&&this.options.onCompleted.call(this,e)}}class d{constructor(e){this.lastTime=0,this.startTime=0,this.status=0,this.statusText="",this.url="",this.requestMethod=l.GET,this.postData=null,this.fileName="",this.loaded=0,this.total=0,this.percent=0,this.speed=0,this.showSpeed="",this.onProgress=function(){},this.onCompleted=function(){},this.onError=function(){},this.onStart=function(){},this.getDataOnly=!1,this.timeout=0,this.xhr=new XMLHttpRequest,this.fileName=e.fileName||"",this.url=e.url,this.getDataOnly=e.getDataOnly||!1,this.timeout=e.timeout||0,this.requestMethod=e.method||l.GET}start(){this.lastTime=+new Date,this.startTime=this.lastTime,this.statusText="数据准备中……",this.timeout>0&&(this.xhr.timeout=this.timeout),this.xhr.open(this.requestMethod,this.url,!0),this.xhr.responseType="blob",this.xhr.onreadystatechange=()=>{switch(this.xhr.readyState){case 4:switch(this.xhr.status){case 200:case 302:this.content=this.xhr.response,this.downloadCompleted();break;default:this.xhr.status!=0&&this.downloadError(`[${this.url}] 下载失败，返回的状态码为：${this.xhr.status}`);break}break;case 2:var t=this.xhr.getResponseHeader("Content-Disposition");t&&!this.fileName&&!this.getDataOnly&&(this.fileName=this.getFileName(t));break}},this.xhr.onprogress=t=>{this.loaded=t.loaded,this.total=t.total,this.percent=(100*(t.loaded/t.total)).toFixed(2),this.lastTime=+new Date,this.speed=this.loaded/(this.startTime-this.lastTime),this.updateProgress()},this.xhr.onerror=t=>{this.downloadError(t)},this.xhr.ontimeout=()=>{this.downloadError(`[${this.url}] 下载超时`)};var e=null;this.postData&&(e=$.param(this.postData)),this.requestMethod==l.POST&&this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.xhr.send(e),this.onStart&&this.onStart.call(this)}getFileName(e=""){let t=e.split(";"),s={},i="";for(let h=0;h<t.length;h++){let r=t[h].replace(" ","").split("=");r.length==2&&(s[r[0]]=r[1].trim())}let o;if(o=s["filename*"]){let h=o.lastIndexOf("'");i=o.substr(h+1)}else i=s.filename;return i=i.replace(/"/g,""),decodeURI(i)}downloadCompleted(){this.loaded>0&&!this.getDataOnly&&n.saveAs(this.content,this.fileName),this.onCompleted&&this.onCompleted.call(this)}downloadError(e){this.onError&&this.onError.call(this,e)}updateProgress(){this.onProgress&&this.onProgress.call(this,this.loaded,this.total,this.speed)}}export{p as B,f as D,d as F};
