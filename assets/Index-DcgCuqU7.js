import{V as l,n,C as h,P as o}from"./index-CFTjSAoW.js";const u=l.extend({data(){return{rules:{require:[a=>!!a||"!"]},checked:[],categoryConfig:{}}},props:{data:{type:Object,default:()=>({valid:!1})},site:Object},watch:{"data.categories"(){let a=[];this.data&&this.data.categories&&this.data.categories.length>0&&this.data.categories.forEach(e=>{let t=this.category.find(s=>s.id==e);t&&a.push(t.key)}),this.categoryConfig.appendToSearchKey?this.data.appendToSearchKeyString=a.join(""):this.data.queryString=a.join("")}},methods:{remove(a){let e=this.data.categories.findIndex(t=>a.id===t.id);e!=-1&&this.data.categories.splice(e,1)}},computed:{category(){let a=this.site,e=[];return a.categories&&a.categories.find(t=>{if(t.category&&(t.entry=="*"||this.data.entry&&this.data.entry.indexOf(t.entry)>-1)){this.categoryConfig=t;let s=t.result+"";return t.category.forEach(i=>{e.push(Object.assign({key:s.replace(/\$id\$/gi,i.id+"")},i))}),!0}return!1}),e}}});var m=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("v-card",{attrs:{color:e.$vuetify.dark?"":"grey lighten-4"}},[t("v-card-text",[t("v-form",{model:{value:e.data.valid,callback:function(s){e.$set(e.data,"valid",s)},expression:"data.valid"}},[t("v-text-field",{ref:"name",attrs:{label:e.$t("settings.siteSearchEntry.editor.name"),placeholder:e.$t("settings.siteSearchEntry.editor.name"),required:"",rules:e.rules.require,disabled:!e.data.isCustom},model:{value:e.data.name,callback:function(s){e.$set(e.data,"name",s)},expression:"data.name"}}),t("v-text-field",{attrs:{label:e.$t("settings.siteSearchEntry.editor.entry"),placeholder:e.$t("settings.siteSearchEntry.editor.entry"),disabled:!e.data.isCustom},model:{value:e.data.entry,callback:function(s){e.$set(e.data,"entry",s)},expression:"data.entry"}}),e.category&&e.category.length?t("v-autocomplete",{attrs:{items:e.category,label:e.$t("settings.siteSearchEntry.editor.category"),"item-text":"name","item-value":"id",chips:"",clearable:"",multiple:"",disabled:!e.data.isCustom},scopedSlots:e._u([{key:"selection",fn:function(s){return[t("v-chip",{attrs:{small:"",selected:s.selected,close:""},on:{input:function(i){return e.remove(s.item)}}},[e._v(e._s(s.item.name))])]}}],null,!1,560667869),model:{value:e.data.categories,callback:function(s){e.$set(e.data,"categories",s)},expression:"data.categories"}}):e._e(),t("v-text-field",{attrs:{label:e.$t("settings.siteSearchEntry.editor.queryString"),placeholder:e.$t("settings.siteSearchEntry.editor.queryString"),disabled:!e.data.isCustom},model:{value:e.data.queryString,callback:function(s){e.$set(e.data,"queryString",s)},expression:"data.queryString"}}),t("v-text-field",{attrs:{label:e.$t("settings.siteSearchEntry.editor.parseScriptFile"),placeholder:e.$t("settings.siteSearchEntry.editor.parseScriptFile"),disabled:!e.data.isCustom},model:{value:e.data.parseScriptFile,callback:function(s){e.$set(e.data,"parseScriptFile",s)},expression:"data.parseScriptFile"}}),t("v-textarea",{attrs:{label:e.$t("settings.siteSearchEntry.editor.parseScript"),height:"200",disabled:!e.data.isCustom},model:{value:e.data.parseScript,callback:function(s){e.$set(e.data,"parseScript",s)},expression:"data.parseScript"}}),t("v-textarea",{attrs:{label:e.$t("settings.siteSearchEntry.editor.resultSelector"),height:"80",disabled:!e.data.isCustom},model:{value:e.data.resultSelector,callback:function(s){e.$set(e.data,"resultSelector",s)},expression:"data.resultSelector"}})],1)],1)],1)},v=[],f=n(u,m,v,!1,null,null,null,null);const c=f.exports,g=l.extend({components:{Editor:c},data(){return{show:!1,selected:{isCustom:!0},valid:!1}},props:{value:Boolean,site:Object},model:{prop:"value",event:"change"},watch:{show(){this.$emit("change",this.show),this.show||(this.selected={isCustom:!0})},value(){this.show=this.value}},methods:{save(){this.$emit("save",Object.assign({isCustom:!0,resultType:h.HTML},this.selected)),this.show=!1},cancel(){this.show=!1}}});var _=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",[t("v-dialog",{attrs:{"max-width":"900"},model:{value:e.show,callback:function(s){e.show=s},expression:"show"}},[t("v-card",[t("v-card-title",{staticClass:"headline blue-grey darken-2",staticStyle:{color:"white"}},[e._v(e._s(e.$t("settings.siteSearchEntry.add.title")))]),t("v-card-text",[t("Editor",{attrs:{data:e.selected,site:e.site}})],1),t("v-divider"),t("v-card-actions",{staticClass:"pa-3"},[t("v-spacer"),t("v-btn",{attrs:{flat:"",color:"error"},on:{click:e.cancel}},[t("v-icon",[e._v("cancel")]),t("span",{staticClass:"ml-1"},[e._v(e._s(e.$t("common.cancel")))])],1),t("v-btn",{attrs:{flat:"",color:"success",disabled:!e.selected.valid},on:{click:e.save}},[t("v-icon",[e._v("check_circle_outline")]),t("span",{staticClass:"ml-1"},[e._v(e._s(e.$t("common.ok")))])],1)],1)],1)],1)],1)},p=[],y=n(g,_,p,!1,null,null,null,null);const $=y.exports,b=l.extend({components:{Editor:c},data(){return{show:!1,defaultItem:{}}},props:{value:Boolean,data:Object,site:Object},model:{prop:"value",event:"change"},watch:{show(){this.$emit("change",this.show)},value(){this.show=this.value,this.show&&(this.defaultItem=Object.assign({},this.data))}},methods:{save(){this.$emit("save",this.defaultItem),this.show=!1},cancel(){this.show=!1}}});var x=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("v-dialog",{attrs:{"max-width":"900"},model:{value:e.show,callback:function(s){e.show=s},expression:"show"}},[t("v-card",[t("v-card-title",{staticClass:"headline blue-grey darken-2",staticStyle:{color:"white"}},[e._v(e._s(e.$t("settings.siteSearchEntry.edit.title")))]),t("v-card-text",[t("Editor",{attrs:{data:e.defaultItem,site:e.site}})],1),t("v-divider"),t("v-card-actions",{staticClass:"pa-3"},[t("v-spacer"),t("v-btn",{attrs:{flat:"",color:"error"},on:{click:e.cancel}},[t("v-icon",[e._v("cancel")]),t("span",{staticClass:"ml-1"},[e._v(e._s(e.$t("common.cancel")))])],1),t("v-btn",{attrs:{flat:"",color:"success",disabled:!e.defaultItem.valid&&!e.defaultItem.isCustom},on:{click:e.save}},[t("v-icon",[e._v("check_circle_outline")]),t("span",{staticClass:"ml-1"},[e._v(e._s(e.$t("common.ok")))])],1)],1)],1)],1)},S=[],C=n(b,x,S,!1,null,null,null,null);const E=C.exports,k=l.extend({components:{AddItem:$,EditItem:E},data(){return{selected:[],pagination:{rowsPerPage:-1},showAddDialog:!1,showEditDialog:!1,site:{},selectedItem:{},dialogRemoveConfirm:!1,searchEntry:[],options:this.$store.state.options}},methods:{add(){this.showAddDialog=!0},copy(a){let e=Object.assign({},a);e.name+=" Copy",e.isCustom=!0,this.addItem(e)},edit(a){a&&(this.selectedItem=a,this.showEditDialog=!0)},removeConfirm(a){this.selectedItem=a,this.dialogRemoveConfirm=!0},remove(){this.dialogRemoveConfirm=!1,this.$store.dispatch("removeSiteSearchEntry",{host:this.site.host,item:this.selectedItem}),this.selectedItem={},this.reloadEntry(this.site.host)},removeSelected(){confirm(this.$t("settings.siteSearchEntry.index.removeSelectedConfirm").toString())&&(this.selected.forEach(a=>{this.$store.dispatch("removeSiteSearchEntry",{host:this.site.host,item:a})}),this.selected=[],this.reloadEntry(this.site.host))},updateItem(a){console.log(a),this.selectedItem=a,this.$store.dispatch("updateSiteSearchEntry",{host:this.site.host,item:a}),this.reloadEntry(this.site.host)},addItem(a){console.log(a),this.$store.dispatch("addSiteSearchEntry",{host:this.site.host,item:a}),this.reloadEntry(this.site.host)},reloadEntry(a){let e=this.$store.state.options.sites.find(t=>t.host==a);if(e){this.site=o.clone(e);let t=this.options.system.sites.find(i=>i.host==a);t&&(this.site.categories=o.clone(t.categories));let s=[];if(this.site.searchEntry&&this.site.searchEntry.length>0)s.push(...this.site.searchEntry);else{let i=this.site.schema;if(typeof i=="string"){let r=this.$store.state.options.system.schemas.find(d=>d.name==i);r&&s.push(...r.searchEntry)}}this.searchEntry=o.clone(s)}},getCategory(a){let e=this.site,t=[];return e.categories&&a.categories&&e.categories.forEach(s=>{s.category&&(s.entry=="*"||a.entry.indexOf(s.entry))&&s.category.forEach(i=>{a.categories&&a.categories.includes(i.id)&&t.push(i.name)})}),t}},created(){let a=this.$route.params.host;console.log("create",this.$route.params),a&&this.reloadEntry(a)},computed:{headers(){return[{text:this.$t("settings.siteSearchEntry.index.headers.name"),align:"left",value:"name"},{text:this.$t("settings.siteSearchEntry.index.headers.categories"),align:"left",value:"categories"},{text:this.$t("settings.siteSearchEntry.index.headers.enable"),align:"left",value:"enable"},{text:this.$t("settings.siteSearchEntry.index.headers.action"),value:"name",sortable:!1}]}}});var w=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"site-search-entry"},[t("v-alert",{attrs:{value:!0,type:"info"}},[e._v(e._s(e.$t("settings.siteSearchEntry.index.title"))+" ["+e._s(e.site.name)+"]")]),t("v-card",[t("v-card-title",[t("v-btn",{attrs:{color:"success"},on:{click:e.add}},[t("v-icon",{staticClass:"mr-2"},[e._v("add")]),e._v(" "+e._s(e.$t("common.add"))+" ")],1),t("v-btn",{attrs:{color:"error",disabled:e.selected.length==0},on:{click:e.removeSelected}},[t("v-icon",{staticClass:"mr-2"},[e._v("remove")]),e._v(" "+e._s(e.$t("common.remove"))+" ")],1),t("v-btn",{attrs:{color:"info",href:"https://github.com/pt-plugins/PT-Plugin-Plus/wiki/search-entry-definition",target:"_blank",rel:"noopener noreferrer nofollow"}},[t("v-icon",{staticClass:"mr-2"},[e._v("help")]),e._v(" "+e._s(e.$t("settings.siteSearchEntry.index.help"))+" ")],1),t("v-spacer"),t("v-text-field",{staticClass:"search",attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""}})],1),t("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.searchEntry,pagination:e.pagination,"item-key":"name","select-all":""},on:{"update:pagination":function(s){e.pagination=s}},scopedSlots:e._u([{key:"items",fn:function(s){return[t("td",{staticStyle:{width:"20px"}},[s.item.isCustom?t("v-checkbox",{attrs:{primary:"","hide-details":""},model:{value:s.selected,callback:function(i){e.$set(s,"selected",i)},expression:"props.selected"}}):e._e()],1),t("td",[t("a",{on:{click:function(i){return e.edit(s.item)}}},[t("span",{staticClass:"ml-2"},[e._v(e._s(s.item.name))])])]),t("td",{staticClass:"cat"},[e._l(e.getCategory(s.item),function(i,r){return[t("v-chip",{key:r,staticClass:"mr-2 pl-0",attrs:{label:"",color:"blue-grey","text-color":"white",small:"",disabled:""}},[e._v(e._s(i))])]})],2),t("td",[t("v-switch",{attrs:{"true-value":"true","false-value":"false","input-value":s.item.enabled?"true":"false","hide-details":""}})],1),t("td",[t("v-icon",{staticClass:"mr-2",attrs:{small:"",title:e.$t("common.copy")},on:{click:function(i){return e.copy(s.item)}}},[e._v("file_copy")]),s.item.isCustom?t("v-icon",{staticClass:"mr-2",attrs:{small:"",title:e.$t("common.edit")},on:{click:function(i){return e.edit(s.item)}}},[e._v("edit")]):e._e(),s.item.isCustom?t("v-icon",{attrs:{small:"",color:"error",title:e.$t("common.remove")},on:{click:function(i){return e.removeConfirm(s.item)}}},[e._v("delete")]):e._e()],1)]}}]),model:{value:e.selected,callback:function(s){e.selected=s},expression:"selected"}})],1),t("AddItem",{attrs:{site:e.site},on:{save:e.addItem},model:{value:e.showAddDialog,callback:function(s){e.showAddDialog=s},expression:"showAddDialog"}}),t("EditItem",{attrs:{site:e.site,data:e.selectedItem},on:{save:e.updateItem},model:{value:e.showEditDialog,callback:function(s){e.showEditDialog=s},expression:"showEditDialog"}}),t("v-dialog",{attrs:{width:"300"},model:{value:e.dialogRemoveConfirm,callback:function(s){e.dialogRemoveConfirm=s},expression:"dialogRemoveConfirm"}},[t("v-card",[t("v-card-title",{staticClass:"headline red lighten-2"},[e._v(e._s(e.$t("settings.siteSearchEntry.index.removeTitle")))]),t("v-card-text",[e._v(e._s(e.$t("settings.siteSearchEntry.index.removeConfirm")))]),t("v-divider"),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{flat:"",color:"info"},on:{click:function(s){e.dialogRemoveConfirm=!1}}},[t("v-icon",[e._v("cancel")]),t("span",{staticClass:"ml-1"},[e._v(e._s(e.$t("common.cancel")))])],1),t("v-btn",{attrs:{color:"error",flat:""},on:{click:e.remove}},[t("v-icon",[e._v("check_circle_outline")]),t("span",{staticClass:"ml-1"},[e._v(e._s(e.$t("common.ok")))])],1)],1)],1)],1)],1)},I=[],R=n(k,w,I,!1,null,"565e224d",null,null);const j=R.exports;export{j as default};
