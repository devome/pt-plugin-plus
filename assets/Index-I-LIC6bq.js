import{V as n,E as r,b as d,n as a}from"./index-C9rdr-_b.js";const c=new d,v=n.extend({data(){return{showPassword:!1,categoryText:"",rules:{require:[o=>!!o||"!"],url:o=>/^(https?):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;\[\]]+[-A-Za-z0-9+&@#/%=~_|]$/.test(o)||this.$t("settings.downloadClients.editor.addressTip")},testing:!1,haveError:!1,haveSuccess:!1,successMsg:"",errorMsg:"",testButtonIcon:"compass_calibration",testButtonColor:"info",testButtonStatus:{success:"success",error:"error"},buttonColor:{default:"info",success:"success",error:"error"},buttonIcon:{default:"compass_calibration",success:"done",error:"close"}}},props:{option:Object},watch:{option(){console.log("watch option",this.option);let o=this.option.qbCategories||[];this.categoryText=o.map(t=>`${t.name},${t.path}`).join(`
`)},categoryText(){this.option.qbCategories=this.categoryText.split(/\n/).filter(o=>!!o).map(o=>o.split(/\s*[,ï¼Œ]\s*/)).filter(([o,t])=>!!o&&!!t).map(([o,t])=>({name:o,path:t}))},successMsg(){this.haveSuccess=this.successMsg!=""},errorMsg(){this.haveError=this.errorMsg!=""}},methods:{testClientConnectivity(){this.successMsg="",this.errorMsg="";let o=Object.assign({},this.option);if(!o.address){this.errorMsg=this.$t("settings.downloadClients.editor.testAddressError").toString();return}this.testing=!0,c.sendRequest(r.testClientConnectivity,null,o).then(t=>{console.log(t),t.success?(this.successMsg=this.$t("settings.downloadClients.editor.testSuccess").toString(),this.setTestButtonStatus(this.testButtonStatus.success)):t&&t.data?t.data.msg?this.errorMsg=t.data.msg:t.data.code===0?this.errorMsg=this.$t("settings.downloadClients.editor.testConnectionError").toString():this.errorMsg=this.$t("settings.downloadClients.editor.testOtherError",{code:t.data.code}).toString():this.errorMsg=this.$t("settings.downloadClients.editor.testUnknownError").toString(),this.errorMsg&&this.setTestButtonStatus(this.testButtonStatus.error),this.testing=!1}).catch(t=>{console.log(t),t&&t.data&&t.data.msg?this.errorMsg=t.data.msg:this.errorMsg=this.$t("settings.downloadClients.editor.testError").toString(),this.setTestButtonStatus(this.testButtonStatus.error),this.testing=!1})},setTestButtonStatus(o){this.testButtonIcon=this.buttonIcon[o],this.testButtonColor=this.buttonColor[o],window.setTimeout(()=>{this.testButtonIcon=this.buttonIcon.default,this.testButtonColor=this.buttonColor.default,this.successMsg="",this.errorMsg=""},3e3)}}});var u=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",[e("v-card",{staticClass:"mb-5",attrs:{color:t.$vuetify.dark?"":"grey lighten-4"}},[e("v-card-text",[e("v-form",{model:{value:t.option.valid,callback:function(s){t.$set(t.option,"valid",s)},expression:"option.valid"}},[e("v-text-field",{attrs:{label:t.$t("settings.downloadClients.editor.name"),placeholder:t.$t("settings.downloadClients.editor.name"),required:"",rules:t.rules.require},model:{value:t.option.name,callback:function(s){t.$set(t.option,"name",s)},expression:"option.name"}}),e("v-text-field",{attrs:{label:t.$t("settings.downloadClients.editor.address"),placeholder:t.$t("settings.downloadClients.editor.addressTip"),required:"",rules:[t.rules.url]},model:{value:t.option.address,callback:function(s){t.$set(t.option,"address",s)},expression:"option.address"}}),t.option.passwordOnly?t._e():e("v-text-field",{attrs:{label:t.$t("settings.downloadClients.editor.loginName"),placeholder:t.$t("settings.downloadClients.editor.loginName")},model:{value:t.option.loginName,callback:function(s){t.$set(t.option,"loginName",s)},expression:"option.loginName"}}),e("v-text-field",{attrs:{label:t.$t("settings.downloadClients.editor.loginPwd"),placeholder:t.$t("settings.downloadClients.editor.loginPwd"),type:t.showPassword?"text":"password","append-icon":t.showPassword?"visibility_off":"visibility"},on:{"click:append":function(s){t.showPassword=!t.showPassword}},model:{value:t.option.loginPwd,callback:function(s){t.$set(t.option,"loginPwd",s)},expression:"option.loginPwd"}}),e("v-switch",{attrs:{label:t.$t("settings.downloadClients.editor.enabled")},model:{value:t.option.enabled,callback:function(s){t.$set(t.option,"enabled",s)},expression:"option.enabled"}}),["transmission","qbittorrent"].includes(t.option.type)?e("v-switch",{attrs:{label:t.$t("settings.downloadClients.editor.autoStart")},model:{value:t.option.autoStart,callback:function(s){t.$set(t.option,"autoStart",s)},expression:"option.autoStart"}}):t._e(),["qbittorrent"].includes(t.option.type)?e("v-switch",{attrs:{label:t.$t("settings.downloadClients.editor.tagIMDb")},model:{value:t.option.tagIMDb,callback:function(s){t.$set(t.option,"tagIMDb",s)},expression:"option.tagIMDb"}}):t._e(),e("v-switch",{attrs:{label:t.$t("settings.downloadClients.editor.hostnameAsTag")},model:{value:t.option.hostnameAsTag,callback:function(s){t.$set(t.option,"hostnameAsTag",s)},expression:"option.hostnameAsTag"}}),e("v-switch",{attrs:{label:t.$t("settings.downloadClients.editor.siteNameAsTag")},model:{value:t.option.siteNameAsTag,callback:function(s){t.$set(t.option,"siteNameAsTag",s)},expression:"option.siteNameAsTag"}}),e("v-switch",{attrs:{label:t.$t("settings.downloadClients.editor.enableCategory")},model:{value:t.option.enableCategory,callback:function(s){t.$set(t.option,"enableCategory",s)},expression:"option.enableCategory"}}),t.option.enableCategory?e("v-textarea",{attrs:{label:t.$t("settings.downloadClients.editor.enableCategoryText"),hint:t.$t("settings.downloadClients.editor.enableCategoryTextTip")},model:{value:t.categoryText,callback:function(s){t.categoryText=s},expression:"categoryText"}}):t._e(),e("v-text-field",{attrs:{value:t.option.type,label:t.$t("settings.downloadClients.editor.type"),disabled:""}}),e("v-text-field",{attrs:{label:t.$t("settings.downloadClients.editor.id"),disabled:"",value:t.option.id,placeholder:t.$t("settings.downloadClients.editor.autoCreate")}})],1),e("v-btn",{attrs:{flat:"",block:"",color:t.testButtonColor,loading:t.testing,disabled:t.testing||!t.option.valid},on:{click:t.testClientConnectivity}},[e("v-icon",{staticClass:"mr-2"},[t._v(t._s(t.testButtonIcon))]),t._v(" "+t._s(t.successMsg||t.errorMsg||t.$t("settings.downloadClients.editor.test"))+" ")],1),t.option.description?e("v-alert",{attrs:{value:!0,color:"info"}},[t._v(t._s(t.option.description))]):t._e(),t.option.warning?e("v-alert",{attrs:{value:!0,color:"warning"}},[t._v(t._s(t.option.warning))]):t._e()],1)],1),e("v-snackbar",{attrs:{absolute:"",top:"",timeout:3e3,color:"error"},model:{value:t.haveError,callback:function(s){t.haveError=s},expression:"haveError"}},[t._v(t._s(t.errorMsg))]),e("v-snackbar",{attrs:{absolute:"",bottom:"",timeout:3e3,color:"success"},model:{value:t.haveSuccess,callback:function(s){t.haveSuccess=s},expression:"haveSuccess"}},[t._v(t._s(t.successMsg))])],1)},p=[],h=a(v,u,p,!1,null,null,null,null);const l=h.exports,m=n.extend({components:{Editor:l},data(){return{step:1,show:!1,stepCount:2,selectedData:{},selectedItem:{},valid:!1,items:this.$store.state.options.system.clients,options:this.$store.state.options}},props:{value:Boolean},model:{prop:"value",event:"change"},watch:{show(){this.$emit("change",this.show),this.show||(this.step=1,this.selectedItem={name:""})},value(){this.show=this.value}},methods:{save(){this.$emit("save",this.selectedData),this.show=!1},next(o){this.selectedItem&&this.selectedItem.name?(this.selectedData=Object.assign({},this.selectedItem),this.selectedData.enabled===void 0&&(this.selectedData.enabled=!0),this.valid=!1,this.step++):this.valid=!0},cancel(){this.show=!1}},created(){}});var g=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",[e("v-snackbar",{attrs:{top:"",timeout:3e3,color:"error"},model:{value:t.valid,callback:function(s){t.valid=s},expression:"valid"}},[t._v(t._s(t.$t("settings.downloadClients.add.validMsg")))]),e("v-dialog",{attrs:{"max-width":"800"},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[e("v-card",[e("v-toolbar",{attrs:{dark:"",color:"blue-grey darken-2"}},[e("v-toolbar-title",[t._v(t._s(t.$t("settings.downloadClients.add.title")))]),e("v-spacer"),e("v-btn",{attrs:{icon:"",flat:"",color:"success",href:"https://github.com/pt-plugins/PT-Plugin-Plus/wiki/config-download-client",target:"_blank",rel:"noopener noreferrer nofollow",title:t.$t("common.help")}},[e("v-icon",[t._v("help")])],1)],1),e("v-card-text",[e("v-stepper",{model:{value:t.step,callback:function(s){t.step=s},expression:"step"}},[e("v-stepper-header",[e("v-stepper-step",{attrs:{complete:t.step>1,step:"1"}},[t._v(t._s(t.$t("settings.downloadClients.add.titleStep1")))]),e("v-divider"),e("v-stepper-step",{attrs:{step:"2"}},[t._v(t._s(t.$t("settings.downloadClients.add.titleStep2")))])],1),e("v-stepper-items",[e("v-stepper-content",{attrs:{step:"1"}},[e("v-autocomplete",{attrs:{items:t.items,label:t.$t("settings.downloadClients.add.validMsg"),"menu-props":{maxHeight:"auto"},hint:t.selectedItem.description,"persistent-hint":"","return-object":"","single-line":"","item-text":"name","item-value":"name"},scopedSlots:t._u([{key:"selection",fn:function({item:s}){return[e("v-list-tile-avatar",[e("img",{attrs:{src:s.icon}})]),e("span",{domProps:{textContent:t._s(s.name)}})]}},{key:"item",fn:function(s){return[e("v-list-tile-avatar",[e("img",{attrs:{src:s.item.icon}})]),e("v-list-tile-content",[e("v-list-tile-title",{domProps:{innerHTML:t._s(s.item.name)}})],1),e("v-list-tile-action",[e("v-list-tile-action-text",[t._v(t._s(s.item.ver))])],1)]}}]),model:{value:t.selectedItem,callback:function(s){t.selectedItem=s},expression:"selectedItem"}})],1),e("v-stepper-content",{attrs:{step:"2"}},[e("Editor",{attrs:{option:t.selectedData}})],1)],1)],1)],1),e("v-divider"),e("v-card-actions",{staticClass:"pa-3"},[e("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.step==1,expression:"step == 1"}],attrs:{flat:"",color:"grey darken-1",href:"https://github.com/pt-plugins/PT-Plugin-Plus/tree/master/resource/clients",target:"_blank",rel:"noopener noreferrer nofollow"}},[e("v-icon",[t._v("help")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("settings.downloadClients.add.helpMsg")))])],1),e("v-spacer"),e("v-btn",{attrs:{flat:"",color:"error"},on:{click:t.cancel}},[e("v-icon",[t._v("cancel")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("settings.downloadClients.add.cancel")))])],1),e("v-btn",{attrs:{flat:"",color:"grey darken-1",disabled:t.step===1},on:{click:function(s){t.step--}}},[e("v-icon",[t._v("navigate_before")]),e("span",[t._v(t._s(t.$t("settings.downloadClients.add.prevStep")))])],1),e("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.step<t.stepCount,expression:"step < stepCount"}],attrs:{flat:"",color:"blue"},on:{click:function(s){return t.next(t.step)}}},[e("span",[t._v(t._s(t.$t("settings.downloadClients.add.nextStep")))]),e("v-icon",[t._v("navigate_next")])],1),e("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.step===t.stepCount,expression:"step === stepCount"}],attrs:{flat:"",color:"success",disabled:!t.selectedData.valid},on:{click:t.save}},[e("v-icon",[t._v("check_circle_outline")])],1)],1)],1)],1)],1)},f=[],_=a(m,g,f,!1,null,null,null,null);const w=_.exports,b=n.extend({components:{Editor:l},data(){return{show:!1,defaultItem:{name:""}}},props:{value:Boolean,option:Object},model:{prop:"value",event:"change"},watch:{show(){this.$emit("change",this.show)},value(){this.show=this.value,this.show&&(this.defaultItem=Object.assign({},this.option))}},methods:{save(){this.$emit("save",this.defaultItem),this.show=!1},cancel(){this.show=!1}}});var C=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("v-dialog",{attrs:{"max-width":"800"},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}},[e("v-card",[e("v-card-title",{staticClass:"headline blue-grey darken-2",staticStyle:{color:"white"}},[t._v(t._s(t.$t("settings.downloadClients.edit.title")))]),e("v-card-text",[e("Editor",{attrs:{option:t.defaultItem}})],1),e("v-divider"),e("v-card-actions",{staticClass:"pa-3"},[e("v-spacer"),e("v-btn",{attrs:{flat:"",color:"error"},on:{click:t.cancel}},[e("v-icon",[t._v("cancel")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("settings.downloadClients.edit.cancel")))])],1),e("v-btn",{attrs:{flat:"",color:"success",disabled:!t.defaultItem.valid},on:{click:t.save}},[e("v-icon",[t._v("check_circle_outline")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("settings.downloadClients.edit.ok")))])],1)],1)],1)],1)},$=[],x=a(b,C,$,!1,null,null,null,null);const k=x.exports,y=n.extend({components:{AddItem:w,EditItem:k},data(){return{showAddDialog:!1,showEditDialog:!1,itemDuplicate:!1,selected:[],selectedItem:{},pagination:{rowsPerPage:-1},items:[],dialogRemoveConfirm:!1}},created(){this.items=this.$store.state.options.system.clients,this.$store.state.options.clients.forEach(o=>{o.enabled===void 0&&(o.enabled=!0,this.updateItem(o))})},methods:{add(){this.showAddDialog=!0},addItem(o){this.$store.state.options.clients.findIndex(e=>e.name===o.name)===-1?this.$store.commit("addClient",o):this.itemDuplicate=!0},edit(o){let t=this.$store.state.options.clients.findIndex(e=>o.id===e.id);t!==-1&&(this.selectedItem=this.$store.state.options.clients[t],this.showEditDialog=!0)},updateItem(o){console.debug("updateClient",o),this.$store.commit("updateClient",o)},remove(){this.dialogRemoveConfirm=!1,this.$store.commit("removeClient",this.selectedItem),this.selectedItem={}},removeConfirm(o){this.selectedItem=o,this.dialogRemoveConfirm=!0},clear(){confirm(this.$t("settings.downloadClients.index.clearConfirm").toString())&&this.$store.commit("clearClients")},removeSelected(){confirm(this.$t("settings.downloadClients.index.removeSelectedConfirm").toString())&&(console.log(this.selected),this.selected.forEach(o=>{this.$store.commit("removeClient",o)}),this.selected=[])}},computed:{headers(){return[{text:this.$t("settings.downloadClients.index.headers.name"),align:"left",value:"name"},{text:this.$t("settings.downloadClients.index.headers.enabled"),align:"left",value:"enabled"},{text:this.$t("settings.downloadClients.index.headers.type"),align:"left",value:"type"},{text:this.$t("settings.downloadClients.index.headers.address"),align:"left",value:"address"},{text:this.$t("settings.downloadClients.index.headers.action"),value:"name",sortable:!1}]}}});var I=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"set-download-clients"},[e("v-alert",{attrs:{value:!0,type:"info"}},[t._v(t._s(t.$t("settings.downloadClients.index.title")))]),e("v-card",[e("v-card-title",[e("v-btn",{attrs:{color:"success"},on:{click:t.add}},[e("v-icon",{staticClass:"mr-2"},[t._v("add")]),t._v(" "+t._s(t.$t("settings.downloadClients.index.add"))+" ")],1),e("v-btn",{attrs:{color:"error",disabled:t.selected.length==0},on:{click:t.removeSelected}},[e("v-icon",{staticClass:"mr-2"},[t._v("remove")]),t._v(" "+t._s(t.$t("settings.downloadClients.index.remove"))+" ")],1),e("v-spacer"),e("v-text-field",{staticClass:"search",attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""}})],1),e("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:this.$store.state.options.clients,pagination:t.pagination,"item-key":"id","select-all":""},on:{"update:pagination":function(s){t.pagination=s}},scopedSlots:t._u([{key:"items",fn:function(s){return[e("td",{staticStyle:{width:"20px"}},[e("v-checkbox",{attrs:{primary:"","hide-details":""},model:{value:s.selected,callback:function(i){t.$set(s,"selected",i)},expression:"props.selected"}})],1),e("td",[e("a",{on:{click:function(i){return t.edit(s.item)}}},[t._v(t._s(s.item.name))])]),e("td",[t._v(t._s(s.item.enabled===!1?t.$t("settings.downloadClients.index.no"):t.$t("settings.downloadClients.index.yes")))]),e("td",[t._v(t._s(s.item.type))]),e("td",[e("a",{attrs:{href:s.item.address,target:"_blank",rel:"noopener noreferrer nofollow"}},[t._v(t._s(s.item.address))])]),e("td",[e("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(i){return t.edit(s.item)}}},[t._v("edit")]),e("v-icon",{attrs:{small:"",color:"error"},on:{click:function(i){return t.removeConfirm(s.item)}}},[t._v("delete")])],1)]}}]),model:{value:t.selected,callback:function(s){t.selected=s},expression:"selected"}})],1),e("AddItem",{on:{save:t.addItem},model:{value:t.showAddDialog,callback:function(s){t.showAddDialog=s},expression:"showAddDialog"}}),e("EditItem",{attrs:{option:t.selectedItem},on:{save:t.updateItem},model:{value:t.showEditDialog,callback:function(s){t.showEditDialog=s},expression:"showEditDialog"}}),e("v-dialog",{attrs:{width:"300"},model:{value:t.dialogRemoveConfirm,callback:function(s){t.dialogRemoveConfirm=s},expression:"dialogRemoveConfirm"}},[e("v-card",[e("v-card-title",{staticClass:"headline red lighten-2"},[t._v(t._s(t.$t("settings.downloadClients.index.removeConfirmTitle")))]),e("v-card-text",[t._v(t._s(t.$t("settings.downloadClients.index.removeConfirm")))]),e("v-divider"),e("v-card-actions",[e("v-spacer"),e("v-btn",{attrs:{flat:"",color:"info"},on:{click:function(s){t.dialogRemoveConfirm=!1}}},[e("v-icon",[t._v("cancel")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("settings.downloadClients.index.cancel")))])],1),e("v-btn",{attrs:{color:"error",flat:""},on:{click:t.remove}},[e("v-icon",[t._v("check_circle_outline")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("settings.downloadClients.index.ok")))])],1)],1)],1)],1),e("v-alert",{attrs:{value:!0,color:"grey"}},[e("div",{domProps:{innerHTML:t._s(t.$t("settings.downloadClients.index.subTitle"))}})]),e("v-snackbar",{attrs:{top:"",timeout:3e3,color:"error"},model:{value:t.itemDuplicate,callback:function(s){t.itemDuplicate=s},expression:"itemDuplicate"}},[t._v(t._s(t.$t("settings.downloadClients.index.itemDuplicate")))])],1)},S=[],M=a(y,I,S,!1,null,"64e18ce3",null,null);const D=M.exports;export{D as default};
