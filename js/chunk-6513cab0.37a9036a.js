(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6513cab0"],{"14b5":function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));n("a481"),n("6b54"),n("7f7f");var a=n("d225"),s=n("b0b4"),i=function(){function t(){Object(a["a"])(this,t)}return Object(s["a"])(t,[{key:"replacePathKey",value:function(t,e){if(!t)return t;var n=new Date;return this.replaceKeys(t,{"site.name":e.name,"site.host":e.host,YYYY:n.getFullYear(),MM:("0"+(n.getMonth()+1).toString()).substr(-2),DD:("0"+n.getDate().toString()).substr(-2)})}},{key:"getSavePath",value:function(t,e){if(t){var n=t,a="<...>";if(n&&n.indexOf(a)>=0){var s=window.prompt("当前为自定义路径：".concat(n," \n请输入路径中 ").concat(a," 部分的内容: "));if(null===s)return!1;n=n.replace(a,s)}return this.replacePathKey(n,e)}}},{key:"replaceKeys",value:function(t,e){var n=t;for(var a in e)if(e.hasOwnProperty(a)){var s=e[a];n=n.replace("$"+a+"$",s)}return n}}]),t}()},3046:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-btn",{class:[t.mini?"btn-mini":""],attrs:{flat:t.flat,icon:t.icon,small:t.small,loading:t.loading,title:t.title||t.$t("searchTorrent.sendToClientTip"),color:t.color},on:{click:function(e){return e.stopPropagation(),t.showSiteContentMenus.apply(null,arguments)}}},[t.haveSuccess?n("v-icon",{attrs:{color:"success",small:""}},[t._v("done")]):t.haveError?n("v-icon",{attrs:{color:"red",small:""}},[t._v("close")]):n("v-icon",{attrs:{small:""}},[t._v(t._s(t.iconText))]),t.label?n("span",{staticClass:"ml-2"},[t._v(t._s(t.label))]):t._e()],1)},s=[],i=(n("6b54"),n("b54a"),n("7f7f"),n("7514"),n("ac6a"),n("c5f6"),n("2b0e")),o=n("f62e"),r=n("14b5"),l=n("a1f4"),c=n("0a02"),u=new l["a"],h=i["default"].extend({props:{flat:Boolean,icon:Boolean,small:Boolean,mini:Boolean,color:String,iconText:{type:String,default:"cloud_download"},downloadOptions:{type:[Object,Array],default:function(){return{host:String,url:String}}},getOptionsOnly:Boolean,label:String,title:String,payload:[Object,Array,String,Number]},data:function(){return{options:this.$store.state.options,contentMenus:[],pathHandler:new r["a"],loading:!1,site:{},haveSuccess:!1,haveError:!1,allContentMenus:[]}},methods:{getSiteContentMenus:function(t){var e=[],n=[];if(this.contentMenus&&this.contentMenus.length>0)return this.contentMenus;function a(n,a){n.forEach((function(n){e.push({client:a,path:n,host:t})}))}return this.options.clients.forEach((function(s){if(n.push({client:s,path:"",host:t}),s.paths){for(var i in s.paths){var r=s.paths[i];t===i&&a(r,s)}var l=s.paths[o["f"].allSite];l&&(e.length>0&&e.push({}),a(l,s))}})),e.length>0&&n.splice(0,0,{}),e=e.concat(n),this.contentMenus=e,e},getSiteFromHost:function(t){return this.options.sites.find((function(e){var n=e.cdn||[];return e.url&&n.push(e.url),e.host==t||n.join("").indexOf(t)>-1}))},showSiteContentMenus:function(t){var e=this;if(Array.isArray(this.downloadOptions))this.showAllContentMenus(t);else{var n=this.downloadOptions,a=n.host;if(!a&&n.site&&(a=n.site.host),a){this.site=n.site||this.getSiteFromHost(a);var s=this.getSiteContentMenus(a),i=[];s.forEach((function(t){if(t.client&&t.client.name){var a=e.$vuetify.breakpoint.xs?t.client.name:e.$t("searchTorrent.downloadTo",{path:"".concat(t.client.name," -> ").concat(t.client.address)});t.path&&(a+=" ->".concat(e.pathHandler.replacePathKey(t.path,e.site))),i.push({title:a,fn:function(){if(n.url){console.log(n,t);var a={url:n.url,title:n.title,savePath:t.path,autoStart:t.client.autoStart,tagIMDb:t.client.tagIMDb,link:n.link,clientId:t.client.id,imdbId:n.imdbId};if(e.getOptionsOnly)return a.savePath=e.pathHandler.getSavePath(a.savePath,e.site),void e.$emit("itemClick",{payload:e.payload,downloadOptions:Object.assign({clientName:t.client.name},a)});e.sendToClient(a)}}})}else i.push({})})),c["a"].showContextMenu(i,t)}}},showAllContentMenus:function(t){var e=[],n=[],a=this;function s(t){var e=a.$t("searchTorrent.downloadTo",{path:"".concat(t.client.name," -> ").concat(t.client.address)}).toString();t.path&&(e+=" -> ".concat(t.path)),n.push({title:e,fn:function(){a.sendTorrentsInBackground(t)}})}0==this.allContentMenus.length?(this.options.clients.forEach((function(t){e.push({client:t,path:""})})),e.forEach((function(t){if(t.client&&t.client.name){if(s(t),t.client.paths){var e=t.client.paths[o["f"].allSite];e&&e.forEach((function(e){if(-1==e.indexOf("$site.name$")&&-1==e.indexOf("$site.host$")&&-1==e.indexOf("<...>")){var n=c["a"].clone(t);n.path=e,s(n)}}))}}else n.push({})})),this.allContentMenus=n):n=this.allContentMenus,c["a"].showContextMenu(n,t)},sendTorrentsInBackground:function(t){var e=this,n=[];this.downloadOptions.forEach((function(e){n.push({title:e.title,url:e.url,clientId:t.client.id,savePath:t.path,autoStart:t.client.autoStart,tagIMDb:t.client.tagIMDb,link:e.link,imdbId:e.imdbId})})),this.loading=!0,u.sendRequest(o["b"].sendTorrentsInBackground,null,n).then((function(t){console.log("命令执行完成",t),e.haveSuccess=!0,e.$emit("success",t)})).catch((function(t){console.log(t),e.haveError=!0,e.$emit("error",t.msg||t)})).finally((function(){e.loading=!1,setTimeout((function(){e.clearStatus()}),5e3)}))},sendToClient:function(t){var e=this;this.clearStatus();var n=this.pathHandler.getSavePath(t.savePath,this.site);!1!==n&&(this.loading=!0,t.savePath=n,u.sendRequest(o["b"].sendTorrentToClient,null,t).then((function(t){console.log("命令执行完成",t),"success"==t.type?(e.haveSuccess=!0,e.$emit("success",t.msg)):(e.haveError=!0,e.$emit("error",t.msg))})).catch((function(t){console.log(t),e.haveError=!0,e.$emit("error",t.msg||t)})).finally((function(){e.loading=!1,setTimeout((function(){e.clearStatus()}),5e3)})))},clearStatus:function(){this.haveSuccess=!1,this.haveError=!1}}}),d=h,f=n("2877"),v=n("6544"),m=n.n(v),p=n("8336"),g=n("132d"),b=Object(f["a"])(d,a,s,!1,null,null,null);e["a"]=b.exports;m()(b,{VBtn:p["a"],VIcon:g["a"]})},"386b":function(t,e,n){var a=n("5ca1"),s=n("79e5"),i=n("be13"),o=/"/g,r=function(t,e,n,a){var s=String(i(t)),r="<"+e;return""!==n&&(r+=" "+n+'="'+String(a).replace(o,"&quot;")+'"'),r+">"+s+"</"+e+">"};t.exports=function(t,e){var n={};n[t]=e(r),a(a.P+a.F*s((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3})),"String",n)}},"7d05":function(t,e,n){},"8cd1":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"history"},[n("v-alert",{attrs:{value:!0,type:"info"}},[t._v(t._s(t.$t("history.title")))]),n("v-card",[n("v-card-title",[n("v-btn",{attrs:{color:"error",disabled:0==t.selected.length},on:{click:t.removeSelected}},[n("v-icon",{staticClass:"mr-2"},[t._v("remove")]),t._v("\n        "+t._s(t.$t("history.remove"))+"\n      ")],1),n("v-btn",{attrs:{color:"error",disabled:0==t.items.length},on:{click:t.clear}},[n("v-icon",{staticClass:"mr-2"},[t._v("clear")]),t._v("\n        "+t._s(t.$t("history.clear"))+"\n      ")],1),n("v-spacer"),n("v-text-field",{staticClass:"search",attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:t.filterKey,callback:function(e){t.filterKey=e},expression:"filterKey"}})],1),n("v-data-table",{staticClass:"elevation-1",attrs:{search:t.filterKey,headers:t.headers,items:t.items,pagination:t.pagination,"item-key":"data.url","select-all":""},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("td",{staticStyle:{width:"20px"}},[n("v-checkbox",{attrs:{primary:"","hide-details":""},model:{value:e.selected,callback:function(n){t.$set(e,"selected",n)},expression:"props.selected"}})],1),n("td",{staticStyle:{"text-align":"center"}},[e.item.site?n("div",[n("v-avatar",{attrs:{size:"18"}},[n("img",{attrs:{src:e.item.site.icon}})]),n("br"),n("span",{staticClass:"captionText"},[t._v(t._s(e.item.site.name))])],1):t._e()]),n("td",[e.item.data.link?n("a",{attrs:{href:e.item.data.link,target:"_blank",title:e.item.data.title,rel:"noopener noreferrer nofollow"}},[t._v(t._s(e.item.data.title||e.item.data.link))]):n("span",{attrs:{title:e.item.data.url}},[t._v(t._s(e.item.data.title||e.item.data.url))]),n("br"),n("span",{staticClass:"sub-title"},[t._v("[\n            "+t._s(t.getClientName(e.item.data.clientId||e.item.clientId))+"\n            ] ->\n            "+t._s(e.item.data.savePath||t.$t("history.defaultPath")))])]),n("td",[!1===e.item.success?n("v-icon",{attrs:{color:"error",title:t.$t("history.fail")}},[t._v("close")]):n("v-icon",{attrs:{color:"success",title:t.$t("history.success")}},[t._v("done")])],1),n("td",[t._v(t._s(t._f("formatDate")(e.item.time)))]),n("td",[n("v-btn",{attrs:{icon:"",flat:"",small:"",title:t.$t("history.download")},on:{click:function(n){return t.download(e.item)}}},[n("v-icon",{attrs:{small:""}},[t._v("save_alt")])],1),n("DownloadTo",{staticClass:"mx-0",attrs:{downloadOptions:{host:e.item.host,url:e.item.data.url},flat:"",icon:"",small:""},on:{error:t.onError,success:t.onSuccess}}),n("v-btn",{attrs:{icon:"",flat:"",small:"",color:"error",title:t.$t("common.remove")},on:{click:function(n){return t.removeConfirm(e.item)}}},[n("v-icon",{attrs:{small:""}},[t._v("delete")])],1)],1)]}}]),model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}})],1),n("v-dialog",{attrs:{width:"300"},model:{value:t.dialogRemoveConfirm,callback:function(e){t.dialogRemoveConfirm=e},expression:"dialogRemoveConfirm"}},[n("v-card",[n("v-card-title",{staticClass:"headline red lighten-2"},[t._v(t._s(t.$t("history.removeConfirmTitle")))]),n("v-card-text",[t._v(t._s(t.$t("history.removeConfirm")))]),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{flat:"",color:"info"},on:{click:function(e){t.dialogRemoveConfirm=!1}}},[n("v-icon",[t._v("cancel")]),n("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("history.cancel")))])],1),n("v-btn",{attrs:{color:"error",flat:""},on:{click:function(e){return t.remove(null)}}},[n("v-icon",[t._v("check_circle_outline")]),n("span",{staticClass:"ml-1"},[t._v(t._s(t.$t("history.ok")))])],1)],1)],1)],1),n("v-snackbar",{attrs:{top:"",timeout:3e3,color:"error"},model:{value:t.haveError,callback:function(e){t.haveError=e},expression:"haveError"}},[t._v(t._s(t.errorMsg))]),n("v-snackbar",{attrs:{bottom:"",timeout:3e3,color:"success"},model:{value:t.haveSuccess,callback:function(e){t.haveSuccess=e},expression:"haveSuccess"}},[t._v(t._s(t.successMsg))])],1)},s=[],i=(n("7f7f"),n("7514"),n("ac6a"),n("6b54"),n("2b0e")),o=n("f62e"),r=n("a1f4"),l=n("3046"),c=new r["a"],u=i["default"].extend({components:{DownloadTo:l["a"]},data:function(){return{selected:[],selectedItem:{},pagination:{rowsPerPage:10,sortBy:"time",descending:!0},items:[],dialogRemoveConfirm:!1,options:this.$store.state.options,errorMsg:"",haveError:!1,haveSuccess:!1,successMsg:"",siteCache:{},filterKey:""}},methods:{clear:function(){var t=this;confirm(this.$t("history.clearConfirm").toString())&&c.sendRequest(o["b"].clearDownloadHistory).then((function(e){t.getDownloadHistory()}))},removeSelected:function(){this.selected&&this.selected.length>0&&confirm(this.$t("common.removeSelectedConfirm",{count:this.selected.length}).toString())&&this.remove(this.selected)},remove:function(t){var e=this;t||(t=[this.selectedItem]),c.sendRequest(o["b"].removeDownloadHistory,null,t).then((function(t){e.getDownloadHistory()})),this.dialogRemoveConfirm=!1},removeConfirm:function(t){this.selectedItem=t,this.dialogRemoveConfirm=!0},getDownloadHistory:function(){var t=this;c.sendRequest(o["b"].getDownloadHistory).then((function(e){console.log("downloadHistory",e),t.items=[],e.forEach((function(e){var n=t.siteCache[e.host];n||(n=t.options.sites.find((function(t){return t.host===e.host})),t.siteCache[e.host]=n),e.site=n,t.items.push(e)}))}))},getClientName:function(t){var e=this.options.clients.find((function(e){return e.id===t}));return e?e.name:""},download:function(t){var e=this;console.log(t),this.haveSuccess=!0,this.successMsg=this.$t("history.seedingTorrent").toString();var n=Object.assign({},t.data);n.clientId||(n.clientId=t.clientId),c.sendRequest(o["b"].sendTorrentToClient,null,n).then((function(t){console.log("命令执行完成",t),t.success?(e.haveSuccess=!0,e.successMsg=t.msg):(e.haveError=!0,e.errorMsg=t.msg)}))},onError:function(t){this.errorMsg=t},onSuccess:function(t){this.successMsg=t}},created:function(){this.getDownloadHistory()},computed:{headers:function(){return[{text:this.$t("history.headers.site"),align:"center",value:"data.host",width:"140px"},{text:this.$t("history.headers.title"),align:"left",value:"data.title"},{text:this.$t("history.headers.status"),align:"left",value:"data.success"},{text:this.$t("history.headers.time"),align:"left",value:"time"},{text:this.$t("history.headers.action"),value:"name",sortable:!1}]}}}),h=u,d=(n("a699"),n("2877")),f=n("6544"),v=n.n(f),m=n("0798"),p=n("8212"),g=n("8336"),b=n("b0af"),y=n("99d9"),S=n("12b2"),_=n("ac7c"),C=n("8fea"),w=n("169a"),k=n("ce7e"),$=n("132d"),x=n("2db4"),M=n("9910"),T=n("2677"),O=Object(d["a"])(h,a,s,!1,null,"01029d43",null);e["default"]=O.exports;v()(O,{VAlert:m["a"],VAvatar:p["a"],VBtn:g["a"],VCard:b["a"],VCardActions:y["a"],VCardText:y["b"],VCardTitle:S["a"],VCheckbox:_["a"],VDataTable:C["a"],VDialog:w["a"],VDivider:k["a"],VIcon:$["a"],VSnackbar:x["a"],VSpacer:M["a"],VTextField:T["a"]})},a699:function(t,e,n){"use strict";n("7d05")},b54a:function(t,e,n){"use strict";n("386b")("link",(function(t){return function(e){return t(this,"a","href",e)}}))}}]);