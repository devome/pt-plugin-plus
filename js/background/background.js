!function(e){function t(t){for(var o,s,a=t[0],c=t[1],u=t[2],h=0,p=[];h<a.length;h++)s=a[h],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&p.push(r[s][0]),r[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(l&&l(t);p.length;)p.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,a=1;a<n.length;a++){var c=n[a];0!==r[c]&&(o=!1)}o&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},r={0:0},i=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;i.push([375,1]),n()}({0:function(e,t,n){"use strict";var o,r,i,s,a,c,u,l,h,p,f,d,_,g,m,v,y,b,P,E,D,w,S,C,T,M,O,I,k;n.d(t,"s",(function(){return o})),n.d(t,"o",(function(){return r})),n.d(t,"h",(function(){return i})),n.d(t,"n",(function(){return a})),n.d(t,"b",(function(){return c})),n.d(t,"t",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return h})),n.d(t,"l",(function(){return p})),n.d(t,"k",(function(){return f})),n.d(t,"u",(function(){return g})),n.d(t,"v",(function(){return m})),n.d(t,"e",(function(){return v})),n.d(t,"j",(function(){return y})),n.d(t,"d",(function(){return b})),n.d(t,"c",(function(){return E})),n.d(t,"m",(function(){return D})),n.d(t,"w",(function(){return w})),n.d(t,"p",(function(){return M})),n.d(t,"q",(function(){return O})),n.d(t,"i",(function(){return I})),n.d(t,"r",(function(){return k})),n.d(t,"a",(function(){return U})),function(e){e.ZiB="ZiB",e.EiB="EiB",e.PiB="PiB",e.TiB="TiB",e.GiB="GiB",e.MiB="MiB",e.KiB="KiB"}(o||(o={})),function(e){e.JSON="json",e.XML="xml",e.HTML="html",e.TEXT="text"}(r||(r={})),function(e){e.transmission="transmission",e.utorrent="utorrent",e.deluge="deluge",e.synologyDownloadStation="synologyDownloadStation",e.rutorrent="rutorrent",e.qbittorrent="qbittorrent"}(i||(i={})),function(e){e.normal="normal",e.label="label",e.spliter="spliter",e.popup="popup"}(s||(s={})),function(e){e.POST="POST",e.GET="GET"}(a||(a={})),function(e){e.readConfig="readConfig",e.saveConfig="saveConfig",e.reloadConfig="reloadConfig",e.sendTorrentToDefaultClient="sendTorrentToDefaultClient",e.sendTorrentToClient="sendTorrentToClient",e.searchTorrent="searchTorrent",e.copyTextToClipboard="copyTextToClipboard",e.addTorrentFromURL="addTorrentFromURL",e.getFreeSpace="getFreeSpace",e.downloadFromDroper="downloadFromDroper",e.openOptions="openOptions",e.updateOptionsTabId="updateOptionsTabId",e.getSearchResult="getSearchResult",e.getDownloadHistory="getDownloadHistory",e.removeDownloadHistory="removeDownloadHistory",e.clearDownloadHistory="clearDownloadHistory",e.testClientConnectivity="testClientConnectivity",e.getSystemLogs="getSystemLogs",e.removeSystemLogs="removeSystemLogs",e.clearSystemLogs="clearSystemLogs",e.readUIOptions="readUIOptions",e.saveUIOptions="saveUIOptions",e.showMessage="showMessage",e.writeLog="writeLog",e.serviceStoped="serviceStoped",e.addContentPage="addContentPage",e.abortSearch="abortSearch",e.backupToGoogle="backupToGoogle",e.restoreFromGoogle="restoreFromGoogle",e.clearFromGoogle="clearFromGoogle",e.getTorrentDataFromURL="getTorrentDataFromURL",e.getUserInfo="getUserInfo",e.abortGetUserInfo="abortGetUserInfo",e.refreshUserData="refreshUserData",e.getClearedOptions="getClearedOptions",e.resetRunTimeOptions="resetRunTimeOptions",e.getBase64FromImageUrl="getBase64FromImageUrl",e.getUserHistoryData="getUserHistoryData",e.getMovieInfos="getMovieInfos",e.getMovieRatings="getMovieRatings",e.getIMDbIdFromDouban="getIMDbIdFromDouban",e.queryMovieInfoFromDouban="queryMovieInfoFromDouban",e.addBrowserDownloads="addBrowserDownloads",e.checkPermissions="checkPermissions",e.requestPermissions="requestPermissions",e.changeLanguage="changeLanguage",e.getCurrentLanguageResource="getCurrentLanguageResource",e.addLanguage="addLanguage",e.replaceLanguage="replaceLanguage",e.hideMessage="hideMessage",e.resetUserDatas="resetUserDatas",e.backupToServer="backupToServer",e.restoreFromServer="restoreFromServer",e.getBackupListFromServer="getBackupListFromServer",e.deleteFileFromBackupServer="deleteFileFromBackupServer",e.sendTorrentsInBackground="sendTorrentsInBackground",e.createBackupFile="createBackupFile",e.checkBackupData="checkBackupData",e.addTorrentToCollection="addTorrentToCollection",e.getTorrentCollections="getTorrentCollections",e.deleteTorrentFromCollention="deleteTorrentFromCollention",e.clearTorrentCollention="clearTorrentCollention",e.getTorrentCollention="getTorrentCollention",e.getSiteSelectorConfig="getSiteSelectorConfig",e.resetTorrentCollections="resetTorrentCollections",e.getTorrentCollectionGroups="getTorrentCollectionGroups",e.addTorrentCollectionGroup="addTorrentCollectionGroup",e.addTorrentCollectionToGroup="addTorrentCollectionToGroup",e.updateTorrentCollectionGroup="updateTorrentCollectionGroup",e.removeTorrentCollectionFromGroup="removeTorrentCollectionFromGroup",e.removeTorrentCollectionGroup="removeTorrentCollectionGroup",e.updateTorrentCollention="updateTorrentCollention",e.getAllTorrentCollectionLinks="getAllTorrentCollectionLinks",e.restoreCookies="restoreCookies",e.resetFavicons="resetFavicons",e.resetFavicon="resetFavicon",e.getBackupRawData="getBackupRawData",e.testBackupServerConnectivity="testBackupServerConnectivity",e.createSearchResultSnapshot="createSearchResultSnapshot",e.loadSearchResultSnapshot="loadSearchResultSnapshot",e.getSearchResultSnapshot="getSearchResultSnapshot",e.removeSearchResultSnapshot="removeSearchResultSnapshot",e.clearSearchResultSnapshot="clearSearchResultSnapshot",e.resetSearchResultSnapshot="resetSearchResultSnapshot",e.createKeepUploadTask="createKeepUploadTask",e.loadKeepUploadTask="loadKeepUploadTask",e.getKeepUploadTask="getKeepUploadTask",e.removeKeepUploadTask="removeKeepUploadTask",e.clearKeepUploadTask="clearKeepUploadTask",e.resetKeepUploadTask="resetKeepUploadTask",e.updateKeepUploadTask="updateKeepUploadTask",e.resetDownloadHistory="resetDownloadHistory",e.pushDebugMsg="pushDebugMsg",e.updateDebuggerTabId="updateDebuggerTabId",e.getTopSearches="getTopSearches"}(c||(c={})),function(e){e.text="TEXT",e.json="JSON"}(u||(u={})),function(e){e.default="PT-Plugin-Plus-Config",e.downloadHistory="PT-Plugin-Plus-downloadHistory",e.systemLogs="PT-Plugin-Plus-systemLogs",e.uiOptions="PT-Plugin-Plus-uiOptions",e.cache="PT-Plugin-Plus-Cache-Contents",e.userDatas="PT-Plugin-Plus-User-Datas",e.collection="PT-Plugin-Plus-Collection",e.searchResultSnapshot="PT-Plugin-Plus-SearchResultSnapshot",e.keepUploadTask="PT-Plugin-Plus-KeepUploadTask"}(l||(l={})),function(e){e.success="success",e.error="error",e.info="info",e.warning="warning",e.unknown="unknown"}(h||(h={})),function(e){e.background="background",e.content="content",e.options="options",e.popup="popup",e.debugger="debugger"}(p||(p={})),function(e){e.init="init",e.requestMessage="requestMessage"}(f||(f={})),function(e){e.systemLogs="systemLogs",e.searchTorrent="searchTorrent"}(d||(d={})),function(e){e.home="home",e.downloadPaths="downloadPaths",e.searchTorrent="searchTorrent"}(_||(_={})),function(e){e.latest="latest",e.today="today",e.all="all"}(g||(g={})),function(e){e.needLogin="needLogin",e.notSupported="notSupported",e.unknown="unknown",e.success="success"}(m||(m={})),function(e){e.allSite="__allSite__",e.all="__all__",e.noGroup="__noGroup__"}(v||(v={})),function(e){e.development="development",e.normal="normal",e.crx="crx"}(y||(y={})),function(e){e.id="id",e.name="name"}(b||(b={})),function(e){e[e.downloading=1]="downloading",e[e.sending=2]="sending",e[e.completed=255]="completed",e[e.inactive=3]="inactive"}(P||(P={})),function(e){e.OWSS="OWSS",e.WebDAV="WebDAV"}(E||(E={})),function(e){e.left="left",e.right="right"}(D||(D={})),function(e){e.faq="https://github.com/pt-plugins/PT-Plugin-Plus/wiki/frequently-asked-questions"}(w||(w={})),function(e){e.all="all",e.options="options",e.userDatas="userDatas",e.collection="collection",e.cookies="cookies",e.searchResultSnapshot="searchResultSnapshot",e.keepUploadTask="keepUploadTask",e.downloadHistory="downloadHistory"}(S||(S={})),function(e){e.Chrome="Chrome",e.Firefox="Firefox"}(C||(C={})),function(e){e.success="success",e.error="error",e.loading="loading"}(T||(T={})),function(e){e.time="time",e.name="name",e.size="size"}(M||(M={})),function(e){e.desc="desc",e.asc="asc"}(O||(O={})),function(e){e.AES="AES"}(I||(I={})),function(e){e.needSecretKey="needSecretKey",e.errorSecretKey="errorSecretKey"}(k||(k={}));var U={Free:"blue","2xFree":"green","2xUp":"lime","2x50%":"light-green","25%":"purple","30%":"indigo","35%":"indigo darken-3","50%":"orange","70%":"blue-grey","75%":"lime darken-3",VIP:"orange darken-2","\u26d4\ufe0f":"deep-orange darken-1"}},1:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var o=n(165),r=n(19),i=n.n(r),s=n(163),a=n(21),c=n.n(a),u=n(164),l=new(function(){function e(){this.isExtensionMode=!1,this.browserName="",this.manifest={manifest_version:2,name:"",version:""};try{this.isExtensionMode=!!(chrome.runtime&&chrome.extension&&chrome.runtime.getManifest),this.manifest=chrome.runtime.getManifest()}catch(e){console.log("HelpFunctions: is not extension mode.",e)}this.browserName=(new u.UAParser).getBrowser().name||""}return e.prototype.getToDay=function(e){var t=new Date;e&&(t=new Date(e));var n=t.getFullYear(),o=t.getMonth()+1,r=o<10?"0"+o:o,i=t.getDate();return n+"-"+r+"-"+(i<10?"0"+i:i)},e.prototype.updateBadge=function(e){if(this.isExtensionMode)try{0==e?(chrome.browserAction.setBadgeText({text:""}),chrome.browserAction.enable()):(chrome.browserAction.setBadgeText({text:e.toString()}),chrome.browserAction.setBadgeBackgroundColor({color:"#aabbcc"}),chrome.browserAction.disable())}catch(e){console.log(e)}},e.prototype.getVersion=function(){return this.isExtensionMode?"v"+(this.manifest.version_name||this.manifest.version):"localVersion"},e.prototype.getRandomString=function(e,t){void 0===e&&(e=32),void 0===t&&(t=!1);for(var n=t?"abcdefhijkmnprstwxyz2345678ABCDEFGHJKMNPQRSTWXYZ":"abcdefghijkmnopqrstuvwxyz0123456789ABCDEFGHIJKMNOPQRSTUVWXYZ",o=n.length,r=[],i=0;i<e;i++)r.push(n.charAt(Math.floor(Math.random()*o)));return r.join("")},e.prototype.getNewId=function(){return i()((new Date).getTime().toString()+this.getRandomString()).toString()},e.prototype.showNotifications=function(e,t){void 0===t&&(t=3e3),e=Object.assign({type:"basic",iconUrl:chrome.extension.getURL("/assets/icon-128.png"),title:"PT \u52a9\u624b Plus",priority:0,message:""},e);var n=Math.floor(99999*Math.random())+"";chrome.notifications.create(n,e,(function(e){n=e})),setTimeout((function(){chrome.notifications.clear(n,(function(){}))}),t)},e.prototype.removeDuplicateQueryString=function(e){var t,n=[],o="",r=/([^&=]+)=([^&]*)/g,i="",s=e.indexOf("?");if(-1!==s){for(i=e.substr(0,s+1),o=e.substr(s+1);t=r.exec(o);){var a=t[1]+"="+t[2];n.includes(a)||n.push(a)}return i+n.join("&")}return e},e.prototype.removeQueryStringFromValue=function(e,t){var n,o=[],r="",i=/([^&=]+)=([^&]*)/g,s="",a=e.indexOf("?");if(-1!==a){for(s=e.substr(0,a+1),r=e.substr(a+1);n=i.exec(r);){var c=n[1]+"="+n[2];n[2]!==t&&o.push(c)}return s+o.join("&")}return e},e.prototype.removeQueryStringFields=function(e,t){var n,o=[],r="",i=/([^&=]+)=([^&]*)/g,s="",a=e.indexOf("?");if(-1!==a){for(s=e.substr(0,a+1),r=e.substr(a+1);n=i.exec(r);){var c=n[1]+"="+n[2];t.includes(n[1])||o.push(c)}return s+o.join("&")}return e},e.prototype.clone=function(e){return JSON.parse(JSON.stringify(e))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,Object(o.a)([(new Date).toLocaleString()],e))},e.prototype.showContextMenu=function(e,t){try{s.show(e,t),$(".basicContext").css({left:"-=20px",top:"+=10px"})}catch(e){}},e.prototype.getCleaningURL=function(e){return this.removeQueryStringFields(e,["hit","cmtpage","page"])},e.prototype.checkPermissions=function(e){return new Promise((function(t,n){chrome&&chrome.permissions?chrome.permissions.contains({permissions:e},(function(e){!0===e?t(!0):n({success:!1})})):n({success:!1})}))},e.prototype.requestPermissions=function(e){return new Promise((function(t,n){chrome&&chrome.permissions?chrome.permissions.request({permissions:e},(function(e){!0===e?t(!0):n({success:!1})})):n({success:!1})}))},e.prototype.usePermissions=function(e,t,n){var o=this;return void 0===t&&(t=!1),void 0===n&&(n=""),new Promise((function(r,i){o.checkPermissions(e).then((function(e){r(e)})).catch((function(){var s=!0;t&&(s=confirm(n)),s?o.requestPermissions(e).then((function(e){r(e)})).catch((function(e){i(e)})):i({success:!1})}))}))},e.prototype.getSiteFromHost=function(e,t){var n=[];t.sites&&n.push.apply(n,t.sites),t.system&&t.system.publicSites&&n.push.apply(n,t.system.publicSites);var o=n.find((function(t){var n,o=[t.url].concat(t.cdn,null===(n=t.formerHosts)||void 0===n?void 0:n.map((function(e){return"//"+e})));return t.host==e||o.join("").indexOf("//"+e)>-1}));return o?this.clone(o):null},e.prototype.getNewBackupFileName=function(){return"PT-Plugin-Plus-Backup-"+c()().format("YYYY-MM-DD_HH-mm-ss")+".zip"},e.prototype.replaceKeys=function(e,t,n){if(void 0===n&&(n=""),!e)return e;var o=e;for(var r in t)if(t.hasOwnProperty(r)){var i=t[r],s="$"+r+"$";n&&(s="$"+n+"."+r+"$"),o=o.replace(s,i)}return o},e.prototype.checkOptionalPermission=function(e){return!!(this.isExtensionMode&&this.manifest&&this.manifest.optional_permissions)&&this.manifest.optional_permissions.includes(e)},e.prototype.transformTime=function(e,t){if(!t||!e)return e;var n=e;/^(\d){10}$/.test(n+"")&&(n=1e3*parseInt(n+""));var o=c()(n).format("YYYY-MM-DDTHH:mm:ss");return n=new Date(""+o+t).getTime()},e}())},11:function(e,t,n){"use strict";var o=n(0),r=function(){function e(){this.isExtensionMode=!1,window.chrome&&chrome.extension&&(this.isExtensionMode=!0)}return e.prototype.set=function(e,t,n){var r=this;return void 0===n&&(n=o.t.json),new Promise((function(i,s){if(r.isExtensionMode){var a={};a[e]=t,chrome.storage.local.set(a,(function(){i()}))}else"string"!=typeof t&&n==o.t.json&&(t=JSON.stringify(t)),window.localStorage.setItem(e,t),i()}))},e.prototype.get=function(e,t,n){if(void 0===n&&(n=o.t.json),this.isExtensionMode)chrome.storage.local.get(e,(function(n){n&&n[e]?t(n[e]):t(null)}));else{var r=window.localStorage.getItem(e);r&&n==o.t.json&&(r=JSON.parse(r)),t&&t(r)}},e}();t.a=r},167:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ClientController}));var _api__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),_interface_common__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),ClientController=function(){function ClientController(){this.options={sites:[],clients:[]},this.clients={}}return ClientController.prototype.init=function(e){this.options=e,this.cleanUpClients()},ClientController.prototype.cleanUpClients=function(){this.clients={}},ClientController.prototype.getClient=function(clientOptions){var _this=this;return new Promise((function(resolve,reject){if("string"==typeof clientOptions){var clientId_1=clientOptions;clientOptions=_this.options.clients.find((function(e){return e.id===clientId_1}));var client=_this.clients[clientId_1];if(client)return void resolve({client:client,options:clientOptions})}if(void 0===window[clientOptions.type])_api__WEBPACK_IMPORTED_MODULE_0__.b.execScript({type:"file",content:"clients/"+clientOptions.type+"/init.js"}).then((function(){var client;eval("client = new "+clientOptions.type+"()"),client.init({loginName:clientOptions.loginName,loginPwd:clientOptions.loginPwd,address:clientOptions.address,name:clientOptions.name}),_this.clients[clientOptions.id]=client,resolve({client:client,options:clientOptions})})).catch((function(e){console.log(e),reject({initFailed:!0,msg:e})}));else{var client=void 0;eval("client = new "+clientOptions.type+"()"),client.init({loginName:clientOptions.loginName,loginPwd:clientOptions.loginPwd,address:clientOptions.address,name:clientOptions.name}),_this.clients[clientOptions.id]=client,resolve({client:client,options:clientOptions})}}))},ClientController.prototype.testClientConnectivity=function(e){var t=this;return new Promise((function(n,o){var r={type:_interface_common__WEBPACK_IMPORTED_MODULE_1__.g.unknown,success:!1};t.getClient(e).then((function(t){t.client.call(_interface_common__WEBPACK_IMPORTED_MODULE_1__.b.testClientConnectivity,e).then((function(e){r.success=e,e&&(r.type=_interface_common__WEBPACK_IMPORTED_MODULE_1__.g.success),n(r)})).catch((function(e){r.data=e,r.type=_interface_common__WEBPACK_IMPORTED_MODULE_1__.g.error,o(r)}))})).catch((function(e){r.data=e,r.type=_interface_common__WEBPACK_IMPORTED_MODULE_1__.g.error,o(r)}))}))},ClientController}()},168:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Searcher}));var _interface_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_service_api__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3),_site__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(169),extend__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(57),extend__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(extend__WEBPACK_IMPORTED_MODULE_3__),_infoParser__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(30),_service_public__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(1),_pageParser__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(172),ESearchResultParseStatus;!function(e){e.success="success",e.needLogin="needLogin",e.noTorrents="noTorrents",e.torrentTableIsEmpty="torrentTableIsEmpty",e.parseError="parseError"}(ESearchResultParseStatus||(ESearchResultParseStatus={})),Object.assign(window,{ESearchResultParseStatus:ESearchResultParseStatus});var Searcher=function(){function Searcher(e){this.service=e,this.searchConfigs={},this.parseScriptCache={},this.options={sites:[],clients:[]},this.searchRequestQueue={}}return Searcher.prototype.searchTorrent=function(site,key,payload){var _this=this;return void 0===key&&(key=""),this.service.debug("searchTorrent: start",key,payload),new Promise((function(resolve,reject){var result={success:!1},siteService=new _site__WEBPACK_IMPORTED_MODULE_2__.a(_service_public__WEBPACK_IMPORTED_MODULE_5__.a.clone(site),_service_public__WEBPACK_IMPORTED_MODULE_5__.a.clone(_this.options)),searchConfig={},schema=_this.getSiteSchema(site),host=site.host,siteSearchPage="",searchEntryConfig=extend__WEBPACK_IMPORTED_MODULE_3___default()(!0,{torrentTagSelectors:[]},schema&&schema.searchEntryConfig?schema.searchEntryConfig:{},siteService.options.searchEntryConfig),searchEntryConfigQueryString="";if(siteService.options.searchEntry?(searchConfig.rootPath="sites/"+host+"/",searchConfig.entry=siteService.options.searchEntry):schema&&schema.searchEntry&&(searchConfig.rootPath="schemas/"+schema.name+"/",searchConfig.entry=schema.searchEntry),schema&&schema.torrentTagSelectors&&(searchConfig.torrentTagSelectors=schema.torrentTagSelectors),siteService.options.torrentTagSelectors&&(siteService.options.mergeSchemaTagSelectors?searchConfig.torrentTagSelectors=siteService.options.torrentTagSelectors.concat(searchConfig.torrentTagSelectors):searchConfig.torrentTagSelectors=siteService.options.torrentTagSelectors),!searchConfig.entry)return result.msg=_this.service.i18n.t("service.searcher.siteSearchConfigEntryIsEmpty",{site:site}),result.type=_interface_common__WEBPACK_IMPORTED_MODULE_0__.g.error,reject(result),void _this.service.debug("searchTorrent: tip");var imdb=key.match(/(tt\d+)/),autoMatched=!1;imdb&&imdb.length>=2&&(key=imdb[1]),key=key.replace(/\./g," "),searchEntryConfig&&searchEntryConfig.page&&(siteSearchPage=searchEntryConfig.page,searchEntryConfigQueryString=searchEntryConfig.queryString+"",searchEntryConfig.area&&searchEntryConfig.area.some((function(area){if(area.keyAutoMatch&&new RegExp(area.keyAutoMatch,"").test(key)){if(area.page&&(siteSearchPage=area.page),autoMatched=!0,area.queryString&&(searchEntryConfigQueryString=area.queryString),area.appendQueryString&&(searchEntryConfigQueryString+=area.appendQueryString),area.replaceKey&&(key=key.replace(new RegExp(area.replaceKey[0],"g"),area.replaceKey[1])),area.parseScript)try{key=eval(area.parseScript)}catch(e){}return!0}return!1}))),_this.searchConfigs[host]=searchConfig;var results=[],entryCount=0,doneCount=0,KEY="$key$";key=encodeURIComponent(key),searchConfig.entry.forEach((function(e){var t=e.entry||siteSearchPage;autoMatched&&-1!==t.indexOf(KEY)&&-1!==searchEntryConfigQueryString.indexOf(KEY)&&(t=_service_public__WEBPACK_IMPORTED_MODULE_5__.a.removeQueryStringFromValue(t,KEY));var n=e.queryString;if(searchEntryConfigQueryString&&(n?n&&-1===n.indexOf(KEY)&&(n=searchEntryConfigQueryString+"&"+n):n=searchEntryConfigQueryString),e.appendQueryString&&(n+=e.appendQueryString),searchEntryConfig&&(e.parseScriptFile=searchEntryConfig.parseScriptFile||e.parseScriptFile,e.resultType=searchEntryConfig.resultType||e.resultType,e.resultSelector=searchEntryConfig.resultSelector||e.resultSelector,e.headers=searchEntryConfig.headers||e.headers,e.asyncParse=searchEntryConfig.asyncParse||e.asyncParse,e.requestData=searchEntryConfig.requestData),t&&e.parseScriptFile&&!1!==e.enabled){var o=_this.options.search&&_this.options.search.rows?_this.options.search.rows:10;site.cdn&&site.cdn.length>0&&(site.url=site.cdn[0]),"/"!=(site.url+"").substr(-1)&&(site.url+="/"),"/"==(t+"").substr(0,1)&&(t=(t+"").substr(1));var r=site.url+t;n&&(-1!==t.indexOf("?")?r+="&"+n:r+="?"+n),r=_service_public__WEBPACK_IMPORTED_MODULE_5__.a.removeDuplicateQueryString(r);var i=key+(e.appendToSearchKeyString?" "+e.appendToSearchKeyString:"");if(r=_this.replaceKeys(r,{key:i,rows:o,passkey:site.passkey?site.passkey:""}),e.requestData)try{for(var s in e.requestData)if(e.requestData.hasOwnProperty(s)){var a=e.requestData[s];e.requestData[s]=_service_public__WEBPACK_IMPORTED_MODULE_5__.a.replaceKeys(a,{key:i,passkey:site.passkey?site.passkey:""}),site.user&&(e.requestData[s]=_service_public__WEBPACK_IMPORTED_MODULE_5__.a.replaceKeys(a,site.user,"user"))}}catch(e){_this.service.writeErrorLog(e),_this.service.debug(e)}site.user&&(r=_this.replaceKeys(r,site.user,"user")),entryCount++;var c=e.parseScriptFile;"/"!==c.substr(0,1)&&(c=""+searchConfig.rootPath+c),e.parseScript=_this.parseScriptCache[c],e.parseScript?_this.getSearchResult(r,site,Object.assign(_service_public__WEBPACK_IMPORTED_MODULE_5__.a.clone(searchEntryConfig),_service_public__WEBPACK_IMPORTED_MODULE_5__.a.clone(e)),searchConfig.torrentTagSelectors).then((function(e){e&&e.length&&results.push.apply(results,e),(++doneCount===entryCount||results.length>=o)&&resolve(results.slice(0,o))})).catch((function(e){++doneCount===entryCount&&(results.length>0?resolve(results.slice(0,o)):reject(e))})):(_this.service.debug("searchTorrent: getScriptContent",c),_service_api__WEBPACK_IMPORTED_MODULE_1__.b.getScriptContent(c).done((function(t){_this.service.debug("searchTorrent: getScriptContent done",c),_this.parseScriptCache[c]=t,e.parseScript=t,_this.getSearchResult(r,site,Object.assign(_service_public__WEBPACK_IMPORTED_MODULE_5__.a.clone(searchEntryConfig),_service_public__WEBPACK_IMPORTED_MODULE_5__.a.clone(e)),searchConfig.torrentTagSelectors).then((function(e){_this.service.debug("searchTorrent: getSearchResult done",r),e&&e.length&&results.push.apply(results,e),(++doneCount===entryCount||results.length>=o)&&resolve(results.slice(0,o))})).catch((function(e){_this.service.debug("searchTorrent: getSearchResult catch",r,e),++doneCount===entryCount&&(results.length>0?resolve(results.slice(0,o)):reject(e))}))})).fail((function(e){_this.service.debug("searchTorrent: getScriptContent fail",e)})))}})),0==entryCount&&(result.msg=_this.service.i18n.t("service.searcher.siteSearchEntryIsEmpty",{site:site}),result.type=_interface_common__WEBPACK_IMPORTED_MODULE_0__.g.error,reject(result)),_this.service.debug("searchTorrent: quene done")}))},Searcher.prototype.getSearchResult=function(e,t,n,o){var r=this;return new Promise((function(i,s){n.beforeSearch?new _pageParser__WEBPACK_IMPORTED_MODULE_6__.a(n.beforeSearch,t,r.service.options.connectClientTimeout).getInfos().then((function(a){r.addSearchRequestQueue(e,t,n,o,a).then((function(e){i(e)})).catch((function(e){s(e)}))})).catch((function(a){r.service.writeErrorLog(a),r.addSearchRequestQueue(e,t,n,o).then((function(e){i(e)})).catch((function(e){s(e)}))})):r.addSearchRequestQueue(e,t,n,o).then((function(e){i(e)})).catch((function(e){s(e)}))}))},Searcher.prototype.addSearchRequestQueue=function(url,site,entry,torrentTagSelectors,beforeSearchData){var _this=this,_entry=_service_public__WEBPACK_IMPORTED_MODULE_5__.a.clone(entry);if(_entry.parseScript&&delete _entry.parseScript,beforeSearchData&&(this.service.debug("beforeSearchData",beforeSearchData),url=this.replaceKeys(url,beforeSearchData,"beforeSearchData"),entry.requestData))try{for(var key in entry.requestData)if(entry.requestData.hasOwnProperty(key)){var value=entry.requestData[key];entry.requestData[key]=_service_public__WEBPACK_IMPORTED_MODULE_5__.a.replaceKeys(value,beforeSearchData,"beforeSearchData")}}catch(e){this.service.writeErrorLog(e),this.service.debug(e)}this.service.debug("getSearchResult.start",{url:url,site:site.host,entry:_entry});var logId="";return new Promise((function(resolve,reject){_this.searchRequestQueue[url]=$.ajax({url:url,cache:!0,dataType:"text",contentType:"text/plain",timeout:_this.options.connectClientTimeout||3e4,headers:entry.headers,method:entry.requestMethod||_interface_common__WEBPACK_IMPORTED_MODULE_0__.n.GET,data:entry.requestData}).done((function(result){if(_this.service.debug("getSearchResult.done",url),delete _this.searchRequestQueue[url],result&&"string"==typeof result&&result.length>100||"object"==typeof result){var page=void 0,doc=void 0;try{switch(entry.resultType){case _interface_common__WEBPACK_IMPORTED_MODULE_0__.o.JSON:page=JSON.parse(result);break;default:doc=(new DOMParser).parseFromString(result,"text/html"),page=$(doc).find("body")}}catch(e){return logId=_this.service.logger.add({module:_interface_common__WEBPACK_IMPORTED_MODULE_0__.l.background,event:"service.searcher.getSearchResult.siteSearchResultParseFailed",msg:e}),void reject({success:!1,msg:_this.service.i18n.t("service.searcher.siteSearchResultParseFailed",{site:site}),data:{logId:logId},type:_interface_common__WEBPACK_IMPORTED_MODULE_0__.g.error})}var options={results:[],responseText:result,site:site,resultSelector:entry.resultSelector,page:page,entry:entry,torrentTagSelectors:torrentTagSelectors,errorMsg:"",isLogged:!1,status:ESearchResultParseStatus.success,searcher:_this,url:url};try{if(entry.parseScript){if(entry.asyncParse)return options=Object.assign({reject:reject,resolve:resolve},options),void eval(entry.parseScript);eval(entry.parseScript)}options.errorMsg||options.status!=ESearchResultParseStatus.success?reject({success:!1,msg:_this.getErrorMessage(site,options.status,options.errorMsg),data:{site:site,isLogged:options.isLogged}}):resolve(_service_public__WEBPACK_IMPORTED_MODULE_5__.a.clone(options.results))}catch(e){console.error(e),logId=_this.service.logger.add({module:_interface_common__WEBPACK_IMPORTED_MODULE_0__.l.background,event:"service.searcher.getSearchResult.siteEvalScriptFailed",msg:e}),reject({success:!1,msg:_this.service.i18n.t("service.searcher.siteEvalScriptFailed",{site:site}),data:{logId:logId}})}}else logId=_this.service.logger.add({module:_interface_common__WEBPACK_IMPORTED_MODULE_0__.l.background,event:"service.searcher.getSearchResult.siteSearchResultError",msg:result}),reject({success:!1,msg:_this.service.i18n.t("service.searcher.siteSearchResultError",{site:site}),data:{logId:logId},type:_interface_common__WEBPACK_IMPORTED_MODULE_0__.g.error})})).fail((function(e,t,n){delete _this.searchRequestQueue[url],_this.service.debug({title:"getSearchResult.fail",url:url,entry:entry,textStatus:t,errorThrown:n}),logId=_this.service.logger.add({module:_interface_common__WEBPACK_IMPORTED_MODULE_0__.l.background,event:"service.searcher.getSearchResult.fail",msg:n,data:{url:url,entry:entry,code:e.status,textStatus:t,errorThrown:n,responseText:e.responseText}}),reject({data:{logId:logId,textStatus:t},msg:_this.service.i18n.t("service.searcher.siteNetworkFailed",{site:site,msg:e.status+" "+n+", "+t}),success:!1,type:_interface_common__WEBPACK_IMPORTED_MODULE_0__.g.error})}))}))},Searcher.prototype.getErrorMessage=function(e,t,n){return void 0===t&&(t=ESearchResultParseStatus.success),void 0===n&&(n=""),t!=ESearchResultParseStatus.success?this.service.i18n.t("contentPage.search."+t,{siteName:e.name,msg:n}):n},Searcher.prototype.abortSearch=function(e,t){var n=this;return void 0===t&&(t=""),new Promise((function(o,r){var i=e.host+"",s=n.searchConfigs[i];s.entry&&(n.service.logger.add({module:_interface_common__WEBPACK_IMPORTED_MODULE_0__.l.background,event:"searcher.abortSearch",msg:n.service.i18n.t("service.searcher.siteAbortSearch",{site:e}),data:{site:e.host,key:t}}),s.entry.forEach((function(i){if(i.entry&&i.parseScriptFile&&!1!==i.enabled){e.cdn&&e.cdn.length>0&&(e.url=e.cdn[0]);var s=n.options.search&&n.options.search.rows?n.options.search.rows:10,a=e.url+i.entry;a=n.replaceKeys(a,{key:t,rows:s,passkey:e.passkey?e.passkey:""});var c=n.searchRequestQueue[a];if(c)try{c.abort(),o()}catch(o){n.service.logger.add({module:_interface_common__WEBPACK_IMPORTED_MODULE_0__.l.background,event:"searcher.abortSearch.error",msg:n.service.i18n.t("service.searcher.siteAbortSearchError",{site:e}),data:{site:e.host,key:t,error:o}}),r(o)}else o()}else o()})))}))},Searcher.prototype.getSiteSchema=function(e){var t={};return"string"==typeof e.schema&&void 0===(t=this.options.system&&this.options.system.schemas&&this.options.system.schemas.find((function(t){return t.name==e.schema})))?t:_service_public__WEBPACK_IMPORTED_MODULE_5__.a.clone(t)},Searcher.prototype.replaceKeys=function(e,t,n){void 0===n&&(n="");var o=e;for(var r in t)if(t.hasOwnProperty(r)){var i=t[r],s="$"+r+"$";n&&(s="$"+n+"."+r+"$"),o=o.replace(s,i)}return o},Searcher.prototype.getFieldValue=function(e,t,n){var o;return void 0===n&&(n=""),e.searchEntryConfig&&e.searchEntryConfig.fieldSelector&&(o=e.searchEntryConfig.fieldSelector[n])?new _infoParser__WEBPACK_IMPORTED_MODULE_4__.a(this.service).getFieldData(t,o,e.searchEntryConfig.fieldSelector):null},Searcher.prototype.getCategoryById=function(e,t,n){var o={};return e.categories&&e.categories.forEach((function(e){if(e.category&&("*"==e.entry||t.indexOf(e.entry))){var r=e.category.find((function(e){return e.id==n}));r&&(o=r)}})),o},Searcher.prototype.cfDecodeEmail=function(e){var t,n,o="",r=parseInt(e.substr(0,2),16);for(t=2;e.length-t;t+=2)n=parseInt(e.substr(t,2),16)^r,o+=String.fromCharCode(n);return o},Searcher.prototype.getRowTags=function(e,t){var n=[];if(e&&e.host){var o=this.searchConfigs[e.host].torrentTagSelectors;o&&o.length>0&&o.forEach((function(e){if(e.selector){var o=t.find(e.selector);if(o.length){var r=e.color||_interface_common__WEBPACK_IMPORTED_MODULE_0__.a[e.name]||"",i={name:e.name,color:r};e.title&&o.attr(e.title)&&(i.title=o.attr(e.title)),n.push(i)}}}))}return n},Searcher}()},169:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(57),r=n.n(o),i=function(){function e(e,t){this.options=e,this.systemOptions=t,this.isLogin=!1,this._schema={},this.mergeOptions()}return Object.defineProperty(e.prototype,"schema",{get:function(){var e=this;if(this._schema.name)return this._schema;var t={};return"string"==typeof this.options.schema&&(t=this.systemOptions.system&&this.systemOptions.system.schemas&&this.systemOptions.system.schemas.find((function(t){return t.name==e.options.schema}))),this._schema=t,t},enumerable:!1,configurable:!0}),e.prototype.mergeOptions=function(){var e,t=this,n=this.systemOptions.system&&this.systemOptions.system.sites&&this.systemOptions.system.sites.find((function(e){return e.host==t.options.host}));if(n){var o=[];if(this.options.searchEntry)for(var i=this.options.searchEntry.length-1;i>=0;i--){var s=this.options.searchEntry[i];s.isCustom&&(o.push(s),this.options.searchEntry.splice(i,1))}this.options=r()(!0,{},n,this.options),this.options.searchEntry&&o.length>0&&(e=this.options.searchEntry).push.apply(e,o)}console.log(this.options)},e}()},172:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return PageParser}));var _interface_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_service_public__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),_service_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),_infoParser__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(30),blueimp_md5__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(19),blueimp_md5__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(blueimp_md5__WEBPACK_IMPORTED_MODULE_4__),PageParser=function(){function PageParser(e,t,n,o){void 0===n&&(n=3e4),this.options=e,this.site=t,this.timeout=n,this.commonDatas=o,this.infoParserCache={},this.cacheKey="",this.url="";var r=t.url+"";t.cdn&&t.cdn.length>0&&(r=t.cdn[0]),"/"!=(r+"").substr(-1)&&(r+="/");var i=this.options.page;if("/"==(i+"").substr(0,1)&&(i=(i+"").substr(1)),this.url=(r+i).replace("://","****").replace(/\/\//g,"/").replace("****","://"),this.requestData=this.options.requestData,this.requestData&&this.commonDatas)try{for(var s in this.requestData)if(this.requestData.hasOwnProperty(s)){var a=this.requestData[s];for(var c in this.commonDatas)this.commonDatas.hasOwnProperty(c)&&(this.requestData[s]=_service_public__WEBPACK_IMPORTED_MODULE_1__.a.replaceKeys(a,this.commonDatas[c],c))}}catch(e){console.log(e)}this.cacheKey=blueimp_md5__WEBPACK_IMPORTED_MODULE_4___default()(this.url+JSON.stringify(this.requestData||{}))}return PageParser.prototype.getCache=function(){var e=window.localStorage.getItem(this.cacheKey);if(e){var t=JSON.parse(e);if(t.data&&t.time){var n=(new Date).getTime();return t.time<n?(window.localStorage.removeItem(this.cacheKey),null):t.data}}return null},PageParser.prototype.setCache=function(){if(this.options.dataCacheTime&&this.options.dataCacheTime>0){var e={data:this.resultData,time:(new Date).getTime()+1e3*this.options.dataCacheTime};window.localStorage.setItem(this.cacheKey,JSON.stringify(e))}},PageParser.prototype.getInfos=function(){var e=this;return new Promise((function(t,n){var o=e.getCache();if(o)t(o);else if(!(e.options.parser&&e.site&&e.runParser(t,n)))$.ajax({url:e.url,method:e.options.requestMethod||_interface_common__WEBPACK_IMPORTED_MODULE_0__.n.GET,dataType:"text",headers:e.options.headers,data:e.requestData,timeout:e.timeout}).done((function(o){var r;try{if(e.options.dataType!==_interface_common__WEBPACK_IMPORTED_MODULE_0__.o.JSON){var i=(new DOMParser).parseFromString(o,"text/html"),s=e.options.topElement||"body";r=$(i).find(s)}else r=JSON.parse(o)}catch(e){return void n(e)}if(r&&e.options)try{var a=(new _infoParser__WEBPACK_IMPORTED_MODULE_3__.a).getResult(r,e.options);e.resultData=a,e.setCache(),t(a)}catch(e){n(e)}})).fail((function(e){n(e)}))}))},PageParser.prototype.runParser=function(resolve,reject){var _this=this;if(!this.site||!this.options.parser)return!1;var siteConfigPath="publicSite"==this.site.schema?"publicSites":"sites";this.site.path?siteConfigPath+="/"+this.site.path:siteConfigPath+="/"+this.site.host;var path=this.options.parser;"/"!==path.substr(0,1)&&"http"!==path.substr(0,4)&&(path=siteConfigPath+"/"+path);var _options={site:this.site,rule:this.options,commonDatas:this.commonDatas,resolve:resolve,reject:reject},_self=this,script=this.infoParserCache[path];return script?eval(script):_service_api__WEBPACK_IMPORTED_MODULE_2__.b.getScriptContent(path).done((function(script){_this.infoParserCache[path]=script,eval(script)})),!0},PageParser}()},173:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return User}));var _interface_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_infoParser__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(30),_service_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),_service_public__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1),User=function(){function User(e){this.service=e,this.requestQueue={},this.requestQueueCount=0,this.infoParserCache={},this.InfoParser=_infoParser__WEBPACK_IMPORTED_MODULE_1__.a}return User.prototype.refreshUserData=function(e){var t=this;return void 0===e&&(e=!1),new Promise((function(n,o){var r=[];t.service.options.sites.forEach((function(n){if(!n.allowGetUserInfo||n.offline)return!1;e?n.user&&(n.user.lastUpdateStatus&&[_interface_common__WEBPACK_IMPORTED_MODULE_0__.v.needLogin,_interface_common__WEBPACK_IMPORTED_MODULE_0__.v.unknown].includes(n.user.lastUpdateStatus)||!n.user.lastUpdateStatus)&&r.push(t.getUserInfo(n,!0)):r.push(t.getUserInfo(n,!0))})),Promise.all(r).then((function(e){n(e)}))}))},User.prototype.updateStatus=function(e,t){t.lastUpdateTime=(new Date).getTime(),this.service.userData.update(e,t)},User.prototype.getSiteURL=function(e){return e.cdn&&e.cdn.length>0?e.cdn[0]:e.url},User.prototype.getUserInfo=function(e,t){var n=this;return void 0===t&&(t=!1),this.service.options.autoRefreshUserDataLastTime=(new Date).getTime(),this.service.saveConfig(),new Promise((function(o,r){var i=t?o:r;if(e){var s=n.service.userData.get(e.host)||{},a=n.service.getSiteSelector(e,"userBaseInfo");if(!a)return s.lastUpdateStatus=_interface_common__WEBPACK_IMPORTED_MODULE_0__.v.notSupported,n.updateStatus(e,s),void i(_service_api__WEBPACK_IMPORTED_MODULE_2__.b.createErrorMessage({status:_interface_common__WEBPACK_IMPORTED_MODULE_0__.v.notSupported,msg:n.service.i18n.t("service.user.notSupported")}));var c=""+n.getSiteURL(e)+a.page,u=e.host;n.checkQueue(u,c)?o(s):n.getInfos(u,c,a).then((function(t){if(console.log("userBaseInfo",u,t),s=Object.assign({},t),a&&a.fields&&a.fields.isLogged?s.isLogged&&(s.name||s.id)?s.isLogged=!0:s.isLogged=!1:(s.name||s.id)&&(s.isLogged=!0),!s.isLogged)return s.lastUpdateStatus=_interface_common__WEBPACK_IMPORTED_MODULE_0__.v.needLogin,void i(_service_api__WEBPACK_IMPORTED_MODULE_2__.b.createErrorMessage({msg:n.service.i18n.t("service.user.notLogged"),status:_interface_common__WEBPACK_IMPORTED_MODULE_0__.v.needLogin}));if(!(a=n.service.getSiteSelector(e,"userExtendInfo")))return n.updateStatus(e,s),void o(s);if(s.name||s.id){var r=""+n.getSiteURL(e)+a.page.replace("$user.id$",s.id).replace("$user.name$",s.name).replace("$user.bonusPage$",s.bonusPage);if(n.checkQueue(u,r))return void o(s);n.getInfos(u,r,a).then((function(t){(s=Object.assign(s,t)).lastUpdateStatus=_interface_common__WEBPACK_IMPORTED_MODULE_0__.v.success,n.updateStatus(e,s),n.getMoreInfos(e,s).then((function(){o(s)}))})).catch((function(e){s.lastUpdateStatus=_interface_common__WEBPACK_IMPORTED_MODULE_0__.v.unknown,i(_service_api__WEBPACK_IMPORTED_MODULE_2__.b.createErrorMessage(e))}))}else s.lastUpdateStatus=_interface_common__WEBPACK_IMPORTED_MODULE_0__.v.unknown,i(_service_api__WEBPACK_IMPORTED_MODULE_2__.b.createErrorMessage({status:_interface_common__WEBPACK_IMPORTED_MODULE_0__.v.unknown,msg:n.service.i18n.t("service.user.getUserInfoFailed")}))})).catch((function(e){s.lastUpdateStatus=_interface_common__WEBPACK_IMPORTED_MODULE_0__.v.unknown,console.log("getInfos Error :",e),i(_service_api__WEBPACK_IMPORTED_MODULE_2__.b.createErrorMessage(e))}))}else i(null)}))},User.prototype.getMoreInfos=function(site,userInfo){var _this=this;return new Promise((function(resolve,reject){var requests=[],selectors=["userSeedingTorrents","bonusExtendInfo"];selectors.forEach((function(name){var host=site.host,rule=_this.service.getSiteSelector(site,name);if(rule){var url=""+_this.getSiteURL(site)+rule.page.replace("$user.id$",userInfo.id).replace("$user.name$",userInfo.name).replace("$user.bonusPage$",userInfo.bonusPage);if(_this.checkQueue(host,url))return;if(rule.prerequisites){var user=userInfo;try{var result=eval(rule.prerequisites);if(!0!==result)return}catch(e){return void console.log(e)}}requests.push(_this.getInfos(host,url,rule,site,userInfo))}})),requests.length?Promise.all(requests).then((function(e){e.forEach((function(e){(userInfo=Object.assign(userInfo,e)).lastUpdateStatus=_interface_common__WEBPACK_IMPORTED_MODULE_0__.v.success,_this.updateStatus(site,userInfo)})),resolve(userInfo)})).catch((function(e){resolve(userInfo)})):resolve(userInfo)}))},User.prototype.getInfos=function(e,t,n,o,r){var i=this;return new Promise((function(s,a){t=t.replace("://","****").replace(/\/\//g,"/").replace("****","://");var c=n.requestData;if(c&&r)try{for(var u in c)if(c.hasOwnProperty(u)){var l=c[u];c[u]=_service_public__WEBPACK_IMPORTED_MODULE_3__.a.replaceKeys(l,r,"user")}}catch(e){console.log(e)}if(n.parser&&o)i.runParser(n,o,r,s,a);else{_service_public__WEBPACK_IMPORTED_MODULE_3__.a.updateBadge(++i.requestQueueCount);var h=$.ajax({url:t,method:n.requestMethod||_interface_common__WEBPACK_IMPORTED_MODULE_0__.n.GET,dataType:"text",data:c,headers:n.headers,timeout:i.service.options.connectClientTimeout||3e4}).done((function(o){var r;i.removeQueue(e,t),_service_public__WEBPACK_IMPORTED_MODULE_3__.a.updateBadge(--i.requestQueueCount);try{if(n.dataType!==_interface_common__WEBPACK_IMPORTED_MODULE_0__.o.JSON){var c=(new DOMParser).parseFromString(o,"text/html"),u=n.topElement||"body";r=$(c).find(u)}else r=JSON.parse(o)}catch(n){return i.service.debug("getInfos.error",e,t,n),void a(n)}if(r&&n)try{var l=(new _infoParser__WEBPACK_IMPORTED_MODULE_1__.a).getResult(r,n);s(l)}catch(e){i.service.debug(e),a(e)}})).fail((function(n,r,s){i.removeQueue(e,t),_service_public__WEBPACK_IMPORTED_MODULE_3__.a.updateBadge(--i.requestQueueCount);var c=i.service.i18n.t("service.searcher.siteNetworkFailed",{site:o,msg:n.status+" "+s+", "+r});i.service.debug(c,e,t,n.responseText),a(c)}));i.addQueue(e,t,h)}}))},User.prototype.runParser=function(rule,site,userInfo,resolve,reject){var _this=this,siteConfigPath="publicSite"==site.schema?"publicSites":"sites";site.path?siteConfigPath+="/"+site.path:siteConfigPath+="/"+site.host;var path=rule.parser;"/"!==path.substr(0,1)&&"http"!==path.substr(0,4)&&(path=siteConfigPath+"/"+path);var _options={site:site,rule:rule,userInfo:userInfo,resolve:resolve,reject:reject},_self=this,script=this.infoParserCache[path];script?eval(script):_service_api__WEBPACK_IMPORTED_MODULE_2__.b.getScriptContent(path).done((function(script){_this.infoParserCache[path]=script,eval(script)}))},User.prototype.addQueue=function(e,t,n){var o=this.requestQueue[e]||{};o[t]=n,this.requestQueue[e]=o},User.prototype.checkQueue=function(e,t){return!!(this.requestQueue[e]||{})[t]},User.prototype.removeQueue=function(e,t){var n=this.requestQueue[e]||{};n[t]&&delete n[t],this.requestQueue[e]=n},User.prototype.abortGetUserInfo=function(e){var t=this;return new Promise((function(n,o){var r=e.host,i=t.requestQueue[r],s=[];if(i){for(var a in i)if(i.hasOwnProperty(a)){var c=i[a];try{c.abort()}catch(n){t.service.logger.add({module:_interface_common__WEBPACK_IMPORTED_MODULE_0__.l.background,event:"user.abortGetUserInfo.error",msg:t.service.i18n.t("service.user.abortGetUserInfoFailed"),data:{site:e.host,error:n}}),s.push(n)}}delete t.requestQueue[r]}s.length>0?o(s):n(!0)}))},User.prototype.getCookie=function(e,t){var n=this;return new Promise((function(o,r){_service_public__WEBPACK_IMPORTED_MODULE_3__.a.checkPermissions(["cookies"]).then((function(){n.service.config.getCookiesFromSite(e).then((function(e){for(var n=0,r=e.cookies;n<r.length;n++){var i=r[n];i.name===t&&o(i.value)}o("")})).catch((function(e){r(e)}))})).catch((function(e){r(e)}))}))},User}()},175:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ContextMenus}));var _interface_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),url_parse__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(24),url_parse__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(url_parse__WEBPACK_IMPORTED_MODULE_1__),_service_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),_service_pathHandler__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(176),ContextMenus=function(){function ContextMenus(e){this.service=e,this.options={sites:[],clients:[]},this.rootId="PT-Plugin-Plugin-Content-Menu",this.currentTabId=0,this.siteMenus=[],this.pathHandler=new _service_pathHandler__WEBPACK_IMPORTED_MODULE_3__.a,chrome&&chrome.tabs&&this.initBrowserEvent()}return ContextMenus.prototype.initBrowserEvent=function(){var e=this;chrome.tabs.onActivated.addListener((function(t){chrome.tabs.get(t.tabId,(function(t){if(e.clearSiteMenus(),t.url){var n=new url_parse__WEBPACK_IMPORTED_MODULE_1___default.a(t.url).host;e.createSiteMenus(n)}}))})),chrome.tabs.onUpdated.addListener((function(t,n,o){if(e.clearSiteMenus(),o.url){var r=new url_parse__WEBPACK_IMPORTED_MODULE_1___default.a(o.url).host;e.createSiteMenus(r)}})),chrome.browserAction.onClicked.addListener((function(){e.service.controller.openOptions()}))},ContextMenus.prototype.init=function(e){this.options=e,this.clear(),this.createSearchMenus(),this.createClientMenus(),this.createPluginIconPopupMenus()},ContextMenus.prototype.createPluginIconPopupMenus=function(){this.add({title:this.service.i18n.t("service.contextMenus.history"),contexts:["browser_action"],onclick:function(){chrome.tabs.create({url:"index.html#/history"})}}),this.add({title:this.service.i18n.t("service.contextMenus.systemLog"),contexts:["browser_action"],onclick:function(){chrome.tabs.create({url:"index.html#/system-logs"})}}),this.add({type:"separator",contexts:["browser_action"]}),this.add({title:this.service.i18n.t("service.contextMenus.issues"),contexts:["browser_action"],onclick:function(){chrome.tabs.create({url:"https://github.com/pt-plugins/PT-Plugin-Plus/issues/new"})}})},ContextMenus.prototype.clear=function(){chrome&&chrome.contextMenus&&chrome.contextMenus.removeAll()},ContextMenus.prototype.clearSiteMenus=function(){var e=this;this.siteMenus.forEach((function(t){e.remove(t)})),this.siteMenus=[]},ContextMenus.prototype.getSiteDocumentUrlPatterns=function(e){var t=e.url+"";"/"!=t.substr(-1)&&(t+="/");var n=["*://"+e.host+"/*",""+t];if(e.cdn&&e.cdn.length>0)for(var o=0;o<e.cdn.length;o++){var r=e.cdn[o];n.push(r+("/"!=r.substr(-1)?"/*":"*"),r)}return n},ContextMenus.prototype.createPathMenus=function(e,t,n,o){var r=this;e.forEach((function(e,i){var s=n.id+"**"+t.host+"**"+e+"**"+i;r.add({id:s,title:r.pathHandler.replacePathKey(e,t),parentId:o,contexts:["link"],documentUrlPatterns:r.getSiteDocumentUrlPatterns(t),targetUrlPatterns:r.getSiteUrlPatterns(t),onclick:function(e,t){var n=e.menuItemId.split("**"),o={clientId:n[0],url:e.linkUrl,savePath:n[2]};r.sendTorrentToClient(t.id,o)}})}))},ContextMenus.prototype.createSiteMenus=function(e){var t=this,n=this.options.sites.find((function(t){var n=[t.url].concat(t.cdn);return t.host===e||n.join("|").indexOf(e)>-1}));if(n){if(this.options.allowSelectionTextSearch){var o=n.host;this.siteMenus.push(o),this.add({id:o,title:this.service.i18n.t("service.contextMenus.searchSelectionTextOnThisSite"),contexts:["selection"],documentUrlPatterns:this.getSiteDocumentUrlPatterns(n),onclick:function(n,o){t.service.controller.searchTorrent(n.selectionText,e)}})}this.options.clients.forEach((function(e){if(e.paths){var o=e.id+"-path",r=0;for(var i in t.add({id:o,title:t.service.i18n.t("service.contextMenus.downloadClientPath",{clientName:e.name}),contexts:["link"],documentUrlPatterns:t.getSiteDocumentUrlPatterns(n),targetUrlPatterns:t.getSiteUrlPatterns(n)}),e.paths){var s=e.paths[i];i===n.host&&(r++,t.createPathMenus(s,n,e,o))}var a=e.paths[_interface_common__WEBPACK_IMPORTED_MODULE_0__.e.allSite];a&&(r++,t.createPathMenus(a,n,e,o)),r>0?t.siteMenus.push(o):t.remove(o)}}))}},ContextMenus.prototype.getSiteUrlPatterns=function(e){var t=[];if(e.patterns&&e.patterns.torrentLinks)t=e.patterns.torrentLinks;else{var n=this.getSiteSchema(e);n&&n.patterns&&n.patterns.torrentLinks?t=n.patterns.torrentLinks:t.push("*://*/*")}return t},ContextMenus.prototype.getSiteSchema=function(e){var t={};return"string"==typeof e.schema&&(t=this.options.system&&this.options.system.schemas&&this.options.system.schemas.find((function(t){return t.name==e.schema}))),t},ContextMenus.prototype.sendTorrentToClient=function(e,t){var n=this;void 0===e&&(e=0),console.log("sendTorrentToClient",t);var o,r=this.getSiteFromURL(t.url);if(r&&t.savePath){var i=this.pathHandler.getSavePath(t.savePath,r);if(!1===i)return void _service_api__WEBPACK_IMPORTED_MODULE_2__.b.showNotifications({message:this.service.i18n.t("service.contextMenus.userCanceled")});t.savePath=i}try{chrome.tabs.sendMessage(e,{action:_interface_common__WEBPACK_IMPORTED_MODULE_0__.b.showMessage,data:{type:_interface_common__WEBPACK_IMPORTED_MODULE_0__.g.info,msg:this.service.i18n.t("service.contextMenus.sendingLink"),timeout:2,indeterminate:!0}},(function(e){chrome.runtime.lastError?(chrome.runtime.lastError.message||"").match(/Could not establish connection/)?_service_api__WEBPACK_IMPORTED_MODULE_2__.b.showNotifications({message:n.service.i18n.t("service.contextMenus.pluginStatusIsUnknown")}):_service_api__WEBPACK_IMPORTED_MODULE_2__.b.showNotifications({message:chrome.runtime.lastError.message}):o=e}))}catch(e){return void _service_api__WEBPACK_IMPORTED_MODULE_2__.b.showNotifications({message:e})}this.service.logger.add({module:_interface_common__WEBPACK_IMPORTED_MODULE_0__.l.background,event:"contextMenus.sendTorrentToClient.begin",msg:this.service.i18n.t("service.contextMenus.sendingLink"),data:t});var s=this.options.clients.find((function(e){return e.id===t.clientId}));if(!s)return chrome.tabs.sendMessage(e,{action:_interface_common__WEBPACK_IMPORTED_MODULE_0__.b.showMessage,data:{type:_interface_common__WEBPACK_IMPORTED_MODULE_0__.g.error,msg:this.service.i18n.t("service.contextMenus.downloadClientGetFailed")}}),this.service.logger.add({module:_interface_common__WEBPACK_IMPORTED_MODULE_0__.l.background,event:"contextMenus.sendTorrentToClient.getClientError",msg:this.service.i18n.t("service.contextMenus.downloadClientGetFailed"),data:t}),void this.hideNotice(e,o);t.autoStart=s.autoStart,console.log(t);var a=this.getParsedURL(t.url);if("string"!=typeof a)return chrome.tabs.sendMessage(e,{action:_interface_common__WEBPACK_IMPORTED_MODULE_0__.b.showMessage,data:a}),void this.hideNotice(e,o);t.url=a,this.service.controller.sendTorrentToClient(t).then((function(t){n.service.logger.add({module:_interface_common__WEBPACK_IMPORTED_MODULE_0__.l.background,event:"contextMenus.sendTorrentToClient.done",msg:n.service.i18n.t("service.contextMenus.sendTorrentToClientDone"),data:t}),chrome.tabs.sendMessage(e,{action:_interface_common__WEBPACK_IMPORTED_MODULE_0__.b.showMessage,data:t})})).catch((function(t){n.service.logger.add({module:_interface_common__WEBPACK_IMPORTED_MODULE_0__.l.background,event:"contextMenus.sendTorrentToClient.error",msg:n.service.i18n.t("service.contextMenus.sendTorrentToClientError"),data:t}),chrome.tabs.sendMessage(e,{action:_interface_common__WEBPACK_IMPORTED_MODULE_0__.b.showMessage,data:""==t.status?n.service.i18n.t("service.contextMenus.sendTorrentToClientError"):t})})).finally((function(){n.hideNotice(e,o)}))},ContextMenus.prototype.hideNotice=function(e,t){void 0===e&&(e=0),t&&(t.id?chrome.tabs.sendMessage(e,{action:_interface_common__WEBPACK_IMPORTED_MODULE_0__.b.hideMessage,data:t.id}):t.hide&&t.hide())},ContextMenus.prototype.createSearchMenus=function(){var e=this;this.options.allowSelectionTextSearch&&(this.add({title:this.service.i18n.t("service.contextMenus.searchSelectionText"),contexts:["selection"],onclick:function(t,n){e.service.controller.searchTorrent(t.selectionText)}}),this.pushMoreSearchMenus());this.add({id:"searchWithIMDb",title:this.service.i18n.t("service.contextMenus.searchByIMDb"),contexts:["link"],targetUrlPatterns:["*://www.imdb.com/title/tt*"]}),this.add({parentId:"searchWithIMDb",title:this.service.i18n.t("service.contextMenus.searchByDefault"),contexts:["link"],targetUrlPatterns:["*://www.imdb.com/title/tt*"],onclick:function(t,n){if(t.linkUrl){var o=t.linkUrl.match(/(tt\d+)/);o&&o.length>=2&&e.service.controller.searchTorrent(o[1])}}}),this.pushMoreSearchMenus("searchWithIMDb",["link"],["*://www.imdb.com/title/tt*"],/(tt\d+)/);this.add({id:"searchWithDouban",title:this.service.i18n.t("service.contextMenus.searchByDouban"),contexts:["link"],targetUrlPatterns:["*://movie.douban.com/subject/*"]}),this.add({parentId:"searchWithDouban",title:this.service.i18n.t("service.contextMenus.searchByDefault"),contexts:["link"],targetUrlPatterns:["*://movie.douban.com/subject/*"],onclick:function(t,n){if(t.linkUrl){var o=t.linkUrl.match(/subject\/(\d+)/);o&&o.length>=2&&e.service.controller.searchTorrent("douban"+o[1])}}}),this.pushMoreSearchMenus("searchWithDouban",["link"],["*://movie.douban.com/subject/*"],/subject\/(\d+)/,"douban")},ContextMenus.prototype.pushMoreSearchMenus=function(e,t,n,o,r){var i=this;void 0===e&&(e=void 0),void 0===t&&(t=["selection"]),void 0===n&&(n=void 0),void 0===o&&(o=/(tt\d+)/),void 0===r&&(r="");var s=this.options.sites;if(s&&s.length>0){var a=e+"searchInSite";this.add({id:a,title:this.service.i18n.t("service.contextMenus.searchInSite"),contexts:t,parentId:e,targetUrlPatterns:n}),s.forEach((function(e){var s=a+"**"+e.host;i.add({id:s,title:e.name+" - "+e.host,parentId:a,contexts:t,targetUrlPatterns:n,onclick:function(e,n){var s=e.menuItemId.split("**");if(i.service.debug(i.service.i18n.t("service.contextMenus.searchInSite"),e),t.includes("link")&&e.linkUrl){var a=e.linkUrl.match(o);a&&a.length>=2&&i.service.controller.searchTorrent(r+a[1],s[1])}else i.service.controller.searchTorrent(e.selectionText,s[1])}})}))}var c=this.options.searchSolutions;if(c&&c.length>0){var u=e+"searchInSolution";this.add({id:u,title:this.service.i18n.t("service.contextMenus.searchInSolution"),contexts:t,parentId:e,targetUrlPatterns:n}),c.forEach((function(e){var s=u+"**"+e.id;i.add({id:s,title:""+e.name,parentId:u,contexts:t,targetUrlPatterns:n,onclick:function(e,n){i.service.debug(i.service.i18n.t("service.contextMenus.searchInSolution"),e);var s=e.menuItemId.split("**");if(t.includes("link")&&e.linkUrl){var a=e.linkUrl.match(o);a&&a.length>=2&&i.service.controller.searchTorrent(r+a[1],s[1])}else i.service.controller.searchTorrent(e.selectionText,s[1])}})}))}this.add({title:this.service.i18n.t("service.contextMenus.searchInAllSite"),parentId:e,contexts:t,targetUrlPatterns:n,onclick:function(e,n){if(e.linkUrl){var s=e.linkUrl.match(o);t.includes("link")&&s&&s.length>=2&&i.service.controller.searchTorrent(r+s[1],"all")}else i.service.controller.searchTorrent(e.selectionText,"all")}})},ContextMenus.prototype.createClientMenus=function(){var e=this;if(this.options.defaultClientId){var t=this.options.clients.find((function(t){return t.id===e.options.defaultClientId}));t&&this.add({id:t.id,title:this.service.i18n.t("service.contextMenus.sendTorrentToDefaultClient",{client:t}),contexts:["link"],onclick:function(t,n){e.sendTorrentToClient(n.id,{clientId:t.menuItemId,url:t.linkUrl})}})}this.options.clients.length>1&&(this.add({id:this.rootId,title:this.service.i18n.t("service.contextMenus.sendTorrentToClient"),contexts:["link"]}),this.options.clients.forEach((function(t){t.id!==e.options.defaultClientId&&e.add({id:t.id,title:t.name+" -> "+t.address,parentId:e.rootId,contexts:["link"],onclick:function(t,n){e.sendTorrentToClient(n.id,{clientId:t.menuItemId,url:t.linkUrl})}})})))},ContextMenus.prototype.add=function(e,t){e.id||(e.id=this.getRandomString()),chrome&&chrome.contextMenus&&chrome.contextMenus.create(e,t)},ContextMenus.prototype.remove=function(e,t){try{chrome.contextMenus.remove(e,t),chrome.runtime.lastError&&console.log(chrome.runtime.lastError)}catch(e){console.log(e)}},ContextMenus.prototype.getRandomString=function(e,t){void 0===e&&(e=16),void 0===t&&(t=!0);for(var n=t?"abcdefhijkmnprstwxyz2345678ABCDEFGHJKMNPQRSTWXYZ":"abcdefghijkmnopqrstuvwxyz0123456789ABCDEFGHIJKMNOPQRSTUVWXYZ",o=n.length,r=[],i=0;i<e;i++)r.push(n.charAt(Math.floor(Math.random()*o)));return r.join("")},ContextMenus.prototype.getParsedURL=function(source){var url=new url_parse__WEBPACK_IMPORTED_MODULE_1___default.a(source),site=this.getSiteFromURL(source);if(!site)return source;var options={url:url,site:site,result:source,error:{}},parser=this.getSiteParser(site.host,"downloadURL");if(parser)try{eval(parser)}catch(e){console.error(e)}return options.error&&options.error.msg?options.error:options.result},ContextMenus.prototype.getSiteParser=function(e,t){var n=this.options.system&&this.options.system.sites&&this.options.system.sites.find((function(t){return t.host===e}));if(!n)return"";var o=n.parser&&n.parser[t];if(!o){var r=this.options.system&&this.options.system.schemas&&this.options.system.schemas.find((function(e){return e.name===n.schema}));r&&r.parser&&(o=r.parser[t])}return o},ContextMenus.prototype.getSiteFromURL=function(e){var t=new url_parse__WEBPACK_IMPORTED_MODULE_1___default.a(e);if(!t.host)return null;var n=this.options.sites.find((function(e){var n=[e.url].concat(e.cdn);return e.host==t.host||n.join("").indexOf(t.host)>-1}));return n||null},ContextMenus}()},176:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var o=function(){function e(){}return e.prototype.replacePathKey=function(e,t){if(!e)return e;var n=new Date;return this.replaceKeys(e,{"site.name":t.name,"site.host":t.host,YYYY:n.getFullYear(),MM:("0"+(n.getMonth()+1).toString()).substr(-2),DD:("0"+n.getDate().toString()).substr(-2)})},e.prototype.getSavePath=function(e,t){if(e){var n=e;if(n&&n.indexOf("<...>")>=0){var o=window.prompt("\u5f53\u524d\u4e3a\u81ea\u5b9a\u4e49\u8def\u5f84\uff1a"+n+" \n\u8bf7\u8f93\u5165\u8def\u5f84\u4e2d <...> \u90e8\u5206\u7684\u5185\u5bb9: ");if(null===o)return!1;n=n.replace("<...>",o)}return this.replacePathKey(n,t)}},e.prototype.replaceKeys=function(e,t){var n=e;for(var o in t)if(t.hasOwnProperty(o)){var r=t[o];n=n.replace("$"+o+"$",r)}return n},e}()},177:function(e,t){String.prototype.getQueryString=function(e,t){null==t&&(t="&");var n,o=new RegExp("(^|"+t+"|\\?)"+e+"=([^"+t+"#]*)("+t+"|#|$)");return(n=this.match(o))?decodeURI(n[2]):null},String.prototype.sizeToNumber=function(){let e=this.match(/^(\d*\.?\d+)(.*[^ZEPTGMK])?([ZEPTGMK](B|iB))$/i);if(e){let t=parseFloat(e[1]),n=e[3];switch(!0){case/Zi?B/i.test(n):return t*Math.pow(2,70);case/Ei?B/i.test(n):return t*Math.pow(2,60);case/Pi?B/i.test(n):return t*Math.pow(2,50);case/Ti?B/i.test(n):return t*Math.pow(2,40);case/Gi?B/i.test(n):return t*Math.pow(2,30);case/Mi?B/i.test(n):return t*Math.pow(2,20);case/Ki?B/i.test(n):return t*Math.pow(2,10);default:return t}}return 0}},208:function(e,t){},210:function(e,t){},219:function(e,t){},22:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var o={formatNumber:function(e,t){if(void 0===t&&(t="###,###,###,###.00"),void 0===e)return"";var n=function(e,t,n){if(""===e||void 0===e)return""===t||void 0===t?"":t;var o="",r="",i="",s=0;n||(e=e.split("").reverse().join(""),t=t.split("").reverse().join(""));for(var a=0,c=0;c<t.length;c++,a++)if(void 0!==(r=e.charAt(a)))switch(o=t.charAt(c)){case"#":i+=r,s=c;break;case"0":i=r||r===o?i+r:i+0,s=c;break;case".":case",":i+=r===o?r:(a--,o);break;default:i+=o,a--}return a!==e.length&&"0"!==t.charAt(t.length-1)&&s!==t.length&&"0"!==t.charAt(s)&&(i=i.substr(0,s+1)+e.substr(a)+i.substr(s+1)),","===(i=(n?i:i.split("").reverse().join("")).replace(/(^,)|(,$)|(,,+)/g,"")).substr(0,1)&&(i=i.substr(1)),"-,"===i.substr(0,2)&&(i="-"+i.substr(2)),i},o=e.toString();if(0===o.length)return"";var r=parseFloat(o);if(isNaN(r))return o;if(!t)return o;var i=t.split("."),s=o.split(".");return i.length>1?n(s[0],i[0])+"."+n(s[1],i[1],1):n(s[0],i[0])},formatSize:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n="");var o,r=parseFloat(e);if(isNaN(r))return"";if(r<0)return"N/A";if(0===r)return t?"":"speed"===n?"0.00 KiB/s":"0.00";var i="KiB",s="###,###,###,###.00 ",a="###,###,###,###.000 ";return r<1e3*Math.pow(2,10)?(o=r/Math.pow(2,10),i="KiB"):r<1e3*Math.pow(2,20)?(o=r/Math.pow(2,20),i="MiB"):r<1e3*Math.pow(2,30)?(o=r/Math.pow(2,30),i="GiB"):r<1e3*Math.pow(2,40)?(o=r/Math.pow(2,40),i="TiB",s=a):r<1e3*Math.pow(2,50)?(o=r/Math.pow(2,50),i="PiB",s=a):r<1e3*Math.pow(2,60)?(o=r/Math.pow(2,60),i="EiB",s=a):(o=r/Math.pow(2,70),i="ZiB",s=a),"speed"===n&&(i+="/s"),this.formatNumber(o,s)+i},formatSizeWithNegative:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n="");var o=e=parseFloat(e);e<0&&(o=-o);var r=this.formatSize(o,t,n);return e<0&&(r="- "+r),r},formatSpeed:function(e,t){return void 0===t&&(t=!1),this.formatSize(e,t,"speed")},parseURL:function(e){var t=document.createElement("a");return t.href=e,{source:e,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:function(){for(var e,n={},o=t.search.replace(/^\?/,"").split("&"),r=o.length,i=0;i<r;i++)o[i]&&(n[(e=o[i].split("="))[0]]=e[1]);return n}(),hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^/])/,"/$1"),segments:t.pathname.replace(/^\//,"").split("/"),origin:t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")}},timeAgoToNumber:function(e){var t=e.trim().match(/^([\d.]+).+?((year|month|week|day|hour|min|minute)s?)( +ago)?(.+)?$/i);if(!t)return 0;var n=new Date,o=t[3],r=Math.round(parseFloat(t[1])),i=new Date;switch(o.toLowerCase()){case"year":i=new Date(n.setFullYear(n.getFullYear()-r));break;case"month":i=new Date(n.setMonth(n.getMonth()-r));break;case"day":i=new Date(n.setDate(n.getDate()-r));break;case"week":i=new Date(n.setDate(n.getDate()-7*r));break;case"hour":i=new Date(n.setHours(n.getHours()-r));break;case"min":case"minute":i=new Date(n.setMinutes(n.getMinutes()-r))}return i.getTime()},formatInteger:function(e){return this.formatNumber(e,"###,###,###,###")}}},221:function(e,t){},247:function(e,t){},248:function(e,t){},253:function(e,t){},255:function(e,t){},262:function(e,t){},281:function(e,t){},29:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var o=n(0),r=n(56),i=n.n(r),s=(function(){function e(e){var t=this;this.options=e,this.count=0,this.completedCount=0,this.downloadingCount=0,this.files={},this.queues=[],e.files&&e.files.forEach((function(e){t.push(e)}))}e.prototype.push=function(e){var t=this;if(!(!e.url||e.url&&this.files[e.url])){var n=new s(e);n.onCompleted=function(){t.downloadingCount--,t.completedCount++,t.onCompleted(n),delete t.files[n.url]},n.onStart=function(){t.downloadingCount++},n.onError=function(e){t.downloadingCount--,t.completedCount++,t.options.onError&&t.options.onError.call(t,n,e),delete t.files[n.url]},n.onProgress=function(e,o,r){t.options.onProgress&&t.options.onProgress.call(t,n,e,o,r)},this.files[n.url]=n,this.queues.push(n),this.count++,this.options.autoStart&&n.start()}},e.prototype.start=function(){},e.prototype.onCompleted=function(e){this.options.onCompleted&&this.options.onCompleted.call(this,e)}}(),function(){function e(e){this.lastTime=0,this.startTime=0,this.status=0,this.statusText="",this.url="",this.requestMethod=o.n.GET,this.postData=null,this.fileName="",this.loaded=0,this.total=0,this.percent=0,this.speed=0,this.showSpeed="",this.onProgress=function(){},this.onCompleted=function(){},this.onError=function(){},this.onStart=function(){},this.getDataOnly=!1,this.timeout=0,this.xhr=new XMLHttpRequest,this.fileName=e.fileName||"",this.url=e.url,this.getDataOnly=e.getDataOnly||!1,this.timeout=e.timeout||0,this.requestMethod=e.method||o.n.GET}return e.prototype.start=function(){var e=this;this.lastTime=+new Date,this.startTime=this.lastTime,this.statusText="\u6570\u636e\u51c6\u5907\u4e2d\u2026\u2026",this.timeout>0&&(this.xhr.timeout=this.timeout),this.xhr.open(this.requestMethod,this.url,!0),this.xhr.responseType="blob",this.xhr.onreadystatechange=function(){switch(e.xhr.readyState){case 4:switch(e.xhr.status){case 200:case 302:e.content=e.xhr.response,e.downloadCompleted();break;default:0!=e.xhr.status&&e.downloadError("["+e.url+"] \u4e0b\u8f7d\u5931\u8d25\uff0c\u8fd4\u56de\u7684\u72b6\u6001\u7801\u4e3a\uff1a"+e.xhr.status)}break;case 2:var t=e.xhr.getResponseHeader("Content-Disposition");!t||e.fileName||e.getDataOnly||(e.fileName=e.getFileName(t))}},this.xhr.onprogress=function(t){e.loaded=t.loaded,e.total=t.total,e.percent=(t.loaded/t.total*100).toFixed(2),e.lastTime=+new Date,e.speed=e.loaded/(e.startTime-e.lastTime),e.updateProgress()},this.xhr.onerror=function(t){e.downloadError(t)},this.xhr.ontimeout=function(){e.downloadError("["+e.url+"] \u4e0b\u8f7d\u8d85\u65f6")};var t=null;this.postData&&(t=$.param(this.postData)),this.requestMethod==o.n.POST&&this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.xhr.send(t),this.onStart&&this.onStart.call(this)},e.prototype.getFileName=function(e){void 0===e&&(e="");for(var t,n=e.split(";"),o={},r="",i=0;i<n.length;i++){var s=n[i].replace(" ","").split("=");2==s.length&&(o[s[0]]=s[1].trim())}if(t=o["filename*"]){i=t.lastIndexOf("'");r=t.substr(i+1)}else r=o.filename;return r=r.replace(/"/g,""),decodeURI(r)},e.prototype.downloadCompleted=function(){this.loaded>0&&!this.getDataOnly&&i.a.saveAs(this.content,this.fileName),this.onCompleted&&this.onCompleted.call(this)},e.prototype.downloadError=function(e){this.onError&&this.onError.call(this,e)},e.prototype.updateProgress=function(){this.onProgress&&this.onProgress.call(this,this.loaded,this.total,this.speed)},e}())},3:function(e,t,n){"use strict";n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return d}));var o=n(11),r=n(19),i=n.n(r),s=n(0),a=n(1),c=(n(85),""),u=!1;try{var l=chrome.runtime;u=!0,(c=l.getManifest().options_ui.page.replace("index.html",""))&&"/"==c.substr(-1)&&(c=c.substr(0,c.length-1)),c||(c="chrome-extension://"+chrome.runtime.id)}catch(e){u=!1}var h=u?(u?c:"")+"/resource":"http://"+window.location.hostname+":8001",p={host:h,schemas:h+"/schemas.json",schemaConfig:h+"/schemas/{$schema}/config.json",sites:h+"/sites.json",siteConfig:h+"/sites/{$site}/config.json",clients:h+"/clients.json",clientConfig:h+"/clients/{$client}/config.json",latestReleases:"https://api.github.com/repos/pt-plugins/PT-Plugin-Plus/releases/latest",systemConfig:h+"/systemConfig.json"},f={debugMode:!1,scriptQueues:[],isExtensionMode:u,cache:{localStorage:new o.a,cacheKey:s.f.cache,contents:{},expires:86400,init:function(e){var t=this;f.debugMode&&console.log("cache.init"),this.localStorage.get(this.cacheKey,(function(n){if(n){var o=n.expires;o&&new Date>new Date(o)||f.debugMode?t.contents={}:t.contents=n}e&&e()}))},get:function(e){return this.contents?this.contents[i()(e)]:null},set:function(e,t){this.contents[i()(e)]=t,this.contents.update=(new Date).getTime(),this.contents.expires=(new Date).getTime()+this.expires,this.localStorage.set(this.cacheKey,this.contents)},clear:function(){this.contents={},this.localStorage.set(this.cacheKey,this.contents)},getLastUpdateTime:function(){var e=this;return new Promise((function(t,n){e.localStorage.get(e.cacheKey,(function(e){if(e){var o=e.update;t(o||0)}else n()}))}))}},addScript:function(e){f.debugMode&&console.log("addScript",e),this.scriptQueues.push(e)},applyScripts:function(){var e=this,t=this.scriptQueues.shift();t&&this.execScript(t).then((function(){e.applyScripts()}))},execScript:function(e){var t=this;return new Promise((function(n,o){switch(e.type){case"code":t.runScript(e.content),n();break;default:var r=e.content||e;"http"!==r.substr(0,4)&&("/"!==r.substr(0,1)&&(r="/"+r),r=""+d.host+r);var i=t.cache.get(r);try{i?(t.runScript(i),n()):(console.log("execScript: %s",r),$.ajax({url:r,dataType:"text"}).done((function(e){t.runScript(e),t.cache.set(r,e),n()})).fail((function(e,t,n){e.responseJSON&&e.responseJSON.code&&e.responseJSON.msg?o(e.responseJSON.msg+" ("+e.responseJSON.code+")"):o(t+", "+n)})))}catch(e){o(e)}}}))},runScript:function(e,t){void 0===t&&(t=window),eval.call(t,e)},applyStyle:function(e){var t=this;return new Promise((function(n,o){var r=$("<style/>").appendTo(document.body);switch(e.type){case"file":var i=e.content;"http"!==i.substr(0,4)&&("/"!==i.substr(0,1)&&(i="/"+i),i=""+d.host+i);var s=t.cache.get(i);s?(r.html(s),n()):$.get(i,(function(e){r.html(e),t.cache.set(i,e),n()}),"text");break;default:r.html(e.content),n()}}))},getScriptContent:function(e){var t=d.host+"/"+e;return t="http"===e.substr(0,4)?e:t.replace("resource//","resource/"),f.debugMode&&console.log("getScriptContent",t),$.ajax({url:t,dataType:"text"})},createErrorMessage:function(e){return{type:s.g.error,msg:e,success:!1}},showNotifications:function(e,t){void 0===t&&(t=3e3),a.a.showNotifications(e,t)},getInstallType:function(){return new Promise((function(e,t){chrome&&chrome.management?chrome.management.getSelf((function(t){t.updateUrl&&t.updateUrl.indexOf("pt-plugins/PT-Plugin-Plus")>0?e(s.j.crx):e(t.installType)})):t()}))}};f.cache.init();var d=p},30:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return InfoParser}));var _interface_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),dayjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21),dayjs__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(dayjs__WEBPACK_IMPORTED_MODULE_1__),_service_public__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),dayjs_plugin_customParseFormat__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(170),dayjs_plugin_customParseFormat__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(dayjs_plugin_customParseFormat__WEBPACK_IMPORTED_MODULE_3__),dayjs_plugin_advancedFormat__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(171),dayjs_plugin_advancedFormat__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(dayjs_plugin_advancedFormat__WEBPACK_IMPORTED_MODULE_4__);dayjs__WEBPACK_IMPORTED_MODULE_1___default.a.extend(dayjs_plugin_customParseFormat__WEBPACK_IMPORTED_MODULE_3___default.a),dayjs__WEBPACK_IMPORTED_MODULE_1___default.a.extend(dayjs_plugin_advancedFormat__WEBPACK_IMPORTED_MODULE_4___default.a);var InfoParser=function(){function InfoParser(e){this.service=e}return InfoParser.prototype.getResult=function(e,t){var n={};if(e)for(var o in t.fields)if(t.fields.hasOwnProperty(o)){var r=t.fields[o],i=this.getFieldData(e,r,t);null!=i&&(n[o]=i)}return n},InfoParser.prototype.debug=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.service?(e=this.service).debug.apply(e,t):_service_public__WEBPACK_IMPORTED_MODULE_2__.a.debug.apply(_service_public__WEBPACK_IMPORTED_MODULE_2__.a,t)},InfoParser.prototype.getFieldData=function(content,config,rule){var _this=this,query,selectorIndex=0,selectors=[];if("string"==typeof config.selector)selectors.push(config.selector);else{if(!config.selector||!config.selector.length)return void 0===config.value?null:config.value;selectors=config.selector}selectors.some((function(selector){try{switch(rule.dataType){case _interface_common__WEBPACK_IMPORTED_MODULE_0__.o.JSON:if(query=""==selector?content:"["==selector.substr(0,1)?eval("content"+selector):eval("content."+selector),null!=query)return!0;break;case _interface_common__WEBPACK_IMPORTED_MODULE_0__.o.TEXT:case _interface_common__WEBPACK_IMPORTED_MODULE_0__.o.HTML:default:if(""==selector?query=content:(query=content.find(selector),0==query.length&&(query=content.filter(selector))),query.length>0)return!0}selectorIndex++}catch(e){return _this.debug("InfoParser.getFieldData.Error",selector,e.message,e.stack),!0}}));var result=null,dateTime=dayjs__WEBPACK_IMPORTED_MODULE_1___default.a,_self=this;if(null!=query)if(config.attribute||config.filters||config.switchFilters){config.attribute&&rule.dataType!=_interface_common__WEBPACK_IMPORTED_MODULE_0__.o.JSON&&(query=query.attr(config.attribute));var filters=void 0;filters=config.switchFilters?config.switchFilters[selectorIndex]||null:config.filters,filters&&filters.every((function(filter){try{query=eval(filter)}catch(e){return _this.debug("InfoParser.filter.Error",filter,e.message,e.stack),query=null,!1}return!0})),result=query}else switch(rule.dataType){case _interface_common__WEBPACK_IMPORTED_MODULE_0__.o.JSON:result=query;break;default:result=query.text().trim()}return result},InfoParser.prototype.getTotalSize=function(e){var t=0;return e.forEach((function(e){var n=e.match(/^(\d*\.?\d+)(.*[^ZEPTGMK])?([ZEPTGMK](B|iB)?)$/i);if(n){var o=parseFloat(n[1]),r=n[3].toLowerCase();switch(!0){case/ki?b/.test(r):t+=o*Math.pow(2,10);break;case/mi?b/.test(r):t+=o*Math.pow(2,20);break;case/gi?b/.test(r):t+=o*Math.pow(2,30);break;case/ti?b?/.test(r):t+=o*Math.pow(2,40);break;case/pi?b?/.test(r):t+=o*Math.pow(2,50);break;case/ei?b?/.test(r):t+=o*Math.pow(2,60);break;case/zi?b?/.test(r):t+=o*Math.pow(2,70)}}})),t},InfoParser}()},357:function(e,t){},375:function(e,t,n){"use strict";n.r(t);n(177);var o=n(0),r=n(3),i=n(11),s=function(){function e(){this.arrayValues={}}return e.prototype.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)},e.prototype.clear=function(){return new Promise((function(e,t){try{chrome.storage.sync.clear(),chrome.runtime.lastError?t(chrome.runtime.lastError):e()}catch(e){t(e)}}))},e.prototype._set=function(e,t,n,o,r){var i,s=this;void 0===n&&(n=0);var a=t,c=e,u=-1;if(this.isArray(t)){if(0==n)return n=t.length,void this._set(e+"__count",n,0,(function(){s._set(e,t,n,o,r)}),r);u=t.length-1,a=t.pop(),c=e+"_"+u}chrome.storage.sync.set(((i={})[c]=a,i),(function(){chrome.runtime.lastError?r(chrome.runtime.lastError):u>0?s._set(e,t,n,o,r):o(t)}))},e.prototype._get=function(e,t,n,o,r){var i=this;if(void 0===t&&(t=!1),void 0===n&&(n=0),t)this._get(e+"__count",!1,0,(function(t){t>0?(i.arrayValues[e]=[],i._get(e,!1,t,o,r)):i._get(e,!1,0,o,r)}),(function(t){"\u53c2\u6570\u4e0d\u5b58\u5728"==t?i._get(e,!1,0,o,r):r&&r(t)}));else{var s=e;n>0&&(s=e+"_"+(n-1));try{chrome.storage.sync.get(s,(function(t){var a=null;try{if(!t[s])return void r("\u53c2\u6570\u4e0d\u5b58\u5728");a=t[s]}catch(e){return void r(e)}--n<=0?i.arrayValues[e]?(i.arrayValues[e].push(a),o(i.arrayValues[e]),delete i.arrayValues[e]):o(a):(i.arrayValues[e].push(a),i._get(e,!1,n,o,r))}))}catch(e){r(e)}}},e.prototype.set=function(e,t){var n=this;return new Promise((function(o,r){if(chrome.storage&&chrome.storage.sync)try{n._set(e,t,0,(function(){o(t)}),(function(e){r(e)}))}catch(e){r(e)}else r("chrome.storage \u4e0d\u5b58\u5728")}))},e.prototype.get=function(e){var t=this;return new Promise((function(n,o){if(chrome.storage&&chrome.storage.sync)try{t._get(e,!0,0,(function(e){n(e)}),(function(e){o(e)}))}catch(e){o(e)}else o("chrome.storage \u4e0d\u5b58\u5728")}))},e}(),a=n(1),c=n(21),u=n.n(c),l=n(29),h=function(){function e(e){this.options=e,this.serverURL="",this.serverURL=this.options.address,"/"!==this.serverURL.substr(-1)&&(this.serverURL+="/")}return e.prototype.request=function(e,t,n){var r=this;return void 0===t&&(t=o.n.GET),new Promise((function(i,s){var a={url:r.serverURL+""+e,method:t,dataType:"json",data:n};t===o.n.POST&&(a.processData=!1,a.contentType=!1),$.ajax(a).done((function(e){i(e)})).fail((function(e){s(e)}))}))},e.prototype.create=function(){var e=this;return new Promise((function(t,n){e.request("create").then((function(e){e&&e.data?t(e.data):n()})).catch((function(e){n(e)}))}))},e.prototype.add=function(e){var t=this;return new Promise((function(n,r){t.request(t.options.authCode+"/add",o.n.POST,e).then((function(e){e&&!0===e.data?n(!0):r(!1)})).catch((function(e){r(e)}))}))},e.prototype.get=function(e){var t=this;return new Promise((function(n,o){var r=""+t.serverURL+t.options.authCode+"/get/"+e,i=new l.a({url:r,getDataOnly:!0});i.onCompleted=function(){n(i.content)},i.onError=function(e){console.log(e),o(e)},i.start()}))},e.prototype.delete=function(e){var t=this;return new Promise((function(n,r){t.request(t.options.authCode+"/delete/"+e,o.n.POST).then((function(e){e&&e.data?n(e.data):r(!1)})).catch((function(e){r(e)}))}))},e.prototype.list=function(e){var t=this;return void 0===e&&(e={}),new Promise((function(n,r){t.request(t.options.authCode+"/list",o.n.GET,e).then((function(e){e&&e.data?n(e.data):r(!1)})).catch((function(e){r(e)}))}))},e.prototype.ping=function(){var e=this;return new Promise((function(t,n){e.request(e.options.authCode+"/list",o.n.GET,{pageSize:1}).then((function(){t(!0)})).catch((function(e){n(e)}))}))},e}(),p=n(166),f=function(){function e(e){this.options=e,this.initServer()}return e.prototype.initServer=function(){this.service=Object(p.createClient)(this.options.address,{username:this.options.loginName,password:this.options.loginPwd,digest:!!this.options.digest||void 0})},e.prototype.list=function(e){var t=this;return void 0===e&&(e={}),new Promise((function(n,r){t.service.getDirectoryContents("/",{glob:"*.zip"}).then((function(t){console.log(t);var r=[],i=e.orderMode||o.q.desc;t&&t.length>0&&t.forEach((function(e){r.push({name:e.basename,size:e.size,type:e.type,time:new Date(e.lastmod).getTime()})})),n(r.sort((function(t,n){var r,s;switch(e.orderBy){case o.p.name:r=t.name,s=n.name;break;case o.p.size:r=t.size,s=n.size;break;default:r=t.time,s=n.time}return i===o.q.desc?1==r.toString().localeCompare(s)?-1:1:r.toString().localeCompare(s)})))})).catch((function(e){r(e)}))}))},e.prototype.get=function(e){var t=this;return new Promise((function(n,o){t.service.getFileContents("/"+e).then((function(e){n(e)})).catch((function(e){o(e)}))}))},e.prototype.add=function(e){var t=this;return new Promise((function(n,o){t.service.putFileContents(e.get("name"),e.get("data")).then((function(e){e?n(!0):o(!1)})).catch((function(e){o(e)}))}))},e.prototype.delete=function(e){var t=this;return new Promise((function(n,o){t.service.deleteFile("/"+e).then((function(e){e?n(e.data):o(!1)})).catch((function(e){o(e)}))}))},e.prototype.ping=function(){var e=this;return new Promise((function(t,n){e.service.getDirectoryContents("/").then((function(){t(!0)})).catch((function(e){n(e)}))}))},e}(),d=n(86),_=n.n(d),g=n(19),m=n.n(g),v=n(58),y=function(){function e(){}return e.prototype.createHash=function(e){for(var t=e.length,n=[],o={hash:"",keyMap:[],length:t},r=0;r<32;r++){var i=Math.round(t*Math.random());n.push(e.substr(i,1)),o.keyMap.push(i)}return o.hash=m()(n.join("")),o},e.prototype.createBackupFileBlob=function(e){var t=this;return new Promise((function(n,r){try{var i=new _.a;e.options.system&&delete e.options.system;var s=e.options,c=s.encryptBackupData?s.encryptSecretKey:"";s.encryptSecretKey&&delete e.options.encryptSecretKey;var u=t.encryptData(e.options,c),l=t.encryptData(e.userData,c);i.file("options.json",u),i.file("userdatas.json",l);var h={checkInfo:t.createHash(u+l),version:a.a.getVersion(),time:(new Date).getTime(),encryptMode:c?o.i.AES:""};i.file("manifest.json",JSON.stringify(h)),e.collection&&i.file("collection.json",t.encryptData(e.collection,c)),e.cookies&&i.file("cookies.json",t.encryptData(e.cookies,c)),e.searchResultSnapshot&&i.file("searchResultSnapshot.json",t.encryptData(e.searchResultSnapshot,c)),e.keepUploadTask&&i.file("keepUploadTask.json",t.encryptData(e.keepUploadTask,c)),e.downloadHistory&&i.file("downloadHistory.json",t.encryptData(e.downloadHistory,c)),i.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}}).then((function(e){n(e)}))}catch(e){r(e)}}))},e.prototype.loadZipData=function(e,t,n){var r=this;return void 0===t&&(t="\u8bf7\u8f93\u5165\u5bc6\u94a5\uff1a"),void 0===n&&(n=""),new Promise((function(i,s){_.a.loadAsync(e).then((function(e){var t=[];return t.push(e.file("manifest.json").async("text")),t.push(e.file("options.json").async("text")),t.push(e.file("userdatas.json").async("text")),e.file("collection.json")&&t.push(e.file("collection.json").async("text")),e.file("cookies.json")&&t.push(e.file("cookies.json").async("text")),e.file("searchResultSnapshot.json")&&t.push(e.file("searchResultSnapshot.json").async("text")),e.file("keepUploadTask.json")&&t.push(e.file("keepUploadTask.json").async("text")),e.file("downloadHistory.json")&&t.push(e.file("downloadHistory.json").async("text")),Promise.all(t)})).then((function(e){var c=JSON.parse(e[0]);if(console.log(c),c.encryptMode){if(n&&null===r.decryptData(e[1],n)&&(n=""),!n){var u=window.prompt(t);if(!u)return void s(o.r.needSecretKey);if(n=u,null===r.decryptData(e[1],n))return void s(o.r.errorSecretKey)}}else n="";var l={manifest:c,options:r.decryptData(e[1],n),datas:r.decryptData(e[2],n)};e.length>3&&(l.collection=r.decryptData(e[3],n)),e.length>4&&a.a.checkOptionalPermission("cookies")&&(l.cookies=r.decryptData(e[4],n)),e.length>5&&(l.searchResultSnapshot=r.decryptData(e[5],n)),e.length>6&&(l.keepUploadTask=r.decryptData(e[6],n)),e.length>7&&(l.downloadHistory=r.decryptData(e[7],n)),r.checkData(l.manifest,e[1]+e[2])?i(l):s("error")})).catch((function(e){console.log(e),s(e)}))}))},e.prototype.checkData=function(e,t){if(!e)return!1;if(!e.checkInfo)return!1;var n=e.checkInfo;if(t.length!==n.length)return!1;var o=[];try{if(32!==n.keyMap.length)return!1;for(var r=0;r<32;r++){var i=n.keyMap[r];o.push(t.substr(i,1))}if(m()(o.join(""))===n.hash)return!0}catch(e){}return!1},e.prototype.encryptData=function(e,t){return void 0===t&&(t=""),t?this.encrypt(JSON.stringify(e),t):JSON.stringify(e)},e.prototype.decryptData=function(e,t){if(void 0===t&&(t=""),!t)return JSON.parse(e);try{return JSON.parse(this.decrypt(e,t))}catch(e){return null}},e.prototype.encrypt=function(e,t){return void 0===t&&(t=""),v.AES.encrypt(e,t).toString()},e.prototype.decrypt=function(e,t){return void 0===t&&(t=""),v.AES.decrypt(e,t).toString(v.enc.Utf8)},e}(),b=n(85),P=n(56),E=n.n(P),D=function(){function e(e){this.service=e,this.name=o.f.default,this.localStorage=new i.a,this.syncStorage=new s,this.favicon=new b.a(this.service),this.schemas=[],this.sites=[],this.clients=[],this.publicSites=[],this.requestCount=0,this.backupFileParser=new y,this.options={exceedSizeUnit:o.s.GiB,sites:[],clients:[],backupServers:[],system:{},allowDropToSend:!0,allowSelectionTextSearch:!0,needConfirmWhenExceedSize:!0,exceedSize:10,search:{rows:50,timeout:3e4,saveKey:!0},connectClientTimeout:3e4,rowsPerPageItems:[10,20,50,100,200,{text:"$vuetify.dataIterator.rowsPerPageAll",value:-1}],searchSolutions:[],navBarIsOpen:!0,showMoiveInfoCardOnSearch:!0,beforeSearchingOptions:{getMovieInformation:!0,maxMovieInformationCount:5,searchModeForItem:o.d.id},showToolbarOnContentPage:!0,downloadFailedRetry:!1,downloadFailedFailedRetryCount:3,downloadFailedFailedRetryInterval:5,batchDownloadInterval:0,enableBackgroundDownload:!1,position:o.m.right,encryptBackupData:!1,allowSaveSnapshot:!0},this.uiOptions={},this.reload()}return e.prototype.reload=function(){r.b.cache.clear(),this.getSystemConfig()},e.prototype.save=function(e){e&&(this.options=e),this.localStorage.set(this.name,this.cleaningOptions(this.options))},e.prototype.getFavicons=function(){var e=this;return new Promise((function(t,n){var o=[];e.sites.forEach((function(e){o.push(e.activeURL||e.url||"")})),e.options.sites&&e.options.sites.forEach((function(e){o.push(e.activeURL||e.url||"")})),e.favicon.gets(o).then((function(n){n.forEach((function(t){var n=e.options.sites.find((function(e){var n,o=[e.url].concat(e.cdn,null===(n=e.formerHosts)||void 0===n?void 0:n.map((function(e){return"//"+e})));return e.host==t.host||o.join("").indexOf("//"+t.host)>-1}));n&&(n.icon=t.data)})),e.save(),e.service.options=e.options,t(e.options)})).catch((function(t){e.service.debug(t),n(t)}))}))},e.prototype.getFavicon=function(e,t){var n=this;return void 0===t&&(t=!1),new Promise((function(o,r){n.favicon.get(e,t).then((function(e){var t=n.options.sites.find((function(t){var n,o=[t.url].concat(t.cdn,null===(n=t.formerHosts)||void 0===n?void 0:n.map((function(e){return"//"+e})));return t.host==e.host||o.join("").indexOf("//"+e.host)>-1}));t&&(t.icon=e.data,n.save(),n.service.options=n.options),o(e)})).catch((function(e){n.service.debug(e),r(e)}))}))},e.prototype.cleaningOptions=function(e){var t=this,n=JSON.parse(JSON.stringify(e));return n.sites&&n.sites.forEach((function(e){t.sites.find((function(t){return t.host==e.host}))&&(["categories","selectors","patterns","torrentTagSelectors","icon","activeURL","searchEntryConfig","schema","supportedFeatures","mergeSchemaTagSelectors"].forEach((function(t){var n=e;n[t]&&delete n[t]})),e.searchEntry&&e.searchEntry.forEach((function(t,n){t.isCustom||(e.searchEntry[n]={name:t.name,enabled:t.enabled})}))),a.a.isExtensionMode&&e.icon&&"data:image"===e.icon.substr(0,10)&&delete e.icon})),n.clients&&n.clients.forEach((function(e){["pathDescription","description","warning","scripts","ver","icon"].forEach((function(t){e[t]&&delete e[t]}))})),n},e.prototype.read=function(){var e=this;return new Promise((function(t,n){e.localStorage.get(o.f.uiOptions,(function(t){if(t){var n=Object.assign({},e.uiOptions);e.uiOptions=Object.assign(n,t)}})),e.loadConfig(t)}))},e.prototype.loadConfig=function(e){var t=this;this.requestCount>0?setTimeout((function(){t.loadConfig(e)}),100):this.localStorage.get(this.name,(function(n){t.resetRunTimeOptions(n),e&&e(t.options)}))},e.prototype.resetRunTimeOptions=function(e){var t=this;if(e){e.system&&delete e.system;var n=Object.assign({},this.options);this.options=Object.assign(n,e)}this.options.locale||(this.options.locale=navigator.language||"zh-CN"),this.options.system={schemas:this.schemas,sites:this.sites,clients:this.clients,publicSites:this.publicSites},this.upgradeSites(),this.options.sites&&this.options.sites.length&&this.sites.forEach((function(e){var n=t.options.sites.findIndex((function(t){return t.host===e.host}));if(n>-1){var o=Object.assign(Object.assign({},e),t.options.sites[n]);e.categories&&(o.categories=e.categories),e.schema&&(o.schema=e.schema),!e.torrentTagSelectors&&o.torrentTagSelectors?delete o.torrentTagSelectors:o.torrentTagSelectors=e.torrentTagSelectors,!e.patterns&&o.patterns?delete o.patterns:o.patterns=e.patterns,!e.levelRequirements&&o.levelRequirements?delete o.levelRequirements:o.levelRequirements=e.levelRequirements,o.searchEntry&&e.searchEntry?e.searchEntry.forEach((function(e){if(o.searchEntry){var t=o.searchEntry&&o.searchEntry.findIndex((function(t){return t.name==e.name&&!t.isCustom}));null!=t&&t>-1?o.searchEntry[t]=Object.assign(Object.assign({},e),{enabled:o.searchEntry[t].enabled}):o.searchEntry.push(Object.assign({},e))}})):e.searchEntry&&(o.searchEntry=e.searchEntry),e.icon||o.icon||(o.icon=o.url+"/favicon.ico"),t.options.sites[n]=o}})),this.options.sites.forEach((function(e){e.cdn&&e.cdn.length>0?(e.activeURL=e.cdn[0],e.cdn=t.arrayUnique(e.cdn)):e.activeURL=e.url,null==e.priority&&(e.priority=100)})),this.options.clients&&this.options.clients.length&&this.options.clients.forEach((function(e,n){var o=t.clients.find((function(t){return t.type===e.type}));o&&(t.options.clients[n]=Object.assign(Object.assign({},o),t.options.clients[n]))})),a.a.isExtensionMode&&this.getFavicons(),console.log(this.options)},e.prototype.arrayUnique=function(e){var t=[],n={};return e.forEach((function(e){n[e]||(t.push(e),n[e]=1)})),t},e.prototype.upgradeSites=function(){var e=this;this.sites.forEach((function(t){if(t.host){var n=t.formerHosts,o=t.host;n&&n.length>0&&n.forEach((function(n){var r=e.options.sites.find((function(e){return e.host===n}));r&&(console.log("upgradeSites.site",r,o),r.host=o,r.url=t.url,t.icon||r.icon?r.icon=t.icon:r.icon=r.url+"/favicon.ico"),e.options.searchSolutions&&e.options.searchSolutions.forEach((function(e){e.range.forEach((function(e){e.host==n&&(console.log("upgradeSites.searchSolutions",e.host,o),e.host=o)}))})),e.options.clients&&e.options.clients.length>0&&e.options.clients.forEach((function(e){var t=e.paths;if(t)for(var r in t)if(r==n&&t.hasOwnProperty(r)){console.log("upgradeSites.client.paths",e.name,r,o);var i=t[r];t[o]=Object.assign([],i),delete t[r]}}))}))}}))},e.prototype.readUIOptions=function(){var e=this;return new Promise((function(t,n){e.localStorage.get(o.f.uiOptions,(function(n){if(n){var o=Object.assign({},e.uiOptions);e.uiOptions=Object.assign(o,n)}t(e.uiOptions)}))}))},e.prototype.saveUIOptions=function(e){var t=this;return new Promise((function(n,r){t.localStorage.set(o.f.uiOptions,e||t.uiOptions),n()}))},e.prototype.getSystemConfig=function(){var e=this;this.schemas=[],this.sites=[],this.clients=[],this.publicSites=[],this.getContentFromApi(""+r.a.systemConfig).then((function(t){t&&(e.schemas=t.schemas,e.sites=t.sites,e.clients=t.clients,e.publicSites=t.publicSites)}))},e.prototype.getSchemas=function(){var e=this;this.schemas=[],this.getContentFromApi(""+r.a.schemas).then((function(t){t.length&&t.forEach((function(t){"dir"===t.type&&e.addSchema(r.a.schemaConfig.replace(/\{\$schema\}/g,t.name))}))}))},e.prototype.addSchema=function(e){var t=this;this.getContentFromApi(e).then((function(e){e&&e.name&&t.schemas.push(e)}))},e.prototype.getSites=function(){var e=this;this.sites=[],this.getContentFromApi(r.a.sites).then((function(t){t.length&&t.forEach((function(t){"dir"===t.type&&e.addSite(r.a.siteConfig.replace(/\{\$site\}/g,t.name))}))}))},e.prototype.addSite=function(e){var t=this;this.getContentFromApi(e).then((function(e){e&&e.name&&t.sites.push(e)}))},e.prototype.getClients=function(){var e=this;this.clients=[],this.getContentFromApi(r.a.clients).then((function(t){t.length&&t.forEach((function(t){"dir"===t.type&&e.addClient(r.a.clientConfig.replace(/\{\$client\}/g,t.name))}))}))},e.prototype.addClient=function(e){var t=this;this.getContentFromApi(e).then((function(e){e&&e.name&&t.clients.push(e)}))},e.prototype.getContentFromApi=function(e){var t=this;return a.a.updateBadge(++this.requestCount),new Promise((function(n,o){var i=r.b.cache.get(e);if(i)return n(i),void a.a.updateBadge(--t.requestCount);$.getJSON(e).done((function(o){r.b.cache.set(e,o),a.a.updateBadge(--t.requestCount),n(o)})).fail((function(e){a.a.updateBadge(--t.requestCount),o&&o(e)}))}))},e.prototype.backupToGoogle=function(){var e=this;return new Promise((function(t,n){if(chrome.storage&&chrome.storage.sync){var o=e.cleaningOptions(e.options);o.system&&delete o.system;var i=Object.assign([],o.clients),s=Object.assign([],o.sites);delete o.clients,delete o.sites,e.syncStorage.set(e.name,o).then((function(){e.syncStorage.set(e.name+".clients",i).then((function(){e.syncStorage.set(e.name+".sites",s).then((function(){t(e.options)})).catch((function(e){n(r.b.createErrorMessage(e))}))})).catch((function(e){n(r.b.createErrorMessage(e))}))})).catch((function(e){n(r.b.createErrorMessage(e))}))}else n(r.b.createErrorMessage("chrome.storage \u4e0d\u5b58\u5728"))}))},e.prototype.restoreFromGoogle=function(){var e=this;return new Promise((function(t,n){chrome.storage&&chrome.storage.sync?e.syncStorage.get(e.name).then((function(o){var i=Object.assign({},e.options.system),s=o;s.system=i,e.syncStorage.get(e.name+".clients").then((function(o){s.clients=o,e.syncStorage.get(e.name+".sites").then((function(n){s.sites=n,e.resetRunTimeOptions(s),e.save(),setTimeout((function(){t(e.options)}),300)})).catch((function(e){n(r.b.createErrorMessage(e))}))})).catch((function(e){n(r.b.createErrorMessage(e))}))})).catch((function(e){n(r.b.createErrorMessage(e))})):n(r.b.createErrorMessage("chrome.storage \u4e0d\u5b58\u5728"))}))},e.prototype.getBackupRawData=function(){var e=this;return new Promise((function(t,n){try{var r=e.service.userData.get("",o.u.all),i=e.cleaningOptions(e.service.options);delete i.system;var s={options:i,userData:r,collection:{items:e.service.collection.items,groups:e.service.collection.groups},cookies:void 0,searchResultSnapshot:e.service.searchResultSnapshot.items,keepUploadTask:e.service.keepUploadTask.items,downloadHistory:void 0},c=[];c.push(e.service.controller.downloadHistory.load()),e.service.options.allowBackupCookies&&a.a.checkOptionalPermission("cookies")&&c.push(e.getAllSiteCookies()),Promise.all(c).then((function(e){s.downloadHistory=e[0],e.length>1&&(s.cookies=e[1]),t(s)})).catch((function(){t(s)}))}catch(e){n(e)}}))},e.prototype.createBackupFile=function(e){var t=this;return new Promise((function(n,o){t.getBackupFileBlob().then((function(o){E.a.saveAs(o,e||t.getNewBackupFileName()),n(!0)})).catch((function(e){o(e)}))}))},e.prototype.getBackupFileBlob=function(){var e=this;return new Promise((function(t,n){try{e.getBackupRawData().then((function(n){e.backupFileParser.createBackupFileBlob(n).then((function(e){t(e)}))})).catch((function(e){n(e)}))}catch(e){n(e)}}))},e.prototype.getAllSiteCookies=function(){var e=this;return new Promise((function(t,n){a.a.checkPermissions(["cookies"]).then((function(){var o=e.options.sites;if(o&&o.length>0){var r=[];o.forEach((function(t){r.push(e.getCookiesFromSite(t))})),Promise.all(r).then((function(e){t(e)})).catch((function(e){n(e)}))}})).catch((function(e){n(e)}))}))},e.prototype.getCookiesFromSite=function(e){return new Promise((function(t,n){var o=e.activeURL||e.url;chrome.cookies.getAll({url:o},(function(r){chrome.runtime.lastError?n(chrome.runtime.lastError.message):(t({host:e.host,url:o,cookies:r}),console.log(r))}))}))},e.prototype.restoreCookies=function(e){var t=this;return new Promise((function(n,o){var r=[],i=["name","value","domain","path","secure","httpOnly","expirationDate"];e.forEach((function(e){e.cookies.forEach((function(n){var o=a.a.clone(n);for(var s in o)o.hasOwnProperty(s)&&!i.includes(s)&&delete o[s];o.url=e.url,r.push(t.setCookies(o,e.host))}))})),Promise.all(r).then((function(){n()})).catch((function(){n()}))}))},e.prototype.setCookies=function(e,t){var n=this;return new Promise((function(o,r){var i=a.a.getSiteFromHost(t,n.service.options);chrome.cookies.get({url:(i.activeURL||i.url)+"",name:e.name+""},(function(n){var i=!1,s=(new Date).getTime()/1e3;(null===n||n.expirationDate&&n.expirationDate<s)&&(i=!0),i?(e.expirationDate&&e.expirationDate<s&&(e.expirationDate=s+86400),chrome.cookies.set(e,(function(e){chrome.runtime.lastError?r(chrome.runtime.lastError.message):(o(e),console.log(e))}))):(console.log("\u8df3\u8fc7 %s: %s",t,e.name),o())}))}))},e.prototype.getNewBackupFileName=function(){return a.a.getNewBackupFileName()},e.prototype.backupToServer=function(e){var t=this;return console.log("backupToServer",e),new Promise((function(n,r){var i=u()().valueOf(),s=t.getNewBackupFileName(),a=null;t.getBackupFileBlob().then((function(t){var c=new FormData;switch(c.append("name",s),c.append("data",t),e.type){case o.c.OWSS:a=new h(e);break;case o.c.WebDAV:a=new f(e);break;default:r("\u6682\u4e0d\u652f\u6301")}a&&a.add(c).then((function(e){n({time:i,fileName:s})})).catch((function(e){r(e)}))})).catch((function(e){r(e)}))}))},e.prototype.restoreFromServer=function(e,t){var n=this;return new Promise((function(r,i){var s=null;switch(e.type){case o.c.OWSS:s=new h(e);break;case o.c.WebDAV:s=new f(e);break;default:i("\u6682\u4e0d\u652f\u6301")}s&&s.get(t).then((function(e){n.backupFileParser.loadZipData(e,n.service.i18n.t("settings.backup.enterSecretKey"),n.service.options.encryptSecretKey).then((function(e){r(e)})).catch((function(e){i(e)}))})).catch((function(e){i(e)}))}))},e.prototype.getBackupListFromServer=function(e,t){return void 0===t&&(t={}),new Promise((function(n,r){var i=null;switch(e.type){case o.c.OWSS:i=new h(e);break;case o.c.WebDAV:i=new f(e);break;default:r("\u6682\u4e0d\u652f\u6301")}i&&i.list(t).then((function(e){n(e)})).catch((function(e){r(e)}))}))},e.prototype.deleteFileFromBackupServer=function(e,t){return new Promise((function(n,r){var i=null;switch(e.type){case o.c.OWSS:i=new h(e);break;case o.c.WebDAV:i=new f(e);break;default:r("\u6682\u4e0d\u652f\u6301")}i&&i.delete(t).then((function(e){n(e)})).catch((function(e){r(e)}))}))},e.prototype.testBackupServerConnectivity=function(e){return new Promise((function(t,n){var r=null;switch(e.type){case o.c.OWSS:r=new h(e);break;case o.c.WebDAV:r=new f(e);break;default:n("\u6682\u4e0d\u652f\u6301")}r&&r.ping().then((function(e){t(e)})).catch((function(e){n(e)}))}))},e}(),w=n(22),S=n(167),C=function(){function e(){this.items=[],this.storage=new i.a,this.load()}return e.prototype.load=function(){var e=this;return new Promise((function(t,n){e.storage.get(o.f.downloadHistory,(function(n){e.items=n||[],t(e.items)}))}))},e.prototype.add=function(e,t,n,o){var r=this;void 0===t&&(t=""),void 0===n&&(n=""),void 0===o&&(o=!0);var i={data:e,clientId:n,host:t,success:o,time:(new Date).getTime()};this.items?-1===this.items.findIndex((function(t){return t.data.url===e.url}))&&(this.items.push(i),this.updateData()):this.load().then((function(){r.items.push(i),r.updateData()}))},e.prototype.remove=function(e){var t=this;return new Promise((function(n,o){t.load().then((function(){for(var o=function(n){var o=t.items[n];e.findIndex((function(e){return e.data.url===o.data.url}))>=0&&t.items.splice(n,1)},r=t.items.length-1;r>=0;r--)o(r);t.updateData(),n(t.items)}))}))},e.prototype.clear=function(){var e=this;return new Promise((function(t,n){e.items=[],e.updateData(),t(e.items)}))},e.prototype.reset=function(e){var t=this;return new Promise((function(n,o){e&&Array.isArray(e)?(t.items=e,t.updateData(),n(t.items)):o(!1)}))},e.prototype.updateData=function(){this.storage.set(o.f.downloadHistory,this.items)},e}(),T=n(168),M=n(24),O=n.n(M),I=n(173),k=function(){function e(){this.doubanApiURL="https://api.douban.com/v2",this.doubanFrodoApi="https://frodo.douban.com/api/v2",this.douban={frodo:{apiKeys:["054022eaeae0b00e0fc068c0c0a2102a"],entApiKeys:["054022eaeae0b00e0fc068c0c0a2102a"],methods:{movie:{search:this.doubanFrodoApi+"/search?q=$key$&count=$count$&apiKey=$apikey$",imdb:"https://omit.mkrobot.org/movie/infos/$imdbid$",subject:"https://omit.mkrobot.org/movie/infos/douban$id$"}}},common:{apiKeys:["02646d3fb69a52ff072d47bf23cef8fd","0b2bdeda43b5688921839c8ecb20399b","0dad551ec0f84ed02907ff5c42e8ec70","0df993c66c0c636e29ecbb5344252a4a"],entApiKeys:["0dad551ec0f84ed02907ff5c42e8ec70","02646d3fb69a52ff072d47bf23cef8fd"],methods:{movie:{search:this.doubanApiURL+"/movie/search?q=$key$&count=$count$&apikey=$apikey$",imdb:this.doubanApiURL+"/movie/imdb/$imdbid$?apikey=$apikey$",subject:this.doubanApiURL+"/movie/subject/$id$?apikey=$apikey$"}}}},this.omdbApiURL="https://www.omdbapi.com",this.omitApiURL="https://omit.mkrobot.org",this.omdbApiKeys=["e0d3039d","a67d9bce","6be019fc","4ee790e0","d82cb888","d58193b6","15c0aa3f","53acf36d","3a864b75","2892ab46","b507af90","7cf67120","85b2a90c","2896ff0a","aa4b9983","c4e08870","5d5c0049","79a462f2","e4c3fce8","918d70df","e94cb667","eb84d6d7","e192b5a","d62b4cf5","5e6442a3","9b1468c6"],this.doubanApiKeys=["02646d3fb69a52ff072d47bf23cef8fd","0b2bdeda43b5688921839c8ecb20399b","0dad551ec0f84ed02907ff5c42e8ec70","0df993c66c0c636e29ecbb5344252a4a"],this.doubanEntApiKeys=["0dad551ec0f84ed02907ff5c42e8ec70","02646d3fb69a52ff072d47bf23cef8fd"],this.omitApiKeys=["kiqMY6MC"],this.cache={base:{},ratings:{},doubanToIMDb:{},search:{}},this.timeout=3e3,this.doubanApi=this.douban.frodo,this.requsetQueue={}}return e.prototype.getInfos=function(e){return/(douban\d+)/.test(e)?this.getInfoFromDoubanId(e.replace("douban","")):/^(tt\d+)$/.test(e)?this.getInfoFromIMDb(e):new Promise((function(e,t){t("\u6682\u672a\u5b9e\u73b0")}))},e.prototype.isIMDbId=function(e){return/^(tt\d+)$/.test(e)},e.prototype.getInfoFromIMDb=function(e){var t=this;return new Promise((function(n,o){if(t.isIMDbId(e)){var r=t.cache.base[e];if(r)return void n(r);var i=a.a.replaceKeys(t.doubanApi.methods.movie.imdb,{imdbid:e,apikey:t.getDoubanApiKey()});$.ajax({url:i,timeout:t.timeout}).done((function(o){var r;o&&(r=o.data||o),t.cache.base[e]=r,n(r)})).fail((function(e){o(e)}))}else o("error IMDbId")}))},e.prototype.getInfoFromDoubanId=function(e){var t=this;return new Promise((function(n,o){if(/^(\d+)$/.test(e)){var r=t.cache.base[e];if(r)return void n(r);var i=a.a.replaceKeys(t.doubanApi.methods.movie.subject,{id:e,apikey:t.getDoubanApiKey()});$.ajax({url:i,timeout:t.timeout}).done((function(o){var r;o&&(r=o.data||o),t.cache.base[e]=r,n(r)})).fail((function(e){o(e)}))}else o("error douban id")}))},e.prototype.getRatings=function(e){var t=this;return new Promise((function(n,o){if(t.isIMDbId(e)){var r=t.cache.ratings[e];if(r)return void n(r);var i=0,s=function(){var r=t.getOmdbApiKey(),a=t.omdbApiURL+"/?i="+e+"&apikey="+r+"&tomatoes=true";$.ajax({url:a,timeout:t.timeout}).done((function(a){if(a&&a.Error)return++i>=5?void o(a):(t.removeApiKey("omdb",r),void s());t.cache.ratings[e]=a,n(a)})).fail((function(e){o(e)}))};s()}else o("error IMDbId")}))},e.prototype.getOmdbApiKey=function(){return this.omdbApiKeys[Math.floor(Math.random()*this.omdbApiKeys.length)]},e.prototype.getDoubanApiKey=function(){return this.doubanApi.apiKeys[Math.floor(Math.random()*this.doubanApi.apiKeys.length)]},e.prototype.getDoubanEntApiKey=function(){return this.doubanApi.entApiKeys[Math.floor(Math.random()*this.doubanApi.entApiKeys.length)]},e.prototype.getIMDbIdFromDouban=function(e){var t=this;return new Promise((function(n,o){var r=t.cache.doubanToIMDb[e];if(r)n(r);else{var i=t.omitApiURL+"/movie/"+e+"/douban/imdb";t.requsetQueue[i]?o():(t.requsetQueue[i]=!0,$.ajax({url:i,timeout:t.timeout}).done((function(r){console.log("getIMDbIdFromDouban",r),r.data?(t.cache.doubanToIMDb[e]=r.data,n(r.data)):o(r)})).fail((function(e){o(e)})).always((function(){delete t.requsetQueue[i]})))}}))},e.prototype.queryMovieInfoFromDouban=function(e,t){var n=this;return void 0===t&&(t=5),this.isIMDbId(e)?this.getInfoFromIMDb(e):new Promise((function(t,o){var r=n.cache.search[e];if(r)t(r);else{var i=n.omitApiURL+"/movie/search/"+e;n.requsetQueue[i]?o():(n.requsetQueue[i]=!0,$.ajax({url:i,timeout:n.timeout}).done((function(r){console.log("queryMovieInfoFromDouban",r),r.data?(n.cache.search[e]=r.data,t(r.data)):o(r)})).fail((function(e){o(e)})).always((function(){delete n.requsetQueue[i]})))}}))},e.prototype.appendApiKey=function(e,t){var n;switch(void 0===e&&(e=""),e){case"omdb":n=this.omdbApiKeys;break;case"douban":n=this.doubanApiKeys}t.forEach((function(e){e&&!n.includes(e)&&n.push(e)}))},e.prototype.removeApiKey=function(e,t){void 0===e&&(e="");var n=[];switch(e){case"omdb":n=this.omdbApiKeys;break;case"douban":n=this.doubanApiKeys}var o=n.findIndex((function(e){if(e===t)return!0}));-1!==o&&n.splice(o,1)},e.prototype.verifyOmdbApiKey=function(e){var t=this;return new Promise((function(n,o){var r=t.omdbApiURL+"/?i=tt0111161&apikey="+e+"&tomatoes=true";$.ajax({url:r,timeout:t.timeout}).done((function(e){e&&e.Error?o(e.Error):n()})).fail((function(e){o(e)}))}))},e.prototype.verifyDoubanApiKey=function(e){var t=this;return new Promise((function(n,o){var r=t.doubanApiURL+"/movie/imdb/tt0111161?apikey="+e;$.ajax({url:r,timeout:t.timeout}).done((function(e){e&&e.title?n():o(e.Error)})).fail((function(e){o(e)}))}))},e.prototype.getTopSearches=function(e){var t=this;return void 0===e&&(e=9),new Promise((function(n,o){$.ajax({url:t.omitApiURL+"/movie/top/"+e+"?apikey="+t.omitApiKeys[0],timeout:t.timeout}).then((function(e){e&&e.data?n(e.data):o()})).catch((function(e){o(e)}))}))},e}(),U=n(174),R=n.n(U),x=function(){function e(e){this.service=e,this.options={sites:[],clients:[]},this.defaultClientOptions={},this.siteDefaultClients={},this.optionsTabId=0,this.downloadHistory=new C,this.clients={},this.searcher=new T.a(this.service),this.userService=new I.a(this.service),this.movieInfoService=new k,this.clientController=new S.a,this.isInitialized=!1,this.contentPages=[],this.debuggerTabId=0,this.imageBase64Cache={},this.downloadFailedRetriesCache={},this.torrentInfosCache={}}return e.prototype.init=function(e){this.reset(e),this.isInitialized=!0},e.prototype.reset=function(e){this.options=e,this.clientController.init(e),this.searcher.options=e,this.initDefaultClient(),this.siteDefaultClients={},e.connectClientTimeout&&(this.movieInfoService.timeout=e.connectClientTimeout),this.options.apiKey&&(this.options.apiKey.omdb&&this.options.apiKey.omdb.length>0&&this.movieInfoService.appendApiKey("omdb",this.options.apiKey.omdb),this.options.apiKey.douban&&this.options.apiKey.douban.length>0&&this.movieInfoService.appendApiKey("douban",this.options.apiKey.douban))},e.prototype.getSearchResult=function(e){return this.searcher.searchTorrent(e.site,e.key,e.payload)},e.prototype.abortSearch=function(e){return this.searcher.abortSearch(e.site,e.key)},e.prototype.getDownloadHistory=function(){return this.downloadHistory.load()},e.prototype.saveDownloadHistory=function(e,t,n,o){void 0===t&&(t=""),void 0===n&&(n=""),void 0===o&&(o=!0),this.options.saveDownloadHistory&&this.downloadHistory.add(e,t,n,o)},e.prototype.removeDownloadHistory=function(e){return this.downloadHistory.remove(e)},e.prototype.clearDownloadHistory=function(){return this.downloadHistory.clear()},e.prototype.resetDownloadHistory=function(e){return this.downloadHistory.reset(e)},e.prototype.sendTorrentToClient=function(e){var t=this;return new Promise((function(n,o){if(e.url){var r=w.a.parseURL(e.url).host,i=t.options.clients.find((function(t){return t.id===e.clientId}));i?t.getClient(i).then((function(i){t.doDownload(i,e,r).then((function(e){n(e)})).catch((function(e){o(e)}))})):o({msg:t.service.i18n.t("service.controller.invalidDownloadServer")})}else o({msg:t.service.i18n.t("service.controller.invalidAddress")})}))},e.prototype.sendTorrentToDefaultClient=function(e){var t=this;return new Promise((function(n,o){var r=w.a.parseURL(e.url).host,i=t.getSiteFromHost(r);r=i.host+"";var s=t.getSiteDefaultPath(i),a=t.siteDefaultClients[r];!e.savePath&&s&&(e.savePath=s),a?t.doDownload(a,e,r).then((function(e){n(e)})).catch((function(e){o(e)})):t.initSiteDefaultClient(r).then((function(i){t.siteDefaultClients[r]=i,t.doDownload(i,e,r).then((function(e){n(e)})).catch((function(e){o(e)}))}))}))},e.prototype.doDownload=function(e,t,n){var r=this;return void 0===n&&(n=""),new Promise((function(i,s){e.client.call(o.b.addTorrentFromURL,{url:t.url,savePath:t.savePath,autoStart:void 0!==t.autoStart&&t.autoStart}).then((function(a){if(r.service.logger.add({module:o.l.background,event:"service.controller.doDownload.finished",msg:r.service.i18n.t("service.controller.downloadFinished",{name:e.options.name,action:o.b.addTorrentFromURL}),data:a}),!t.title&&r.torrentInfosCache[t.url]&&(t.title=r.torrentInfosCache[t.url]),!a||0!==a.code&&!1!==a.success)r.saveDownloadHistory(t,n,e.options.id,!0),r.formatSendResult(a,e.options,t).then((function(e){i(e)})).catch((function(e){s(e)})),r.downloadFailedRetriesCache[t.url]&&delete r.downloadFailedRetriesCache[t.url];else{if(r.downloadFailedRetry(e,t,n,a,i,s))return;switch(a.msg){case"timeout":s({success:!1,msg:r.service.i18n.t("service.controller.downloadTimeout"),status:"error"});break;default:s({success:!1,msg:a.msg,status:"error"})}r.saveDownloadHistory(t,n,e.options.id,!1)}})).catch((function(a){r.downloadFailedRetry(e,t,n,a,i,s)||(r.service.logger.add({module:o.l.background,event:"service.controller.doDownload.error",msg:r.service.i18n.t("service.controller.downloadError",{name:e.options.name,action:o.b.addTorrentFromURL}),data:a}),r.saveDownloadHistory(t,n,e.options.id,!1),s(a))}))}))},e.prototype.downloadFailedRetry=function(e,t,n,r,i,s){var a=this;if(void 0===n&&(n=""),this.options.downloadFailedRetry){var c=this.options.downloadFailedFailedRetryCount;void 0===c&&(c=0);var u=this.downloadFailedRetriesCache[t.url];if(void 0===u&&(u=0),u<c)return u++,this.service.logger.add({module:o.l.background,event:"service.controller.downloadFailedRetries",msg:this.service.i18n.t("service.controller.downloadError",{name:e.options.name,action:o.b.addTorrentFromURL})+" ("+u+")",data:r}),this.downloadFailedRetriesCache[t.url]=u,this.options.downloadFailedFailedRetryInterval&&this.options.downloadFailedFailedRetryInterval>0?setTimeout((function(){a.doDownload(e,t,n).then((function(e){i(e)})).catch((function(e){s(e)}))}),1e3*this.options.downloadFailedFailedRetryInterval):this.doDownload(e,t,n).then((function(e){i(e)})).catch((function(e){s(e)})),!0;delete this.downloadFailedRetriesCache[t.url]}return!1},e.prototype.getSiteFromHost=function(e){return this.options.sites.find((function(t){var n=[t.url].concat(t.cdn);return t.host==e||n.join("").indexOf(e)>-1}))},e.prototype.getSiteDefaultPath=function(e,t){void 0===t&&(t=""),t||(t=e.defaultClientId||this.options.defaultClientId);var n=this.options.clients.find((function(e){return e.id===t})),o="";if(n&&n.paths)for(var r in n.paths)if(e.host===r){o=n.paths[r][0];break}return o},e.prototype.formatSendResult=function(e,t,n){var r=this;return new Promise((function(i,s){var a={type:o.g.success,msg:r.service.i18n.t("service.controller.torrentAdded",{title:n.title})+(n.savePath?r.service.i18n.t("service.controller.torrentSavePath",{path:n.savePath,interpolation:{escapeValue:!1}}):""),success:!0,data:e};switch(t.type){case o.h.transmission:if(null!=e.id)a.msg=r.service.i18n.t("service.controller.transmissionSuccess",{data:e}),n.savePath&&(a.msg+=r.service.i18n.t("service.controller.torrentSavePath",{path:n.savePath,interpolation:{escapeValue:!1}}));else if(e.status)switch(e.status){case"duplicate":a.type=o.g.error,a.success=!1,a.msg=r.service.i18n.t("service.controller.transmissionDuplicate",{name:e.torrent.name,id:e.torrent.id});break;case"error":a.type=o.g.error,a.success=!1,a.msg=r.service.i18n.t("service.controller.transmissionError");break;default:a.msg=e.msg}else a.msg=e}i(a)}))},e.prototype.getClient=function(e){return this.clientController.getClient(e)},e.prototype.initDefaultClient=function(){var e=this;if(this.options.clients){var t=this.options.clients.find((function(t){return t.id===e.options.defaultClientId}));t&&this.getClient(t).then((function(t){e.defaultClient=t.client,e.defaultClientOptions=t.options}))}},e.prototype.initSiteDefaultClient=function(e){var t=this,n=this.options.sites.find((function(t){return t.host==e})),o=this.options.clients.find((function(e){return e.id===n.defaultClientId}));return o?this.getClient(o):new Promise((function(e,n){e({client:t.defaultClient,options:t.defaultClientOptions})}))},e.prototype.copyTextToClipboard=function(e){if(void 0===e&&(e=""),!e)return!1;var t=$("<textarea/>");return t.text(e),$("body").append(t),t.select(),document.execCommand("copy"),t.remove(),!0},e.prototype.getFreeSpace=function(e){var t=this;return e.clientId?new Promise((function(n,r){var i=t.options.clients.find((function(t){return t.id===e.clientId}));i&&t.getClient(i).then((function(t){t.client.call(o.b.getFreeSpace,e).then((function(e){n(e)}))}))})):this.getDefaultClientFreeSpace(e)},e.prototype.getDefaultClientFreeSpace=function(e){var t=this;return new Promise((function(n,r){t.defaultClient.call(o.b.getFreeSpace,e).then((function(e){n(e)}))}))},e.prototype.updateOptionsTabId=function(e){this.optionsTabId=e},e.prototype.searchTorrent=function(e,t){void 0===e&&(e=""),void 0===t&&(t="");var n="";e&&(n="search-torrent/"+e),t&&(n+="/"+t),this.openOptions(n)},e.prototype.openOptions=function(e){var t=this;void 0===e&&(e="");var n="/";e&&(n+=e),0==this.optionsTabId?this.openURL(n):chrome.tabs.get(this.optionsTabId,(function(e){!chrome.runtime.lastError&&e?chrome.tabs.update(e.id,{active:!0,url:"index.html#"+n}):t.openURL(n)}))},e.prototype.openURL=function(e){var t=this;void 0===e&&(e=""),e&&("/"===e.substr(0,1)&&(e="index.html#"+e),chrome.tabs.create({url:e},(function(e){t.optionsTabId=e.id})))},e.prototype.getSiteSchema=function(e){var t={};if("string"==typeof e.schema)t=this.options.system&&this.options.system.schemas&&this.options.system.schemas.find((function(t){return t.name==e.schema}));else{var n=this.options.system&&this.options.system.sites&&this.options.system.sites.find((function(e){return e.host==n.host}));n&&n.schema&&((t=n.schema).siteOnly=!0)}return t},e.prototype.replaceKeys=function(e,t){var n=e;for(var o in t)if(t.hasOwnProperty(o)){var r=t[o];n=n.replace("$"+o+"$",r)}return n},e.prototype.call=function(e,t){var n=this;return new Promise((function(o,r){var i=n;console.log("contorller.call",e.action),i[e.action](e.data,t).then((function(e){o(e)})).catch((function(e){r(e)}))}))},e.prototype.addContentPage=function(e,t){var n=this;return new Promise((function(e,o){try{t.tab&&n.contentPages.push(t.tab.id),e()}catch(e){o(e)}}))},e.prototype.backupToGoogle=function(){return this.service.config.backupToGoogle()},e.prototype.restoreFromGoogle=function(){return this.service.config.restoreFromGoogle()},e.prototype.clearFromGoogle=function(){return this.service.config.syncStorage.clear()},e.prototype.reloadConfig=function(){var e=this;return new Promise((function(t,n){e.service.config.reload(),t()}))},e.prototype.getTorrentDataFromURL=function(e){var t=this;return new Promise((function(n,i){var s="";"string"==typeof e?e={url:s=e,parseTorrent:!1}:s=e.url;var a=t.getSiteOptionsFromURL(s),c=o.n.GET;a&&(c=a.downloadMethod||o.n.GET);var u=new l.a({url:s,getDataOnly:!0,timeout:t.service.options.connectClientTimeout});u.requestMethod=c,u.onCompleted=function(){console.log("getTorrentDataFromURL.completed",s),u.content&&/octet-stream|x-bittorrent/gi.test(u.content.type)?R.a.remote(u.content,(function(o,r){o?(console.log("parse.error",o),e.parseTorrent?i(o):n(u.content)):(r&&(t.torrentInfosCache[s]=r.name),e.parseTorrent?n({url:s,torrent:r}):n(u.content))})):i(r.b.createErrorMessage(t.service.i18n.t("service.controller.invalidTorrent",{link:o.w.faq})))},u.onError=function(e){i(r.b.createErrorMessage(e))},u.start()}))},e.prototype.getSiteOptionsFromURL=function(e){var t=new O.a(e).host;return this.options.system&&this.options.system.sites&&this.options.system.sites.find((function(e){return e.host==t}))},e.prototype.getUserInfoForAllSite=function(){var e=this;return new Promise((function(t,n){var o=0,r=0,i=[];e.options.sites.forEach((function(n){n.allowGetUserInfo&&(o++,e.getUserInfo(n).then((function(e){e&&i.push({site:n,user:e}),++r>=o&&t(i)})).catch((function(){++r>=o&&t(i)})))})),r==o&&0==r&&n(e.service.i18n.t("service.controller.getUserInfoSiteIsEmpty"))}))},e.prototype.getUserInfo=function(e){return this.userService.getUserInfo(e)},e.prototype.abortGetUserInfo=function(e){return this.userService.abortGetUserInfo(e)},e.prototype.getBase64FromImageUrl=function(e){var t=this;return new Promise((function(n,o){var i=t.imageBase64Cache[e];if(i)n(i);else{var s=new l.a({url:e,getDataOnly:!0,timeout:t.service.options.connectClientTimeout});s.onCompleted=function(){if(console.log("getBase64FromImageUrl.completed",e),s.content&&/image/gi.test(s.content.type)){var i=new FileReader;i.onloadend=function(){t.imageBase64Cache[e]=i.result,n(i.result)},i.readAsDataURL(s.content)}else o(r.b.createErrorMessage(t.service.i18n.t("service.controller.invalidImage")))},s.onError=function(e){o(r.b.createErrorMessage(e))},s.start()}}))},e.prototype.getUserHistoryData=function(e){var t=this;return new Promise((function(n,r){n(t.service.userData.get(e,o.u.all))}))},e.prototype.resetUserDatas=function(e){var t=this;return new Promise((function(n,o){t.service.userData.reset(e),n()}))},e.prototype.getMovieInfos=function(e){return this.movieInfoService.getInfos(e)},e.prototype.getMovieRatings=function(e){return this.movieInfoService.getRatings(e)},e.prototype.getIMDbIdFromDouban=function(e){return this.movieInfoService.getIMDbIdFromDouban(e)},e.prototype.queryMovieInfoFromDouban=function(e){return this.movieInfoService.queryMovieInfoFromDouban(e.key,e.count)},e.prototype.addBrowserDownloads=function(e){var t=this;return new Promise((function(n,o){t.service.checkPermissions(["downloads"]).then((function(){var t=[];Array.isArray(e)?t=e:t.push(e),t.forEach((function(e){chrome.downloads.download(e,(function(e){console.log(e)}))})),n(t.length)})).catch((function(){o({success:!1,msg:t.service.i18n.t("service.controller.noPermission")})}))}))},e.prototype.getCurrentLanguageResource=function(e){var t=this;return new Promise((function(n,o){var r=t.service.options.locale||"en",i=t.service.i18n.i18next.getResourceBundle(r,"translation");i?e&&i[e]?n(i[e]):n(i):o()}))},e.prototype.addLanguage=function(e){return this.service.i18n.add(e)},e.prototype.replaceLanguage=function(e){return this.service.i18n.replace(e)},e.prototype.backupToServer=function(e){return this.service.config.backupToServer(e)},e.prototype.getBackupListFromServer=function(e){void 0===e&&(e={});var t=e.server;return delete e.server,this.service.config.getBackupListFromServer(t,e)},e.prototype.restoreFromServer=function(e){return void 0===e&&(e={}),this.service.config.restoreFromServer(e.server,e.path)},e.prototype.deleteFileFromBackupServer=function(e){return void 0===e&&(e={}),this.service.config.deleteFileFromBackupServer(e.server,e.path)},e.prototype.sendTorrentsInBackground=function(e){var t=this;return void 0===e&&(e=[]),new Promise((function(n,o){t.service.downloadQuene.add(e).run(),n(t.service.i18n.t("service.controller.downloadTaskIsCreated",{count:e.length}))}))},e.prototype.createBackupFile=function(e){return this.service.config.createBackupFile(e)},e.prototype.addTorrentToCollection=function(e){return this.options.defaultCollectionGroupId&&(e.groups=[this.options.defaultCollectionGroupId]),this.service.collection.add(e)},e.prototype.getTorrentCollections=function(e){return this.service.collection.load(e)},e.prototype.deleteTorrentFromCollention=function(e){return Array.isArray(e)?this.service.collection.remove(e):this.service.collection.delete(e)},e.prototype.clearTorrentCollention=function(){return this.service.collection.clear()},e.prototype.getTorrentCollention=function(e){return this.service.collection.get(e)},e.prototype.getSiteSelectorConfig=function(e){var t=this;return new Promise((function(n,o){var r=t.service.getSiteSelector(e.host,e.name);r?n(r):o(!1)}))},e.prototype.resetTorrentCollections=function(e){return this.service.collection.reset(e)},e.prototype.getTorrentCollectionGroups=function(){return this.service.collection.getGroups()},e.prototype.addTorrentCollectionGroup=function(e){return this.service.collection.addGroup(e)},e.prototype.addTorrentCollectionToGroup=function(e){return this.service.collection.addToGroup(e.item,e.groupId)},e.prototype.updateTorrentCollectionGroup=function(e){return this.service.collection.updateGroup(e)},e.prototype.removeTorrentCollectionFromGroup=function(e){return this.service.collection.removeFromGroup(e.item,e.groupId)},e.prototype.removeTorrentCollectionGroup=function(e){return this.service.collection.removeGroup(e)},e.prototype.updateTorrentCollention=function(e){return this.service.collection.update(e)},e.prototype.getAllTorrentCollectionLinks=function(){var e=this;return new Promise((function(t,n){var o=e.service.collection.getAllLinks();o?t(o):n(!1)}))},e.prototype.restoreCookies=function(e){return this.service.config.restoreCookies(e)},e.prototype.resetFavicons=function(){return this.service.config.favicon.clear(),this.service.config.getFavicons()},e.prototype.resetFavicon=function(e){return this.service.config.getFavicon(e,!0)},e.prototype.getBackupRawData=function(){return this.service.config.getBackupRawData()},e.prototype.testBackupServerConnectivity=function(e){return this.service.config.testBackupServerConnectivity(e)},e.prototype.createSearchResultSnapshot=function(e){return this.service.searchResultSnapshot.add(e)},e.prototype.getSearchResultSnapshot=function(e){return this.service.searchResultSnapshot.get(e)},e.prototype.loadSearchResultSnapshot=function(){return this.service.searchResultSnapshot.load()},e.prototype.removeSearchResultSnapshot=function(e){return this.service.searchResultSnapshot.remove(e)},e.prototype.clearSearchResultSnapshot=function(){return this.service.searchResultSnapshot.clear()},e.prototype.resetSearchResultSnapshot=function(e){return this.service.searchResultSnapshot.reset(e)},e.prototype.createKeepUploadTask=function(e){return this.service.keepUploadTask.add(e)},e.prototype.getKeepUploadTask=function(e){return this.service.keepUploadTask.get(e)},e.prototype.loadKeepUploadTask=function(){return this.service.keepUploadTask.load()},e.prototype.removeKeepUploadTask=function(e){return this.service.keepUploadTask.remove(e)},e.prototype.clearKeepUploadTask=function(){return this.service.keepUploadTask.clear()},e.prototype.resetKeepUploadTask=function(e){return this.service.keepUploadTask.reset(e)},e.prototype.updateKeepUploadTask=function(e){return this.service.keepUploadTask.update(e)},e.prototype.updateDebuggerTabId=function(e){var t=this;return new Promise((function(n,r){t.debuggerTabId=e,t.debuggerPort=chrome.tabs.connect(e,{name:o.l.debugger}),n()}))},e.prototype.pushDebugMsg=function(e){var t=this;return new Promise((function(n,r){console.log(e),t.debuggerTabId&&chrome.tabs.get(t.debuggerTabId,(function(n){n&&t.debuggerPort&&t.debuggerPort.postMessage({action:o.b.pushDebugMsg,data:e}),chrome.runtime.lastError&&(console.log(chrome.runtime.lastError.message),t.debuggerTabId=0,t.debuggerPort=void 0)})),n()}))},e.prototype.getTopSearches=function(e){return void 0===e&&(e=9),this.movieInfoService.getTopSearches(e)},e}(),A=function(){function e(){this.maxLength=1e3,this.items=[],this.storage=new i.a,this.configKey=o.f.systemLogs,this.load()}return e.prototype.load=function(){var e=this;return new Promise((function(t,n){e.storage.get(e.configKey,(function(n){e.items=n||[],t(e.items)}))}))},e.prototype.add=function(e){var t=this,n=(new Date).getTime(),o=Object.assign({module:"",time:n,id:a.a.getNewId()},e);return this.items?(this.items.length>=this.maxLength&&this.items.splice(0,1),this.items.push(o),this.storage.set(this.configKey,this.items)):this.load().then((function(){t.items.push(o),t.storage.set(t.configKey,t.items)})),o.id},e.prototype.remove=function(e){var t=this;return new Promise((function(n,o){t.load().then((function(){for(var o=function(n){var o=t.items[n];e.findIndex((function(e){return e.id===o.id}))>=0&&t.items.splice(n,1)},r=t.items.length-1;r>=0;r--)o(r);t.storage.set(t.configKey,t.items),n(t.items)}))}))},e.prototype.clear=function(){var e=this;return new Promise((function(t,n){e.items=[],e.storage.set(e.configKey,e.items),t(e.items)}))},e}(),L=n(175),K=function(){function e(e){this.service=e,this.items=null,this.storage=new i.a,this.configKey=o.f.userDatas,this.load()}return e.prototype.load=function(){var e=this;return new Promise((function(t,n){e.storage.get(e.configKey,(function(n){console.log("UserData.load",n),e.items=n||{},t(e.items)}))}))},e.prototype.get=function(e,t){if(void 0===t&&(t=o.u.latest),!this.items)return null;if(!e)return this.items;var n=this.items[e];if(!n)return null;switch(t){case o.u.all:return n;case o.u.today:return n[a.a.getToDay()]}return n[o.u.latest]},e.prototype.update=function(e,t){var n=this,r=e.host;if(r){var i=Object.assign({},t);if(null==this.items)this.load().then((function(){n.update(e,t)}));else{var s=this.items[r];s||(s={}),s[a.a.getToDay()]=i,s[o.u.latest]=i,this.items[r]=s,this.storage.set(this.configKey,this.items).then((function(){n.service.saveUserData()}))}}},e.prototype.clear=function(){var e=this;return new Promise((function(t,n){e.items={},e.storage.set(e.configKey,e.items).then((function(){e.service.saveUserData(),t(e.items)}))}))},e.prototype.upgrade=function(){var e=this;return new Promise((function(t,n){if(e.service.options&&e.service.options.system&&e.service.options.system.sites){var o=e.service.options.system.sites;e.load().then((function(r){r?(o.forEach((function(e){if(e.host){var t=e.formerHosts,n=e.host;t&&t.length>0&&t.forEach((function(e){for(var t in r)if(t==e&&r.hasOwnProperty(t)){var o=r[t];r[n]=Object.assign({},o),delete r[t]}}))}})),e.items=r,e.storage.set(e.configKey,r),e.service.saveUserData(),t(r)):n(null)}))}else n(null)}))},e.prototype.reset=function(e){var t=this;this.items=e,this.storage.set(this.configKey,this.items).then((function(){t.service.saveUserData()}))},e}(),B=function(){function e(e){this.service=e,this.splitString=" \u2192 ",this.initEvents()}return e.prototype.init=function(){},e.prototype.initEvents=function(){var e=this;chrome&&chrome.omnibox&&(chrome.omnibox.onInputChanged.addListener((function(t,n){if(t&&e.service.options.searchSolutions){var o=[];e.service.options.searchSolutions.forEach((function(n){o.push({content:""+n.name+e.splitString+t,description:e.service.i18n.t("service.omnibox.search",{solutionName:n.name,text:t})})})),o.length>0&&n(o)}})),chrome.omnibox.onInputEntered.addListener((function(t){var n,o="",r="",i="";if(-1!=t.indexOf(e.splitString)){if(n=t.split(e.splitString),o=n[0],i=n[1],o&&e.service.options.searchSolutions){var s=e.service.options.searchSolutions.find((function(e){return e.name==o}));s&&(r=s.id)}}else i=t;chrome.tabs.create({url:"index.html#/search-torrent/"+i+(r?"/"+r:"")})})))},e}(),F=n(13),q=function(){function e(e){this.service=e,this.loadedLanguages=[],this.i18next=F.a}return e.prototype.init=function(){return F.a.init({interpolation:{prefix:"{",suffix:"}"}}),this.reset(this.service.options.locale||"en")},e.prototype.reset=function(e){var t=this;return new Promise((function(n,o){if(console.log(F.a.language),F.a.language!==e)return t.loadedLanguages.includes(e)?void F.a.changeLanguage(e).then((function(){n(e)})):void $.getJSON(r.a.host+"/i18n/"+e+".json").done((function(o){F.a.addResourceBundle(e,"translation",o.words,!0,!0),t.loadedLanguages.push(e),F.a.changeLanguage(e).then((function(){n(e)}))})).fail((function(r){"en"==e?o(r):t.reset("en").then((function(){n(e)}))}));n(e)}))},e.prototype.t=function(e,t){return F.a.t(e,t)},e.prototype.add=function(e){var t=this;return new Promise((function(n,o){e.name&&e.code?t.loadedLanguages.includes(e.code)?o():(F.a.addResourceBundle(e.code,"translation",e.words,!0,!0),t.loadedLanguages.push(e.code),F.a.changeLanguage(e.code).then((function(){n(e.code)}))):o()}))},e.prototype.replace=function(e){var t=this;return new Promise((function(n,o){e.name&&e.code?t.loadedLanguages.includes(e.code)&&(F.a.addResourceBundle(e.code,"translation",e.words,!0,!0),F.a.changeLanguage(e.code).then((function(){n(e.code)}))):o()}))},e}(),W=function(){function e(e){this.service=e,this.queues=[],this.isRunning=!1,this.timer=void 0,this.successCount=0,this.failedCount=0}return e.prototype.add=function(e){var t;return Array.isArray(e)?(t=this.queues).push.apply(t,e):this.queues.push(e),this},e.prototype.run=function(){var e=this;if(this.isRunning)return this;clearTimeout(this.timer);var t=this.queues.shift();if(t){this.isRunning=!0;var n=1e3*(this.service.options.batchDownloadInterval||0);(t.clientId?this.service.controller.sendTorrentToClient:this.service.controller.sendTorrentToDefaultClient).call(this.service.controller,t).then((function(){e.successCount++})).catch((function(t){console.log(t),e.failedCount++})).finally((function(){e.isRunning=!1,n>0?e.timer=window.setTimeout((function(){e.run()}),n):e.run()}))}else a.a.showNotifications({message:this.service.i18n.t("service.controller.downloadTaskIsCompleted",{success:this.successCount,failed:this.failedCount})},1e4),this.successCount=0,this.failedCount=0;return this},e}(),j=function(){function e(){this.items=[],this.groups=[],this.storage=new i.a,this.movieInfoService=new k,this.configKey=o.f.collection,this.load()}return e.prototype.load=function(e){var t=this;return new Promise((function(n,o){t.storage.get(t.configKey,(function(o){var r={groups:[],items:[]};Array.isArray(o)?r.items=o:o&&(r=Object.assign(r,o)),t.groups=r.groups||[],t.items=r.items||[];var i=[];e?t.items.forEach((function(t){t.groups&&t.groups.includes(e)&&i.push(t)})):i=t.items,t.updateGroupCount(),n(i)}))}))},e.prototype.updateGroupCount=function(){var e=this;this.groups.forEach((function(t){t.count=0,e.items.forEach((function(e){e.groups&&t.id&&e.groups.includes(t.id)&&(t.count||(t.count=0),t.count++)}))}))},e.prototype.add=function(e){var t=this;return new Promise((function(n,o){var r=Object.assign({time:(new Date).getTime(),site:null},e),i=Object.assign({},r.movieInfo);r.site&&delete r.site,r.link=a.a.getCleaningURL(r.link),i.imdbId||i.doubanId?t.getMoviceInfo(i.imdbId,i.doubanId).then((function(e){r.movieInfo=e,t.push(r),n(t.items)})).catch((function(e){console.log(e),t.push(r),n(t.items)})):(t.push(r),n(t.items))}))},e.prototype.getMoviceInfo=function(e,t){var n=this;return void 0===e&&(e=""),void 0===t&&(t=""),new Promise((function(o,r){var i=e,s=n.movieInfoService.getInfoFromIMDb;t&&(i=t,s=n.movieInfoService.getInfoFromDoubanId),s.call(n.movieInfoService,i).then((function(t){var n={imdbId:e,doubanId:t.id.toString().replace(/(\D)/g,""),image:t.image||(t.images?t.images.small:void 0),title:t.title,link:t.mobile_link||t.share_url,alt_title:t.alt_title||t.original_title,year:t.year};!t.year&&t.attrs&&(n.year=t.attrs.year[0]),o(n)})).catch((function(e){r()}))}))},e.prototype.push=function(e){-1===this.items.findIndex((function(t){return t.link===e.link}))&&(this.items.push(e),this.updateGroupCount(),this.storage.set(this.configKey,{groups:this.groups,items:this.items}))},e.prototype.update=function(e){var t=this;return new Promise((function(n,o){t.load().then((function(){e.link=a.a.getCleaningURL(e.link);var o=t.items.findIndex((function(t){return t.link===e.link}));if(o>=0){t.items[o]=e;var r=Object.assign({},e.movieInfo);if(e.site&&delete e.site,r.imdbId||r.doubanId)return void t.getMoviceInfo(r.imdbId,r.doubanId).then((function(r){e.movieInfo=r,t.items[o]=e,t.updateData(),n(t.items)})).catch((function(e){console.log(e),t.updateData(),n(t.items)}))}t.updateData(),n(t.items)}))}))},e.prototype.updateData=function(){this.updateGroupCount(),this.storage.set(this.configKey,{groups:this.groups,items:this.items})},e.prototype.delete=function(e){return this.remove([e])},e.prototype.remove=function(e){var t=this;return new Promise((function(n,o){t.load().then((function(){for(var o=function(n){var o=t.items[n];e.findIndex((function(e){return e.link===o.link}))>=0&&t.items.splice(n,1)},r=t.items.length-1;r>=0;r--)o(r);t.updateGroupCount(),t.storage.set(t.configKey,{groups:t.groups,items:t.items}),n(t.items)}))}))},e.prototype.clear=function(){var e=this;return new Promise((function(t,n){e.items=[],e.groups=[],e.storage.set(e.configKey,{}),t({})}))},e.prototype.get=function(e){var t=this;return new Promise((function(n,o){e=a.a.getCleaningURL(e),t.load().then((function(){var r=t.items.find((function(t){return t.link===e}));r?n(r):o(!1)}))}))},e.prototype.reset=function(e){var t=this;return new Promise((function(n,o){e?(Array.isArray(e)?t.items=e:(t.groups=e.groups||t.groups,t.items=e.items||t.items),t.storage.set(t.configKey,{groups:t.groups,items:t.items}),n({groups:t.groups,items:t.items})):o(!1)}))},e.prototype.addGroup=function(e){var t=this;return new Promise((function(n,o){var r=Object.assign({id:a.a.getNewId().substr(0,8),update:(new Date).getTime()},e);t.groups.push(r),t.storage.set(t.configKey,{groups:t.groups,items:t.items}),n(t.groups)}))},e.prototype.removeGroup=function(e){var t=this;return new Promise((function(n,o){var r=[];Array.isArray(e)?r=e:r.push(e),t.load().then((function(){for(var e=function(e){var n=t.groups[e];r.findIndex((function(e){return e.id===n.id}))>=0&&(t.items.forEach((function(e){if(e.groups){var t=e.groups.findIndex((function(e){return e===n.id}));-1!==t&&e.groups.splice(t,1)}})),t.groups.splice(e,1))},o=t.groups.length-1;o>=0;o--)e(o);t.updateGroupCount(),t.storage.set(t.configKey,{groups:t.groups,items:t.items}),n(t.groups)}))}))},e.prototype.updateGroup=function(e){var t=this;return new Promise((function(n,o){t.load().then((function(){var o=t.groups.findIndex((function(t){return t.id===e.id}));o>=0&&(t.groups[o]=e),t.storage.set(t.configKey,{groups:t.groups,items:t.items}),n(t.groups)}))}))},e.prototype.getGroups=function(){var e=this;return new Promise((function(t,n){e.load().then((function(){t(e.groups)}))}))},e.prototype.addToGroup=function(e,t){var n=this;return new Promise((function(o,r){e.groups||(e.groups=[]),-1===e.groups.findIndex((function(e){return e===t}))?(e.groups.push(t),n.update(e).then((function(){o(!0)}))):r(!1)}))},e.prototype.removeFromGroup=function(e,t){var n=this;return new Promise((function(o,r){if(e.groups){var i=e.groups.findIndex((function(e){return e===t}));-1!==i?(e.groups.splice(i,1),n.update(e).then((function(){o(!0)}))):r(!1)}}))},e.prototype.getAllLinks=function(){var e=[];return this.items.forEach((function(t){e.push(a.a.getCleaningURL(t.link))})),e},e}(),N=function(){function e(){this.items=[],this.storage=new i.a,this.configKey=o.f.searchResultSnapshot,this.load()}return e.prototype.load=function(){var e=this;return new Promise((function(t,n){e.storage.get(e.configKey,(function(n){var o={items:[]};Array.isArray(n)?o.items=n:n&&(o=Object.assign(o,n)),e.items=o.items||[],console.log(n),t(e.items)}))}))},e.prototype.add=function(e){var t=this;return new Promise((function(n,o){var r=Object.assign({time:(new Date).getTime(),id:a.a.getNewId()},e);t.items.push(r),t.updateData(),n(t.items)}))},e.prototype.updateData=function(){this.storage.set(this.configKey,{items:this.items})},e.prototype.get=function(e){var t=this;return new Promise((function(n,o){t.load().then((function(){var r=t.items.find((function(t){return t.id===e}));r?n(r):o(!1)}))}))},e.prototype.delete=function(e){return this.remove([e])},e.prototype.remove=function(e){var t=this;return new Promise((function(n,o){t.load().then((function(){for(var o=function(n){var o=t.items[n];e.findIndex((function(e){return e.id===o.id}))>=0&&t.items.splice(n,1)},r=t.items.length-1;r>=0;r--)o(r);t.updateData(),n(t.items)}))}))},e.prototype.clear=function(){var e=this;return new Promise((function(t,n){e.items=[],e.updateData(),t([])}))},e.prototype.reset=function(e){var t=this;return new Promise((function(n,o){e&&Array.isArray(e)?(t.items=e,t.updateData(),n(t.items)):o(!1)}))},e}(),G=function(){function e(){this.items=[],this.storage=new i.a,this.configKey=o.f.keepUploadTask,this.load()}return e.prototype.load=function(){var e=this;return new Promise((function(t,n){e.storage.get(e.configKey,(function(n){var o={items:[]};Array.isArray(n)?o.items=n:n&&(o=Object.assign(o,n)),e.items=o.items||[],console.log(n),t(e.items)}))}))},e.prototype.add=function(e){var t=this;return new Promise((function(n,o){var r=Object.assign({time:(new Date).getTime(),id:a.a.getNewId()},e);t.items.push(r),t.updateData(),n(t.items)}))},e.prototype.update=function(e){var t=this;return new Promise((function(n,o){t.load().then((function(){var o=t.items.findIndex((function(t){return t.id===e.id}));o>=0&&(t.items[o]=e),t.updateData(),n(t.items)}))}))},e.prototype.updateData=function(){this.storage.set(this.configKey,{items:this.items})},e.prototype.get=function(e){var t=this;return new Promise((function(n,o){t.load().then((function(){var r=t.items.find((function(t){return t.id===e}));r?n(r):o(!1)}))}))},e.prototype.delete=function(e){return this.remove([e])},e.prototype.remove=function(e){var t=this;return new Promise((function(n,o){t.load().then((function(){for(var o=function(n){var o=t.items[n];e.findIndex((function(e){return e.id===o.id}))>=0&&t.items.splice(n,1)},r=t.items.length-1;r>=0;r--)o(r);t.updateData(),n(t.items)}))}))},e.prototype.clear=function(){var e=this;return new Promise((function(t,n){e.items=[],e.updateData(),t([])}))},e.prototype.reset=function(e){var t=this;return new Promise((function(n,o){e&&Array.isArray(e)?(t.items=e,t.updateData(),n(t.items)):o(!1)}))},e}(),H=new(function(){function e(e){void 0===e&&(e=!1),this.config=new D(this),this.options={sites:[],clients:[]},this.localMode=!1,this.controller=new x(this),this.logger=new A,this.contentMenus=new L.a(this),this.userData=new K(this),this.omniBox=new B(this),this.i18n=new q(this),this.downloadQuene=new W(this),this.collection=new j,this.searchResultSnapshot=new N,this.keepUploadTask=new G,this.reloadCount=0,this.autoRefreshUserDataTimer=0,this.autoRefreshUserDataIsWorking=!1,this.autoRefreshUserDataFailedCount=0,e||this.initBrowserEvent(),this.logger.add({module:o.l.background,event:o.k.init}),this.localMode=e,this.initConfig()}return e.prototype.requestMessage=function(e,t){var n=this;return this.debug(o.k.requestMessage+"."+e.action),new Promise((function(r,i){var s;try{switch(e.action){case o.b.readConfig:n.localMode?n.readConfig().then((function(){r(n.options)})):r(n.options);break;case o.b.saveConfig:e.data.locale&&e.data.locale!=n.options.locale&&n.i18n.reset(e.data.locale),n.config.save(e.data),n.options=e.data,n.controller.isInitialized&&n.controller.reset(n.options),setTimeout((function(){n.contentMenus.init(n.options)}),100),n.resetAutoRefreshUserDataTimer(),r(n.options);break;case o.b.getClearedOptions:r(n.config.cleaningOptions(n.options));break;case o.b.resetRunTimeOptions:n.config.resetRunTimeOptions(e.data),n.options=n.config.options,r(n.options);break;case o.b.copyTextToClipboard:(s=n.controller.copyTextToClipboard(e.data))?r(s):i();break;case o.b.openOptions:n.controller.openOptions(e.data),r(!0);break;case o.b.updateOptionsTabId:n.controller.updateOptionsTabId(e.data),r(!0);break;case o.b.searchTorrent:console.log(e.data),n.controller.searchTorrent(e.data),r(!0);break;case o.b.testClientConnectivity:n.controller.clientController.testClientConnectivity(e.data).then((function(e){r(e)})).catch((function(t){n.logger.add({module:o.l.background,event:""+o.b.testClientConnectivity,msg:n.i18n.t("service.testClientConnectivityFailed",{address:e.data.address}),data:t}),i(t)}));break;case o.b.getSystemLogs:n.logger.load().then((function(e){r(e)})).catch((function(e){i(e)}));break;case o.b.removeSystemLogs:n.logger.remove(e.data).then((function(e){r(e)})).catch((function(e){i(e)}));break;case o.b.clearSystemLogs:n.logger.clear().then((function(e){r(e)})).catch((function(e){i(e)}));break;case o.b.writeLog:n.logger.add(e.data),r(!0);break;case o.b.readUIOptions:n.config.readUIOptions().then((function(e){r(e)})).catch((function(e){i(e)}));break;case o.b.saveUIOptions:n.config.saveUIOptions(e.data).then((function(e){r(e)})).catch((function(e){i(e)}));break;case o.b.changeLanguage:return n.i18n.reset(e.data);default:if(n[e.action])return void n[e.action](e.data,t).then((function(e){r(e)})).catch((function(e){i(e)}));n.controller.call(e,t).then((function(e){r(e)})).catch((function(e){i(e)}))}}catch(e){i(e)}}))},e.prototype.initConfig=function(){var e=this;if(this.reloadCount<10&&(0===this.config.sites.length||0===this.config.clients.length))return setTimeout((function(){e.initConfig()}),500),void this.reloadCount++;this.readConfig().then((function(){e.initI18n()}))},e.prototype.initI18n=function(){var e=this;this.i18n.init().then((function(){e.init()})).catch((function(){console.debug("i18n init error")}))},e.prototype.readConfig=function(){var e=this;return new Promise((function(t,n){e.config.read().then((function(n){e.initUserData(),e.options=n,t(n),e.localMode||e.controller.init(e.options)}))}))},e.prototype.saveConfig=function(){this.config.save(this.options)},e.prototype.initUserData=function(){var e=this;this.options.sites.forEach((function(t){t.user=e.userData.get(t.host)}))},e.prototype.resetAutoRefreshUserDataTimer=function(e){var t=this;if(void 0===e&&(e=!1),clearInterval(this.autoRefreshUserDataTimer),this.options.autoRefreshUserData){this.options.autoRefreshUserDataNextTime=this.getNextTime(0),(new Date).getTime()>=this.options.autoRefreshUserDataNextTime&&(e&&a.a.getToDay()!=a.a.getToDay(this.options.autoRefreshUserDataLastTime)?this.options.autoRefreshUserDataNextTime=(new Date).getTime()+1e4:this.options.autoRefreshUserDataNextTime=this.getNextTime()),this.autoRefreshUserDataFailedCount=0;var n=this.options.autoRefreshUserDataFailedRetryCount||3,r=this.options.autoRefreshUserDataFailedRetryInterval||5;this.autoRefreshUserDataTimer=window.setInterval((function(){var e=(new Date).getTime();t.options.autoRefreshUserDataNextTime&&e>=t.options.autoRefreshUserDataNextTime&&!t.autoRefreshUserDataIsWorking&&(t.options.autoRefreshUserDataNextTime=t.getNextTime(),t.autoRefreshUserDataIsWorking=!0,t.controller.userService.refreshUserData(t.autoRefreshUserDataFailedCount>0).then((function(e){t.debug("refreshUserData DONE.",e),t.autoRefreshUserDataIsWorking=!1;var i=!1;e.some((function(e){return e?!e.id&&e.msg&&e.msg.status!=o.v.notSupported?(i=!0,!0):void 0:(i=!0,!0)})),i?(t.autoRefreshUserDataFailedCount<n?(t.options.autoRefreshUserDataNextTime=(new Date).getTime()+6e4*r,t.debug("\u6570\u636e\u5237\u65b0\u5931\u8d25, \u4e0b\u6b21\u91cd\u8bd5\u65f6\u95f4",new Date(t.options.autoRefreshUserDataNextTime).toLocaleString())):t.debug("\u6570\u636e\u5237\u65b0\u5931\u8d25, \u91cd\u8bd5\u6b21\u6570\u5df2\u8d85\u9650\u5236"),t.autoRefreshUserDataFailedCount++):(t.debug("\u6570\u636e\u5237\u65b0\u5b8c\u6210"),t.autoRefreshUserDataFailedCount=0)})))}),1e3)}},e.prototype.getNextTime=function(e){void 0===e&&(e=1);var t=a.a.getToDay(),n=new Date(t+" "+this.options.autoRefreshUserDataHours+":"+this.options.autoRefreshUserDataMinutes+":00");return new Date(n.setDate(n.getDate()+e)).getTime()},e.prototype.saveUserData=function(){this.initUserData(),this.config.save(this.options)},e.prototype.init=function(){this.localMode||(this.contentMenus.init(this.options),this.resetAutoRefreshUserDataTimer(!0))},e.prototype.debug=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach((function(t){e.controller.pushDebugMsg(t)}))},e.prototype.writeLog=function(e){this.logger.add(e)},e.prototype.writeErrorLog=function(e){this.logger.add({module:o.l.background,event:"\u4e00\u822c\u9519\u8bef",msg:"string"==typeof e?e:JSON.stringify(e)})},e.prototype.initBrowserEvent=function(){var e=this;void 0!==window.chrome&&chrome.runtime&&(console.log("service.initBrowserEvent"),chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener((function(t,n,o){return e.requestMessage(t,n).then((function(e){o&&o({resolve:e})})).catch((function(e){o&&o({reject:e})})),!0})),chrome.runtime.onInstalled.addListener((function(t){console.log("chrome.runtime.onInstalled",t),"update"==t.reason&&e.upgrade()})))},e.prototype.upgrade=function(){var e=this;this.controller.openURL("changelog.html"),setTimeout((function(){e.userData.upgrade()}),1e3)},e.prototype.getSiteParser=function(e,t){var n=this.options.system&&this.options.system.sites&&this.options.system.sites.find((function(t){return t.host===e}));if(!n)return"";var o=n.parser&&n.parser[t];if(!o){var r=this.options.system&&this.options.system.schemas&&this.options.system.schemas.find((function(e){return e.name===n.schema}));o=r.parser&&r.parser[t]}return o},e.prototype.getSiteSelector=function(e,t){var n="string"==typeof e?e:e.host,o=this.clone(this.options.system),r=o.sites.concat(this.options.sites).find((function(e){return e.host===n}));if(!r){if("string"==typeof e)return null;r=e}var i=r.selectors&&r.selectors[t],s=o.schemas.find((function(e){return null!=r&&e.name===r.schema}));if(i){if(!0===i.disabled)return null;s&&s.selectors&&s.selectors[t]&&!0===i.merge&&(i.fields=Object.assign(s.selectors[t].fields,i.fields),i=Object.assign(s.selectors[t],i))}else s&&s.selectors&&(i=s.selectors[t]);return i},e.prototype.clone=function(e){return a.a.clone(e)},e.prototype.checkPermissions=function(e){return a.a.checkPermissions(e)},e.prototype.requestPermissions=function(e){return a.a.requestPermissions(e)},e}());Object.assign(window,{PTServiceFilters:w.a,PTBackgroundService:H,i18n:H.i18n})},85:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var o=n(22),r=n(29),i="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",s=function(){function e(e){this.service=e,this.cache={},this.loadCache()}return e.prototype.loadCache=function(){var e=window.localStorage.getItem("Favicon-Cache");e&&(this.cache=JSON.parse(e)||{})},e.prototype.saveCache=function(){window.localStorage.setItem("Favicon-Cache",JSON.stringify(this.cache))},e.prototype.clear=function(){this.cache={},this.saveCache()},e.prototype.reset=function(){var e=JSON.parse(JSON.stringify(this.cache));this.cache={};var t=[];for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];t.push(o.origin)}return this.gets(t)},e.prototype.gets=function(e){var t=this;return new Promise((function(n,o){var r=[];e.forEach((function(e){r.push(t.get(e))})),Promise.all(r).then((function(e){n(e)})).catch((function(e){o(e)}))}))},e.prototype.get=function(e,t){var n=this;return void 0===t&&(t=!1),new Promise((function(r,i){var s=o.a.parseURL(e),a=n.cache[s.host];if(a&&!t)return r(a);n.cacheFavicon(s.origin,s.host).then((function(e){r(e)})).catch((function(e){i(e)}))}))},e.prototype.cacheFavicon=function(e,t){var n=this;return new Promise((function(o,r){n.download(e+"/favicon.ico").then((function(i){i&&/image/gi.test(i.type)?n.transformBlob(i,"base64").then((function(t){o(n.set(e,t))})).catch((function(e){r(e)})):n.cacheFromIndex(e,t).then((function(e){o(e)})).catch((function(e){r(e)}))})).catch((function(){n.cacheFromIndex(e,t).then((function(e){o(e)})).catch((function(e){r(e)}))}))}))},e.prototype.set=function(e,t){var n=o.a.parseURL(e),r={origin:n.origin,host:n.host,data:t};return this.cache[n.host]=r,this.saveCache(),r},e.prototype.cacheFromIndex=function(e,t){var n=this;return new Promise((function(t,r){n.download(e).then((function(s){s&&/text/gi.test(s.type)?n.transformBlob(s,"text").then((function(s){try{var a=(new DOMParser).parseFromString(s,"text/html"),c=$(a).find("head").find("link[rel*=icon]:first");if(c&&c.length>0){var u=o.a.parseURL(e),l=c.attr("href")+"";"//"===l.substr(0,2)?l=u.protocol+":"+l:"http"!==l.substr(0,4)&&(l=u.origin+"/"+l),n.download(l).then((function(o){o&&/image/gi.test(o.type)?n.transformBlob(o,"base64").then((function(o){t(n.set(e,o))})).catch((function(e){n.debug(e),r(e)})):t(n.set(e,i))})).catch((function(){t(n.set(e,i))}))}else t(n.set(e,i))}catch(o){console.log(o),n.debug(o),t(n.set(e,i))}})).catch((function(e){n.debug(e),r(e)})):r()})).catch((function(){t(n.set(e,i))}))}))},e.prototype.transformBlob=function(e,t){return new Promise((function(n,o){var r=new FileReader;switch(r.addEventListener("loadend",(function(){r.result?n(r.result):o()})),t){case"text":r.readAsText(e);break;case"base64":r.readAsDataURL(e)}}))},e.prototype.download=function(e){var t=this;return new Promise((function(n,o){var i=new r.a({url:e,getDataOnly:!0,timeout:5e3});i.onCompleted=function(){i.content?n(i.content):o()},i.onError=function(e){console.log("Favicon.download.error",e),t.debug(e),o(e)},i.start()}))},e.prototype.debug=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.service&&(e=this.service).debug.apply(e,t)},e}()}});