!function(e){console.log("this is torrent.js");class t extends window.NexusPHPCommon{init(){this.initButtons(),this.initFreeSpaceButton(),PTService.pageApp=this}initButtons(){this.initListButtons()}async resolveDownloadURLs(){let t=e("tr").map((function(){return e(this).data("row-key")})).toArray().filter((e=>!!e));t=[...new Set(t)],console.log("ids",t);let i=[];return new Promise((async(s,n)=>{for(let e=0;e<t.length;e++){const s=t[e],n=8e3;let o=Math.ceil(n*(t.length-e)/1e3/60),r=this.t("resolveURLsTip",{id:s,current:e+1,total:t.length,min:o});this.showStatusMessage(r,480);let l=PTService.resolveMTDownloadURL(s);if(!l){console.error(`can't get download url by id: ${s}`);break}i.push(l),await this.sleep(n)}e(this.statusBar).remove(),console.log(`已解析 ${i.length} 个下载链接`,i),s(i)}))}getDownloadURLs(){let e=PTService.filters.parseURL(location.href),t=(PTService.getSiteFromHost(e.host),PTService.getFieldValue("downloadURLs"));return t?Promise.resolve(t):this.resolveDownloadURLs().then((e=>0===e.length?this.t("getDownloadURLsFailed"):e)).catch((e=>(console.error(e),null)))}confirmWhenExceedSize(){return this.confirmSize(e("table:contains('類別'), table:contains('Type')").find("td:contains('MB'),td:contains('GB'),td:contains('TB'),td:contains('MiB'),td:contains('GiB'),td:contains('TiB')"))}getDroperURL(e){let t=PTService.site.url;if("/"!=t.substr(-1)&&(t+="/"),!e.getQueryString)return PTService.showNotice({msg:"系统依赖函数（getQueryString）未正确加载，请尝试刷新页面或重新启用插件。"}),null;if(-1===e.indexOf("download.php")){let i=e.getQueryString("id");e=i?t+"download.php?id="+i+(PTService.site.passkey?"&passkey="+PTService.site.passkey:"")+(PTService.site.disableHttps?"":"&https=1"):""}return e}}(new t).init()}(jQuery);