!function(t,e){let s=new class{constructor(){this.haveData=!1,/takelogin\.php|<form action="\?returnto=/.test(t.responseText)?t.status=ESearchResultParseStatus.needLogin:(t.isLogged=!0,/没有种子|No [Tt]orrents?|Your search did not match anything|用准确的关键字重试/.test(t.responseText)?t.status=ESearchResultParseStatus.noTorrents:(this.haveData=!0,this.site=t.site))}start(){let r=s.getResult();console.log("hdchina",r);let a=jQuery(t.responseText).filter("meta[name='x-csrf']").attr("content"),i=new Map(r.map((t=>[new URL(t.link).searchParams.get("id"),t]))),l=`csrf=${a}&ids[]=${[...i.keys()].join("&ids[]=")}`,n=[];$.post("https://hdchina.org/ajax_promotion.php",l).done((s=>{if(s&&200===s.status&&s.message)for(const r in s.message){let a=i.get(r);if(s.message[r].sp_state){const{sp_state:i,timeout:l}=s.message[r];let n=e.getRowTags(t.site,jQuery(`<div>${i}</div>`));n&&(a.tags=a.tags.concat(n))}n.push(a)}else n=r;console.log("hdchina",n),t.resolve(n)})).fail((e=>{console.error(`[${t.site.name}]获取种子信息出错: ${e.message}`,e),t.reject({success:!1,msg:t.searcher.getErrorMessage(t.site,ESearchResultParseStatus.parseError,t.errorMsg),data:{site:t.site,isLogged:t.isLogged}})}))}getResult(){if(!this.haveData)return[];let s=t.site,r=PTServiceFilters.parseURL(s.url),a=t.resultSelector||"table.torrents:last";a=a.replace("> tbody > tr","");let i=t.page.find(a),l=i.find("> tbody > tr");if(0==l.length)return t.status=ESearchResultParseStatus.torrentTableIsEmpty,[];let n=[],h=i.find("> thead > tr > th"),o=0;0==h.length&&(o=1,h=l.eq(0).find("th,td"));let d={time:-1,size:-1,seeders:-1,leechers:-1,completed:-1,comments:-1,author:h.length-1,category:-1};s.url.lastIndexOf("/")!=s.url.length-1&&(s.url+="/");for(let t=0;t<h.length;t++){let e=h.eq(t),s=e.text();e.find(".comments").length?(d.comments=t,d.author=t==d.author?-1:d.author):e.find("img.time,div.date,div.icons.time").length?(d.time=t,d.author=t==d.author?-1:d.author):e.find("img.size,div[alt='size'],div.icons.size").length?(d.size=t,d.author=t==d.author?-1:d.author):e.find("img.seeders,div[alt='seeders'],div.icons.seeders").length?(d.seeders=t,d.author=t==d.author?-1:d.author):e.find("img.leechers,div[alt='leechers'],div.icons.leechers").length?(d.leechers=t,d.author=t==d.author?-1:d.author):e.find("img.snatched,div[alt='snatched'],div.icons.snatched").length?(d.completed=t,d.author=t==d.author?-1:d.author):/(cat|类型|類型|分类|分類|Тип)/gi.test(s)&&(d.category=t,d.author=t==d.author?-1:d.author)}t.entry.fieldIndex&&(d=Object.assign(d,t.entry.fieldIndex));try{for(let a=o;a<l.length;a++){const i=l.eq(a);"zhiding"===i.attr("id")&&i.removeAttr("id");let h=i.find(">td"),o=this.getTitle(i,h,d);if(0==o.length)continue;let c=o.attr("href");c&&"//"===c.substr(0,2)?c=`${r.protocol}://${c}`:c&&"http"!==c.substr(0,4)&&(c=`${s.url}${c}`);let u=this.getDownloadLink(i,c);if(u&&"//"===u.substr(0,2)?u=`${r.protocol}://${u}`:u&&"http"!==u.substr(0,4)&&(u=`${s.url}${u}`),!u)continue;u+=s&&s.passkey?"&passkey="+s.passkey:"";let g={title:o.attr("title")||o.text(),subTitle:this.getSubTitle(o,i),link:c,url:u,size:this.getFieldValue(i,h,d,"size")||0,time:-1==d.time?"":this.getTime(h.eq(d.time)),author:this.getFieldValue(i,h,d,"author")||"",seeders:this.getFieldValue(i,h,d,"seeders")||0,leechers:this.getFieldValue(i,h,d,"leechers")||0,completed:this.getFieldValue(i,h,d,"completed")||0,comments:this.getFieldValue(i,h,d,"comments")||0,site:s,tags:e.getRowTags(this.site,i),entryName:t.entry.name,category:-1==d.category?null:this.getFieldValue(i,h,d,"category")||this.getCategory(h.eq(d.category)),progress:e.getFieldValue(s,i,"progress"),status:e.getFieldValue(s,i,"status"),imdbId:this.getIMDbId(i)};n.push(g)}}catch(e){t.status=ESearchResultParseStatus.parseError,t.errorMsg=e.stack}return n}getFieldValue(t,s,r,a,i){let l=t,n=null;s&&r&&void 0!==r[a]&&-1!==r[a]&&(n=s.eq(r[a]),l=n||t);let h=e.getFieldValue(this.site,l,a);if(!h&&n){if(i)return n;h=n.text()}return h}getTime(e){let s=e.find("span[title],time[title]").attr("title");return s||(s=$("<span>").html(e.html().replace("<br>"," ")).text()),["pt.sjtu.edu.cn","piggo.me"].some((e=>e===t.site.host))&&s.match(/\d+[分时天月年]/g)&&(s=Date.now()-this._parseTime(s),s=new Date(s).toLocaleString("zh-CN",{hour12:!1}).replace(/\//g,"-")),s||""}_parseTime(t){const e=t.match(/\d+[分时天月年]/g);let s=0;return e.forEach((t=>{const e=t.match(/(\d+)([分时天月年])/),r=parseInt(e[1]),a=e[2];switch(!0){case"分"===a:s+=r;break;case"时"===a:s+=60*r;break;case"天"===a:s+=60*r*24;break;case"月"===a:s+=60*r*24*30;break;case"年"===a:s+=60*r*24*365}})),60*s*1e3}getTitle(s,r,a){let i=this.getFieldValue(s,r,a,"title",!0)||s.find("a[href*='hit'][title]:not(a[href*='comment'])").first();if("string"==typeof i)return i;0==i.length&&(i=s.find("a[href*='hit']:has(b)").first()),0==i.length&&"u2.dmhy.org"===t.site.host&&(i=s.find("a.tooltip[href*='hit']").first());let l=i.find("span.__cf_email__");return l.length>0&&l.each(((t,s)=>{$(s).replaceWith(e.cfDecodeEmail($(s).data("cfemail")))})),i}getIMDbId(t){let s=e.getFieldValue(this.site,t,"imdbId");if(s)return s;try{let e=t.find("a[href*='imdb.com/title/tt']").first().attr("href");if(e&&(s=e.match(/(tt\d+)/),s))return s[0]}catch(t){return console.log(t),null}return null}getSubTitle(s,r){let a=e.getFieldValue(this.site,r,"subTitle");if(a)return a;try{if(a=s.parent().html().split("<br>"),a&&a.length>1)a=$("<span>").html(a[a.length-1]).text();else switch(t.site.host){case"hdchina.org":s.parent().next().is("h4")&&(a=s.parent().next().text());break;case"kp.m-team.cc":case"xp.m-team.cc":case"ap.m-team.cc":a=(s=r.find("a[href*='hit'][title]").last()).parent().html().split("<br>"),a=$("<span>").html(a[a.length-1]).text();break;case"u2.dmhy.org":a=$(".torrentname > tbody > tr:eq(1)",r).find(".tooltip").text();break;case"whu.pt":case"hudbt.hust.edu.cn":a=$("h3",r).text();break;default:a=""}return a||""}catch(t){return""}}getDownloadLink(e,s){let r;switch(t.site.host){case"hdsky.me":{let t=e.find('form[action*="download.php"]:eq(0)');if(t.length>0){r=t.attr("action");break}}default:{let t=e.find("img.download").parent();r=t.length?"A"!==t.get(0).tagName?`download.php?id=${s.getQueryString("id")}`:t.attr("href"):`download.php?id=${s.getQueryString("id")}`,r+="&https=1"}}return r}getCategory(e){let s={name:"",link:""},r=e.find("a:first"),a=r.find("img:first");return r.length&&(s.link=r.attr("href"),"http"!==s.link.substr(0,4)&&(s.link=t.site.url+s.link)),a.length?s.name=a.attr("title")||a.attr("alt"):s.name=r.text(),s}}(t);s.start()}(options,options.searcher);