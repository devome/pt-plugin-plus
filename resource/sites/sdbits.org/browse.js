!function(e){console.log("this is browse.js");class t extends window.NexusPHPCommon{init(){this.initButtons(),this.initFreeSpaceButton(),PTService.pageApp=this}isNexusPHP(){return"SDB"==PTService.site.schema}initButtons(){this.initListButtons(!1)}getDownloadURLs(){let t=PTService.site.url,r=e("a[href*='download.php']").toArray(),i=e.map(r,(r=>{let i=e(r).attr("href");return i=i.replace("source=browse","source=rss"),i=i.replace(new RegExp("/download.php/.*.torrent"),"download.php"),i&&"http"!==i.substr(0,4)&&(i=`${t}${i}`),i}));return 0==r.length?"获取下载链接失败，未能正确定位到链接":i}call(e,t){return new Promise(((r,i)=>{e===PTService.action.downloadFromDroper&&this.downloadFromDroper(t,(()=>{r()}))}))}getDroperURL(t){let r=PTService.site.url;if("/"!=r.substr(-1)&&(r+="/"),!t.getQueryString)return PTService.showNotice({msg:"系统依赖函数（getQueryString）未正确加载，请尝试刷新页面或重新启用插件。"}),null;if(-1==t.indexOf("download.php")){let i=t.getQueryString("id"),n=e("a[href*='download.php']:first").attr("href").getQueryString("passkey");t=i?r+"download.php?id="+i+(PTService.site.passkey?"&passkey="+PTService.site.passkey:n?"&passkey="+n:"")+"&source=rss":""}return t}downloadFromDroper(e,t){"string"==typeof e&&(e={url:e,title:""});let r=this.getDroperURL(e.url);r?this.sendTorrentToDefaultClient(r).then((e=>{t(e)})).catch((e=>{t(e)})):t()}confirmWhenExceedSize(){return this.confirmSize(e("#torrent-list").find("td.center:contains('MiB'),td.center:contains('GiB'),td.center:contains('TiB')"))}}(new t).init()}(jQuery);