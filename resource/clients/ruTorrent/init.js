!function(t){window.ruTorrent=class{init(t){this.options=t;let e=PTServiceFilters.parseURL(this.options.address),s=[e.protocol,"://",e.host];e.port&&s.push(`:${e.port}`),s.push(e.path),"/"!==e.path.substr(-1)&&s.push("/"),this.options.address=s.join(""),console.log("ruTorrent.init",this.options.address)}call(t,e){return console.log("ruTorrent.call",t,e),new Promise(((s,o)=>{switch(t){case"addTorrentFromURL":this.addTorrentFromUrl(e,(t=>{"Success"===t.result?s(t):o(t)}));break;case"testClientConnectivity":this.testClientConnectivity().then((t=>{s(!0)})).catch(((t,e)=>{o({status:"error",code:t,msg:e})}))}}))}testClientConnectivity(e){return new Promise(((s,o)=>{t.ajax({type:"GET",url:this.options.address+"php/getsettings.php",username:this.options.loginName,password:this.options.loginPwd,timeout:PTBackgroundService.options.connectClientTimeout}).done(((t,o,r)=>{this.isInitialized=!0,e&&e(t),s()})).fail(((t,e,s)=>{o(t.status,e)}))}))}addTorrentFromUrl(t,e){let s=t.url;s.startsWith("magnet:")?this.addTorrent({dir_edit:t.savePath,paused:!t.autoStart,url:s,json:1},e):PTBackgroundService.requestMessage({action:"getTorrentDataFromURL",data:s}).then((s=>{let o=new FormData;o.append("json",1),t.savePath&&o.append("dir_edit",t.savePath),o.append("paused",!t.autoStart),o.append("torrent_file",s,"file.torrent"),this.addTorrent(o,e)})).catch((t=>{e&&e(t)}))}addTorrent(e,s){t.ajax({type:"POST",url:this.options.address+"php/addtorrent.php",username:this.options.loginName,password:this.options.loginPwd,timeout:PTBackgroundService.options.connectClientTimeout,data:e,contentType:!1,processData:!1,dataType:"json",success:(t,e)=>{s&&s(t)}})}}}(jQuery,window);